<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Academic Writing Hub - Task Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <style>
        /* ===== EXTENSIVE CSS VARIABLES ===== */
        :root {
            --primary: #004aad;
            --primary-light: #3a6fc8;
            --primary-dark: #003580;
            --secondary: #ff6b35;
            --success: #28a745;
            --success-light: #d4edda;
            --warning: #ffc107;
            --warning-light: #fff3cd;
            --danger: #dc3545;
            --danger-light: #f8d7da;
            --info: #17a2b8;
            --info-light: #d1ecf1;
            --light: #f8f9fa;
            --dark: #343a40;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --border: #dee2e6;
            --shadow: rgba(0,0,0,0.1);
            --gold: #ffd700;
            --silver: #c0c0c0;
            --bronze: #cd7f32;
            --gradient-primary: linear-gradient(135deg, var(--primary), var(--primary-dark));
            --gradient-secondary: linear-gradient(135deg, var(--secondary), #ff8c42);
            --gradient-success: linear-gradient(135deg, var(--success), #34ce57);
            --gradient-warning: linear-gradient(135deg, var(--warning), #ffd54f);
            --gradient-danger: linear-gradient(135deg, var(--danger), #e35d6a);
            --gradient-info: linear-gradient(135deg, var(--info), #39c0d3);
            --gradient-light: linear-gradient(135deg, var(--light), #e9ecef);
            --gradient-dark: linear-gradient(135deg, var(--dark), #495057);
            --gradient-gold: linear-gradient(135deg, var(--gold), #ffed4e);
            --gradient-silver: linear-gradient(135deg, var(--silver), #e0e0e0);
            --gradient-bronze: linear-gradient(135deg, var(--bronze), #e6a65c);
            --gradient-card: linear-gradient(135deg, #ffffff, #f8f9fa);
            --gradient-modal: linear-gradient(135deg, #ffffff, #f5f7fa);
            --shadow-xs: 0 1px 3px rgba(0,0,0,0.05);
            --shadow-sm: 0 2px 6px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 25px rgba(0,0,0,0.15);
            --shadow-xl: 0 15px 35px rgba(0,0,0,0.2);
            --shadow-xxl: 0 25px 50px rgba(0,0,0,0.25);
            --border-radius-xs: 4px;
            --border-radius-sm: 8px;
            --border-radius-md: 12px;
            --border-radius-lg: 16px;
            --border-radius-xl: 20px;
            --border-radius-xxl: 24px;
            --border-radius-round: 50%;
            --transition-xs: 0.15s;
            --transition-sm: 0.2s;
            --transition-md: 0.3s;
            --transition-lg: 0.5s;
            --transition-xl: 0.7s;
            --font-size-xxs: 10px;
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-xxl: 24px;
            --font-size-xxxl: 28px;
            --font-size-hero: 32px;
            --font-size-giant: 36px;
            --font-size-massive: 42px;
            --spacing-xxs: 2px;
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --spacing-xl: 25px;
            --spacing-xxl: 30px;
            --spacing-xxxl: 35px;
            --spacing-giant: 40px;
            --spacing-massive: 50px;
            --spacing-huge: 60px;
            --z-index-dropdown: 1000;
            --z-index-sticky: 1020;
            --z-index-fixed: 1030;
            --z-index-modal-backdrop: 1040;
            --z-index-modal: 1050;
            --z-index-popover: 1060;
            --z-index-tooltip: 1070;
            --z-index-toast: 1080;
            --z-index-max: 9999;
        }
        
        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes fadeInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes fadeInRight {
            from {
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes slideInUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0.9);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
            }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        @keyframes progress {
            0% {
                width: 0%;
            }
            100% {
                width: 100%;
            }
        }
        
        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }
        
        @keyframes wave {
            0%, 100% {
                transform: translateX(0);
            }
            50% {
                transform: translateX(-10px);
            }
        }
        
        @keyframes blink {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 5px var(--primary);
            }
            50% {
                box-shadow: 0 0 20px var(--primary);
            }
        }
        
        @keyframes ripple {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(4);
                opacity: 0;
            }
        }
        
        @keyframes typing {
            from {
                width: 0;
            }
            to {
                width: 100%;
            }
        }
        
        @keyframes blink-caret {
            from, to {
                border-color: transparent;
            }
            50% {
                border-color: var(--primary);
            }
        }
        
        /* ===== BASE STYLES ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            font-size: 16px;
            height: 100%;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 74, 173, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 107, 53, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(40, 167, 69, 0.03) 0%, transparent 30%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* ===== TYPOGRAPHY ENHANCEMENTS ===== */
        h1, h2, h3, h4, h5, h6 {
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: var(--spacing-lg);
            color: var(--primary);
            letter-spacing: -0.02em;
        }
        
        h1 {
            font-size: var(--font-size-massive);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h2 {
            font-size: var(--font-size-xxxl);
            position: relative;
            padding-bottom: var(--spacing-md);
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--gradient-primary);
            border-radius: 2px;
        }
        
        h3 {
            font-size: var(--font-size-xxl);
        }
        
        h4 {
            font-size: var(--font-size-xl);
        }
        
        h5 {
            font-size: var(--font-size-lg);
        }
        
        h6 {
            font-size: var(--font-size-md);
        }
        
        p {
            margin-bottom: var(--spacing-lg);
            line-height: 1.7;
        }
        
        a {
            color: var(--primary);
            text-decoration: none;
            transition: all var(--transition-md);
            position: relative;
        }
        
        a:hover {
            color: var(--primary-dark);
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        strong, b {
            font-weight: 700;
            color: var(--dark);
        }
        
        em, i {
            font-style: italic;
        }
        
        /* ===== HEADER STYLES ===== */
        header {
            background: var(--gradient-primary);
            color: #fff;
            padding: var(--spacing-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow-lg);
            position: sticky;
            top: 0;
            z-index: var(--z-index-fixed);
            border-bottom: 4px solid var(--secondary);
            animation: fadeInDown var(--transition-md);
        }
        
        .header-left {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .header-left h1 {
            margin: 0;
            font-size: var(--font-size-xxxl);
            font-weight: 900;
            letter-spacing: -0.5px;
            color: white;
            background: none;
            -webkit-text-fill-color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .header-left .slogan {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        
        .header-left .slogan::before {
            content: 'âœ¨';
            font-size: var(--font-size-md);
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
        }
        
        .notification-bell {
            position: relative;
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-round);
            transition: all var(--transition-md);
            background: rgba(255,255,255,0.1);
        }
        
        .notification-bell:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .notification-bell i {
            font-size: var(--font-size-xl);
            color: white;
        }
        
        .notification-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: var(--font-size-xs);
            font-weight: 700;
            width: 20px;
            height: 20px;
            border-radius: var(--border-radius-round);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary);
            animation: pulse 2s infinite;
        }
        
        .user-menu {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            cursor: pointer;
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            transition: all var(--transition-md);
            background: rgba(255,255,255,0.1);
            position: relative;
        }
        
        .user-menu:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .user-avatar {
            width: 48px;
            height: 48px;
            border-radius: var(--border-radius-round);
            background: var(--gradient-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            color: white;
            font-size: var(--font-size-xl);
            box-shadow: 0 4px 12px rgba(255,107,53,0.4);
            border: 3px solid rgba(255,255,255,0.3);
            transition: all var(--transition-md);
        }
        
        .user-menu:hover .user-avatar {
            transform: scale(1.05) rotate(5deg);
            box-shadow: 0 6px 20px rgba(255,107,53,0.6);
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 700;
            font-size: var(--font-size-md);
            color: white;
        }
        
        .user-role {
            font-size: var(--font-size-sm);
            opacity: 0.9;
            color: rgba(255,255,255,0.9);
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: var(--font-size-xxl);
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            transition: background var(--transition-md);
            z-index: var(--z-index-fixed);
        }
        
        .mobile-menu-btn:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* ===== MAIN LAYOUT ===== */
        .container {
            display: flex;
            min-height: calc(100vh - 80px);
            position: relative;
        }
        
        /* ===== SIDEBAR NAVIGATION ===== */
        nav {
            width: 300px;
            background: linear-gradient(180deg, #ffffff 0%, #f8f9fa 100%);
            border-right: 1px solid var(--border);
            padding: var(--spacing-xxl) 0;
            transition: transform var(--transition-md) ease;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: var(--z-index-sticky);
            overflow-y: auto;
            max-height: calc(100vh - 80px);
        }
        
        nav::-webkit-scrollbar {
            width: 6px;
        }
        
        nav::-webkit-scrollbar-track {
            background: var(--light);
        }
        
        nav::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: var(--border-radius-sm);
        }
        
        nav a {
            padding: var(--spacing-lg) var(--spacing-xxl);
            text-decoration: none;
            color: var(--dark);
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            transition: all var(--transition-md);
            border-left: 6px solid transparent;
            font-weight: 600;
            margin: 2px var(--spacing-md);
            border-radius: 0 var(--border-radius-lg) var(--border-radius-lg) 0;
            position: relative;
            overflow: hidden;
        }
        
        nav a::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,74,173,0.1), transparent);
            transition: left var(--transition-lg);
        }
        
        nav a:hover::before {
            left: 100%;
        }
        
        nav a:hover {
            background: linear-gradient(135deg, rgba(0,74,173,0.1), rgba(0,74,173,0.05));
            color: var(--primary);
            border-left-color: var(--primary-light);
            transform: translateX(10px);
            box-shadow: var(--shadow-md);
        }
        
        nav a.active {
            background: var(--gradient-primary);
            color: #fff;
            border-left-color: var(--secondary);
            font-weight: 700;
            box-shadow: var(--shadow-lg);
        }
        
        nav a.active::after {
            content: '';
            position: absolute;
            right: -10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--gradient-primary);
            border-radius: 50%;
            box-shadow: var(--shadow-md);
        }
        
        nav a i {
            font-size: var(--font-size-lg);
            width: 24px;
            text-align: center;
        }
        
        .nav-footer {
            margin-top: auto;
            padding: var(--spacing-xl);
            border-top: 1px solid var(--border);
        }
        
        .nav-stats {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            font-size: var(--font-size-sm);
            color: var(--gray);
        }
        
        .nav-stats div {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .nav-stats span:last-child {
            font-weight: 700;
            color: var(--primary);
        }
        
        /* ===== MAIN CONTENT AREA ===== */
        main {
            flex: 1;
            padding: var(--spacing-xxl);
            overflow-y: auto;
            width: 100%;
            animation: fadeIn var(--transition-md);
        }
        
        main::-webkit-scrollbar {
            width: 8px;
        }
        
        main::-webkit-scrollbar-track {
            background: var(--light);
        }
        
        main::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: var(--border-radius-sm);
        }
        
        /* ===== PAGE HEADER ===== */
        .page-header {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-massive);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-xl);
            margin-bottom: var(--spacing-xxl);
            position: relative;
            overflow: hidden;
            animation: fadeInUp var(--transition-md);
        }
        
        .page-header::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            transform: rotate(30deg);
        }
        
        .page-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
        }
        
        .page-header h1 {
            font-size: var(--font-size-giant);
            margin-bottom: var(--spacing-md);
            font-weight: 900;
            position: relative;
            z-index: 1;
            color: white;
            text-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .page-header p {
            opacity: 0.95;
            font-size: var(--font-size-lg);
            font-weight: 400;
            position: relative;
            z-index: 1;
            max-width: 800px;
            line-height: 1.8;
        }
        
        .page-header-actions {
            display: flex;
            gap: var(--spacing-md);
            margin-top: var(--spacing-xl);
            position: relative;
            z-index: 1;
        }
        
        /* ===== ADMIN REVIEW NOTICE ===== */
        .admin-review-notice {
            background: var(--gradient-warning);
            color: var(--dark);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
            border-left: 8px solid var(--warning);
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            position: relative;
            overflow: hidden;
            animation: fadeInLeft var(--transition-md);
        }
        
        .admin-review-notice::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent);
        }
        
        .admin-review-notice .icon {
            font-size: 42px;
            flex-shrink: 0;
            filter: drop-shadow(0 2px 8px rgba(0,0,0,0.2));
            animation: float 3s ease-in-out infinite;
        }
        
        .admin-review-notice .content h4 {
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-xl);
            font-weight: 800;
        }
        
        .admin-review-notice .content p {
            margin: 0;
            opacity: 0.9;
            font-size: var(--font-size-md);
        }
        
        .admin-review-notice .close-notice {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: none;
            border: none;
            color: var(--dark);
            font-size: var(--font-size-lg);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--border-radius-round);
            transition: all var(--transition-md);
        }
        
        .admin-review-notice .close-notice:hover {
            background: rgba(0,0,0,0.1);
            transform: rotate(90deg);
        }
        
        /* ===== STATS CARDS ===== */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-massive);
            animation: fadeInUp var(--transition-md) 0.1s both;
        }
        
        .stat-card {
            background: white;
            padding: var(--spacing-xxl);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            text-align: center;
            border-top: 8px solid var(--primary);
            transition: all var(--transition-md) ease;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
        }
        
        .stat-card::after {
            content: '';
            position: absolute;
            bottom: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent, rgba(0,74,173,0.05));
            transition: bottom var(--transition-lg);
        }
        
        .stat-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-xl);
        }
        
        .stat-card:hover::after {
            bottom: 0;
        }
        
        .stat-card.balance {
            border-top-color: var(--success);
        }
        
        .stat-card.balance::before {
            background: var(--gradient-success);
        }
        
        .stat-card.tasks {
            border-top-color: var(--primary);
        }
        
        .stat-card.earnings {
            border-top-color: var(--secondary);
        }
        
        .stat-card.earnings::before {
            background: var(--gradient-secondary);
        }
        
        .stat-card.pending {
            border-top-color: var(--warning);
        }
        
        .stat-card.pending::before {
            background: var(--gradient-warning);
        }
        
        .stat-card.available {
            border-top-color: var(--info);
        }
        
        .stat-card.available::before {
            background: var(--gradient-info);
        }
        
        .stat-card.rating {
            border-top-color: var(--gold);
        }
        
        .stat-card.rating::before {
            background: var(--gradient-gold);
        }
        
        .stat-icon {
            font-size: var(--font-size-xxxl);
            margin-bottom: var(--spacing-lg);
            display: inline-block;
            padding: var(--spacing-md);
            border-radius: var(--border-radius-round);
            background: var(--light);
            box-shadow: var(--shadow-sm);
        }
        
        .stat-value {
            font-size: var(--font-size-giant);
            font-weight: 900;
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-card.balance .stat-value {
            color: var(--success);
        }
        
        .stat-card.earnings .stat-value {
            color: var(--secondary);
        }
        
        .stat-card.pending .stat-value {
            color: var(--warning);
        }
        
        .stat-card.available .stat-value {
            color: var(--info);
        }
        
        .stat-card.rating .stat-value {
            color: var(--gold);
        }
        
        .stat-label {
            color: var(--gray);
            font-size: var(--font-size-md);
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: var(--spacing-md);
        }
        
        .stat-trend {
            font-size: var(--font-size-sm);
            font-weight: 600;
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: var(--border-radius-sm);
            display: inline-block;
        }
        
        .stat-trend.positive {
            background: var(--success-light);
            color: var(--success);
        }
        
        .stat-trend.negative {
            background: var(--danger-light);
            color: var(--danger);
        }
        
        .stat-trend.neutral {
            background: var(--light);
            color: var(--gray);
        }
        
        /* ===== REFRESH INDICATOR ===== */
        .refresh-indicator {
            background: white;
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            margin-bottom: var(--spacing-xxl);
            display: flex;
            align-items: center;
            gap: var(--spacing-xl);
            border-left: 8px solid var(--success);
            transition: all var(--transition-md) ease;
            animation: fadeInRight var(--transition-md) 0.2s both;
        }
        
        .refresh-indicator:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
        }
        
        .refresh-indicator .icon {
            font-size: var(--font-size-giant);
            color: var(--success);
            animation: spin 20s linear infinite;
        }
        
        .refresh-indicator .info {
            flex: 1;
        }
        
        .refresh-indicator .info h4 {
            color: var(--primary);
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-xl);
            font-weight: 800;
        }
        
        .refresh-indicator .info p {
            color: var(--gray);
            font-size: var(--font-size-md);
        }
        
        .refresh-countdown {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: 50px;
            font-weight: 800;
            font-size: var(--font-size-lg);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            min-width: 180px;
            justify-content: center;
        }
        
        .refresh-countdown i {
            font-size: var(--font-size-lg);
        }
        
        /* ===== MY TASKS SECTION ===== */
        .my-tasks-section {
            background: white;
            padding: var(--spacing-massive);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-xl);
            margin-bottom: var(--spacing-massive);
            border: 1px solid rgba(0,0,0,0.05);
            animation: fadeInUp var(--transition-md) 0.3s both;
        }
        
        .my-tasks-section h3 {
            color: var(--primary);
            margin-bottom: var(--spacing-xl);
            font-size: var(--font-size-xxxl);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
        }
        
        .my-tasks-section h3 i {
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
        }
        
        .section-actions {
            display: flex;
            gap: var(--spacing-md);
        }
        
        .tasks-tabs {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-xl);
            border-bottom: 3px solid var(--border);
            padding-bottom: var(--spacing-xs);
            flex-wrap: wrap;
            position: relative;
        }
        
        .tasks-tabs::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100px;
            height: 3px;
            background: var(--gradient-primary);
            transition: all var(--transition-md);
        }
        
        .tab-btn {
            padding: var(--spacing-lg) var(--spacing-xxl);
            background: none;
            border: none;
            border-bottom: 4px solid transparent;
            font-weight: 700;
            color: var(--gray);
            cursor: pointer;
            transition: all var(--transition-md);
            border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
            font-size: var(--font-size-md);
            position: relative;
            overflow: hidden;
        }
        
        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,74,173,0.1), transparent);
            transition: left var(--transition-lg);
        }
        
        .tab-btn:hover::before {
            left: 100%;
        }
        
        .tab-btn:hover {
            color: var(--primary);
            background: rgba(0,74,173,0.05);
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(0,74,173,0.08);
            font-weight: 800;
        }
        
        .tab-btn .badge {
            margin-left: var(--spacing-sm);
            background: var(--primary);
            color: white;
            font-size: var(--font-size-xs);
            padding: 2px 8px;
            border-radius: 10px;
            font-weight: 700;
        }
        
        .tasks-summary {
            background: var(--gradient-light);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: var(--shadow-md);
            animation: scaleIn var(--transition-md);
        }
        
        .tasks-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-xl);
            text-align: center;
        }
        
        .summary-item {
            padding: var(--spacing-xl);
            background: white;
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-md) ease;
            border-top: 6px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .summary-item:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }
        
        .summary-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, transparent, rgba(0,0,0,0.02), transparent);
        }
        
        .summary-value {
            font-size: var(--font-size-giant);
            font-weight: 900;
            margin-bottom: var(--spacing-sm);
            position: relative;
        }
        
        .summary-label {
            font-size: var(--font-size-sm);
            color: var(--gray);
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .summary-total {
            border-top-color: var(--primary);
        }
        
        .summary-total .summary-value {
            color: var(--primary);
        }
        
        .summary-approved {
            border-top-color: var(--success);
        }
        
        .summary-approved .summary-value {
            color: var(--success);
        }
        
        .summary-pending {
            border-top-color: var(--warning);
        }
        
        .summary-pending .summary-value {
            color: var(--warning);
        }
        
        .summary-rejected {
            border-top-color: var(--danger);
        }
        
        .summary-rejected .summary-value {
            color: var(--danger);
        }
        
        .summary-progress {
            border-top-color: var(--info);
        }
        
        .summary-progress .summary-value {
            color: var(--info);
        }
        
        .summary-expired {
            border-top-color: var(--gray);
        }
        
        .summary-expired .summary-value {
            color: var(--gray);
        }
        
        .my-tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: var(--spacing-xl);
            animation: fadeIn var(--transition-md) 0.4s both;
        }
        
        /* ===== TASK CARDS ===== */
        .task-card {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xxl);
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-md) ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            border-top: 8px solid var(--primary-light);
            animation: fadeInUp var(--transition-md);
        }
        
        .task-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-light), var(--primary));
        }
        
        .task-card::after {
            content: '';
            position: absolute;
            top: -100%;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: all var(--transition-lg);
        }
        
        .task-card:hover::after {
            top: 100%;
            left: 100%;
        }
        
        .task-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: var(--shadow-xxl);
        }
        
        .task-card.featured {
            border-color: var(--warning);
            box-shadow: 0 10px 30px rgba(255,193,7,0.3);
            animation: glow 2s infinite;
        }
        
        .task-card.featured::before {
            background: var(--gradient-warning);
        }
        
        .task-card.expired {
            opacity: 0.7;
            border-color: var(--gray);
        }
        
        .task-card.expired::before {
            background: var(--gray);
        }
        
        .task-card.expired::after {
            content: 'EXPIRED';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-45deg);
            background: rgba(0,0,0,0.8);
            color: white;
            font-weight: 900;
            font-size: var(--font-size-xxl);
            padding: var(--spacing-md) var(--spacing-xl);
            border-radius: var(--border-radius-md);
            z-index: 2;
            animation: blink 2s infinite;
        }
        
        .task-card.full {
            border-color: var(--danger);
        }
        
        .task-card.full::before {
            background: var(--gradient-danger);
        }
        
        .task-card.full .bidders-info {
            background: var(--danger-light);
            color: var(--danger);
            padding: var(--spacing-sm);
            border-radius: var(--border-radius-sm);
            text-align: center;
            font-weight: 700;
            margin-bottom: var(--spacing-md);
        }
        
        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-lg);
            position: relative;
            z-index: 1;
        }
        
        .task-title {
            font-size: var(--font-size-xl);
            font-weight: 800;
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
            line-height: 1.4;
            flex: 1;
        }
        
        .task-type {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-lg);
            background: var(--light);
            color: var(--primary);
            border-radius: 50px;
            font-size: var(--font-size-sm);
            font-weight: 800;
            border: 2px solid rgba(0,74,173,0.1);
            margin-bottom: var(--spacing-sm);
        }
        
        .task-reward {
            font-size: var(--font-size-xxxl);
            font-weight: 900;
            color: var(--success);
            text-align: right;
            line-height: 1.2;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .task-reward span {
            font-size: var(--font-size-md);
            color: var(--gray);
            font-weight: 600;
            display: block;
        }
        
        .task-description {
            color: var(--gray);
            margin-bottom: var(--spacing-xl);
            line-height: 1.7;
            font-size: var(--font-size-md);
            position: relative;
            z-index: 1;
        }
        
        .task-status-container {
            margin: var(--spacing-lg) 0;
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
            font-weight: 800;
            font-size: var(--font-size-md);
            text-align: center;
            box-shadow: var(--shadow-sm);
            position: relative;
            z-index: 1;
            animation: pulse 2s infinite;
        }
        
        .task-status-container.approved {
            background: var(--gradient-success);
            color: white;
            border: 2px solid var(--success);
        }
        
        .task-status-container.rejected {
            background: var(--gradient-danger);
            color: white;
            border: 2px solid var(--danger);
        }
        
        .task-status-container.submitted {
            background: var(--gradient-warning);
            color: var(--dark);
            border: 2px solid var(--warning);
        }
        
        .task-status-container.in-progress {
            background: var(--gradient-info);
            color: white;
            border: 2px solid var(--info);
        }
        
        .task-status-container.expired {
            background: var(--gradient-dark);
            color: white;
            border: 2px solid var(--dark);
        }
        
        .task-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-top: var(--spacing-lg);
            border-top: 2px solid var(--border);
            position: relative;
            z-index: 1;
        }
        
        .task-difficulty {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-md);
            font-weight: 700;
        }
        
        .difficulty-beginner {
            color: var(--success);
        }
        
        .difficulty-intermediate {
            color: var(--warning);
        }
        
        .difficulty-advanced {
            color: var(--danger);
        }
        
        .task-requirements {
            font-size: var(--font-size-sm);
            color: var(--gray);
            font-weight: 700;
        }
        
        .task-deadline {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-sm);
            font-weight: 600;
            margin: var(--spacing-md) 0;
            padding: var(--spacing-sm);
            background: var(--light);
            border-radius: var(--border-radius-sm);
        }
        
        .task-deadline.expired {
            background: var(--danger-light);
            color: var(--danger);
        }
        
        .task-deadline.warning {
            background: var(--warning-light);
            color: var(--warning);
        }
        
        .task-deadline.ok {
            background: var(--success-light);
            color: var(--success);
        }
        
        .task-bidders {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-sm);
            font-weight: 600;
            margin-bottom: var(--spacing-md);
        }
        
        .task-bidders i {
            color: var(--primary);
        }
        
        .bidders-count {
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: var(--border-radius-round);
            font-size: var(--font-size-xs);
            font-weight: 700;
        }
        
        .task-actions {
            display: flex;
            gap: var(--spacing-md);
            position: relative;
            z-index: 1;
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            padding: var(--spacing-lg) var(--spacing-xxl);
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 800;
            cursor: pointer;
            transition: all var(--transition-md) ease;
            flex: 1;
            text-align: center;
            font-size: var(--font-size-md);
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left var(--transition-lg);
        }
        
        .btn:hover::before {
            left: 100%;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            box-shadow: var(--shadow-xl);
        }
        
        .btn-secondary {
            background: var(--gradient-secondary);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #ff8c42, var(--secondary));
            box-shadow: var(--shadow-xl);
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #34ce57, var(--success));
            box-shadow: var(--shadow-xl);
        }
        
        .btn-warning {
            background: var(--gradient-warning);
            color: var(--dark);
            box-shadow: var(--shadow-md);
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #ffd54f, var(--warning));
            box-shadow: var(--shadow-xl);
        }
        
        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #e35d6a, var(--danger));
            box-shadow: var(--shadow-xl);
        }
        
        .btn-info {
            background: var(--gradient-info);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-info:hover {
            background: linear-gradient(135deg, #39c0d3, var(--info));
            box-shadow: var(--shadow-xl);
        }
        
        .btn-light {
            background: var(--gradient-light);
            color: var(--dark);
            box-shadow: var(--shadow-md);
        }
        
        .btn-light:hover {
            background: linear-gradient(135deg, #e9ecef, var(--light));
            box-shadow: var(--shadow-xl);
        }
        
        .btn-dark {
            background: var(--gradient-dark);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-dark:hover {
            background: linear-gradient(135deg, #495057, var(--dark));
            box-shadow: var(--shadow-xl);
        }
        
        .btn-outline-primary {
            background: transparent;
            color: var(--primary);
            border: 2px solid var(--primary);
            box-shadow: none;
        }
        
        .btn-outline-primary:hover {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-outline-secondary {
            background: transparent;
            color: var(--secondary);
            border: 2px solid var(--secondary);
            box-shadow: none;
        }
        
        .btn-outline-secondary:hover {
            background: var(--secondary);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .btn-sm {
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: var(--font-size-sm);
        }
        
        .btn-lg {
            padding: var(--spacing-xl) var(--spacing-xxxl);
            font-size: var(--font-size-lg);
        }
        
        .btn-xl {
            padding: var(--spacing-xxl) var(--spacing-massive);
            font-size: var(--font-size-xl);
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn:disabled {
            background: var(--gray);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.6;
        }
        
        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }
        
        .btn:disabled::before {
            display: none;
        }
        
        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: var(--border-radius-round);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-group {
            display: flex;
            gap: 0;
        }
        
        .btn-group .btn {
            border-radius: 0;
        }
        
        .btn-group .btn:first-child {
            border-radius: var(--border-radius-md) 0 0 var(--border-radius-md);
        }
        
        .btn-group .btn:last-child {
            border-radius: 0 var(--border-radius-md) var(--border-radius-md) 0;
        }
        
        .no-tasks {
            text-align: center;
            padding: var(--spacing-massive) var(--spacing-xl);
            color: var(--gray);
            grid-column: 1 / -1;
            animation: fadeIn var(--transition-md);
        }
        
        .no-tasks h3 {
            margin-bottom: var(--spacing-md);
            color: var(--dark);
            font-size: var(--font-size-xxl);
            font-weight: 800;
        }
        
        .no-tasks p {
            font-size: var(--font-size-md);
            max-width: 500px;
            margin: 0 auto;
        }
        
        .no-tasks .icon {
            font-size: var(--font-size-giant);
            margin-bottom: var(--spacing-lg);
            opacity: 0.5;
        }
        
        /* ===== FILTERS SECTION ===== */
        .filters-section {
            background: white;
            padding: var(--spacing-xxl);
            border-radius: var(--border-radius-xl);
            box-shadow: var(--shadow-xl);
            margin-bottom: var(--spacing-xxl);
            border: 1px solid rgba(0,0,0,0.05);
            animation: fadeInDown var(--transition-md) 0.2s both;
        }
        
        .filters-section h3 {
            margin-bottom: var(--spacing-xl);
            color: var(--primary);
            font-size: var(--font-size-xxl);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--spacing-xl);
            align-items: end;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: 800;
            margin-bottom: var(--spacing-sm);
            color: var(--dark);
            font-size: var(--font-size-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .filter-group label i {
            color: var(--primary);
        }
        
        .filter-group select, .filter-group input {
            padding: var(--spacing-lg);
            border: 2px solid var(--border);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-md);
            transition: all var(--transition-md);
            background: white;
            box-shadow: var(--shadow-sm);
            font-family: inherit;
        }
        
        .filter-group select:focus, .filter-group input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(0,74,173,0.1);
            transform: translateY(-2px);
        }
        
        .filter-group select:hover, .filter-group input:hover {
            border-color: var(--primary-light);
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding-left: 56px;
            width: 100%;
        }
        
        .search-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: var(--font-size-lg);
        }
        
        .filter-actions {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }
        
        .tasks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-massive);
            animation: fadeIn var(--transition-md) 0.3s both;
        }
        
        /* ===== MESSAGE STYLES ===== */
        .message {
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin: var(--spacing-xl) 0;
            text-align: center;
            font-weight: 800;
            font-size: var(--font-size-md);
            box-shadow: var(--shadow-md);
            animation: slideInUp var(--transition-md);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-md);
        }
        
        .message.success {
            background: var(--gradient-success);
            color: white;
            border: 2px solid var(--success);
        }
        
        .message.error {
            background: var(--gradient-danger);
            color: white;
            border: 2px solid var(--danger);
        }
        
        .message.warning {
            background: var(--gradient-warning);
            color: var(--dark);
            border: 2px solid var(--warning);
        }
        
        .message.info {
            background: var(--gradient-info);
            color: white;
            border: 2px solid var(--info);
        }
        
        .message i {
            font-size: var(--font-size-xl);
        }
        
        /* ===== ENHANCED WORKSPACE STYLES ===== */
        .workspace-tools {
            background: var(--gradient-light);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin-bottom: var(--spacing-xl);
            border: 1px solid rgba(0,0,0,0.05);
            box-shadow: var(--shadow-lg);
        }
        
        .workspace-tools h3 {
            color: var(--primary);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-xxl);
            font-weight: 800;
        }
        
        .toolbar {
            display: flex;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
        }
        
        .tool-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: 700;
            transition: all var(--transition-md);
            box-shadow: var(--shadow-sm);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .tool-btn:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .tool-btn:active {
            transform: translateY(0);
        }
        
        .tool-btn.secondary {
            background: var(--gradient-secondary);
        }
        
        .tool-btn.secondary:hover {
            background: linear-gradient(135deg, #ff8c42, var(--secondary));
        }
        
        .tool-btn.success {
            background: var(--gradient-success);
        }
        
        .tool-btn.success:hover {
            background: linear-gradient(135deg, #34ce57, var(--success));
        }
        
        .tool-btn.warning {
            background: var(--gradient-warning);
            color: var(--dark);
        }
        
        .tool-btn.warning:hover {
            background: linear-gradient(135deg, #ffd54f, var(--warning));
        }
        
        .tool-btn.danger {
            background: var(--gradient-danger);
        }
        
        .tool-btn.danger:hover {
            background: linear-gradient(135deg, #e35d6a, var(--danger));
        }
        
        .workspace-area {
            border: 3px solid var(--border);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xxl);
            background: white;
            min-height: 500px;
            box-shadow: var(--shadow-md);
            position: relative;
        }
        
        .workspace-tabs {
            display: flex;
            gap: var(--spacing-xs);
            margin-bottom: var(--spacing-xl);
            border-bottom: 3px solid var(--border);
            padding-bottom: var(--spacing-xs);
            position: relative;
        }
        
        .workspace-tab {
            padding: var(--spacing-md) var(--spacing-xl);
            background: var(--light);
            border: none;
            border-radius: var(--border-radius-md) var(--border-radius-md) 0 0;
            cursor: pointer;
            font-weight: 700;
            transition: all var(--transition-md);
            position: relative;
            overflow: hidden;
        }
        
        .workspace-tab::before {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--primary);
            transform: translateX(-100%);
            transition: transform var(--transition-md);
        }
        
        .workspace-tab:hover::before {
            transform: translateX(0);
        }
        
        .workspace-tab:hover {
            background: rgba(0,74,173,0.1);
        }
        
        .workspace-tab.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-md);
        }
        
        .workspace-tab.active::before {
            transform: translateX(0);
            background: var(--secondary);
        }
        
        .text-editor {
            width: 100%;
            height: 400px;
            padding: var(--spacing-xl);
            border: 3px solid var(--border);
            border-radius: var(--border-radius-lg);
            font-family: 'Segoe UI', sans-serif;
            resize: vertical;
            font-size: var(--font-size-md);
            line-height: 1.8;
            box-shadow: inset var(--shadow-sm);
            transition: all var(--transition-md);
        }
        
        .text-editor:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: inset var(--shadow-sm), 0 0 0 4px rgba(0,74,173,0.1);
        }
        
        .text-editor:disabled {
            background: #f8f9fa;
            color: #6c757d;
            cursor: not-allowed;
        }
        
        .spreadsheet-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-sm);
            border-radius: var(--border-radius-md);
            overflow: hidden;
        }
        
        .spreadsheet-table th, .spreadsheet-table td {
            border: 2px solid var(--border);
            padding: var(--spacing-lg);
            min-width: 150px;
            text-align: left;
            transition: all var(--transition-sm);
        }
        
        .spreadsheet-table th {
            background: var(--gradient-primary);
            color: white;
            font-weight: 800;
            position: sticky;
            top: 0;
        }
        
        .spreadsheet-table td {
            background: white;
        }
        
        .spreadsheet-table td:focus {
            background: #fff9c4;
            outline: 3px solid var(--warning);
        }
        
        .spreadsheet-table tr:hover td {
            background: #f8f9fa;
        }
        
        .file-upload-area {
            border: 4px dashed var(--border);
            border-radius: var(--border-radius-lg);
            padding: 80px;
            text-align: center;
            margin-bottom: var(--spacing-xl);
            transition: all var(--transition-md);
            background: rgba(248,249,250,0.5);
            cursor: pointer;
        }
        
        .file-upload-area:hover {
            border-color: var(--primary);
            background: rgba(0,74,173,0.03);
            transform: scale(1.02);
        }
        
        .file-upload-area.dragover {
            border-color: var(--primary);
            background: var(--light);
            transform: scale(1.05);
        }
        
        .file-upload-area i {
            font-size: var(--font-size-giant);
            color: var(--primary);
            margin-bottom: var(--spacing-lg);
            display: block;
        }
        
        .file-upload-area h4 {
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
        }
        
        .file-upload-area p {
            color: var(--gray);
            margin-bottom: 0;
        }
        
        .membership-required {
            background: var(--gradient-warning);
            color: var(--dark);
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            margin: var(--spacing-lg) 0;
            text-align: center;
            font-weight: 800;
            font-size: var(--font-size-lg);
            box-shadow: var(--shadow-md);
            border-left: 8px solid var(--warning);
            animation: pulse 2s infinite;
        }
        
        /* ===== TRANSCRIPTION SPECIFIC STYLES ===== */
        .transcription-workspace {
            margin-top: var(--spacing-xl);
        }
        
        .audio-player-section {
            border: 3px solid var(--border);
            border-radius: var(--border-radius-xl);
            background: var(--gradient-light);
            padding: var(--spacing-xxl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-lg);
        }
        
        .audio-controls {
            display: flex;
            gap: var(--spacing-md);
            flex-wrap: wrap;
            align-items: center;
            margin-top: var(--spacing-lg);
        }
        
        .audio-progress {
            width: 100%;
            height: 8px;
            background: var(--light);
            border-radius: 4px;
            margin: var(--spacing-md) 0;
            overflow: hidden;
        }
        
        .audio-progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 4px;
            transition: width 0.1s;
        }
        
        #wordCount.low {
            color: var(--danger);
            font-weight: 800;
        }
        
        #wordCount.good {
            color: var(--success);
            font-weight: 800;
        }
        
        #wordCount.excellent {
            color: var(--primary);
            font-weight: 800;
        }
        
        /* ===== PROGRESS BAR FOR AUDIO ===== */
        audio {
            border-radius: var(--border-radius-md);
            width: 100%;
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-md);
        }
        
        /* ===== TIMER STYLES ===== */
        .timer-display {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            text-align: center;
            margin: var(--spacing-xl) 0;
            font-weight: 800;
            font-size: var(--font-size-xl);
            box-shadow: var(--shadow-lg);
            animation: pulse 2s infinite;
        }
        
        .timer-controls {
            display: flex;
            gap: var(--spacing-md);
            justify-content: center;
            margin-top: var(--spacing-lg);
        }
        
        .timer-btn {
            padding: var(--spacing-md) var(--spacing-xl);
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 700;
            cursor: pointer;
            transition: all var(--transition-md);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .timer-btn.start {
            background: var(--success);
            color: white;
        }
        
        .timer-btn.start:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .timer-btn.pause {
            background: var(--warning);
            color: var(--dark);
        }
        
        .timer-btn.pause:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .timer-btn.reset {
            background: var(--danger);
            color: white;
        }
        
        .timer-btn.reset:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        /* ===== MODAL STYLES ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: var(--z-index-modal);
            justify-content: center;
            align-items: flex-start;
            padding: var(--spacing-xl) var(--spacing-md);
            overflow-y: auto;
            animation: fadeIn var(--transition-md);
        }
        
        .modal-content {
            background: var(--gradient-modal);
            border-radius: var(--border-radius-xl);
            width: 95%;
            max-width: 1200px;
            max-height: 90vh;
            padding: var(--spacing-massive);
            box-shadow: var(--shadow-xxl);
            position: relative;
            animation: scaleIn var(--transition-md);
            overflow-y: auto;
            margin: var(--spacing-xl) auto;
            border: 1px solid rgba(0,0,0,0.1);
        }
        
        .modal-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal-content::-webkit-scrollbar-track {
            background: var(--light);
        }
        
        .modal-content::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: var(--border-radius-sm);
        }
        
        .close-modal {
            position: absolute;
            top: var(--spacing-xl);
            right: var(--spacing-xl);
            font-size: 2.5rem;
            cursor: pointer;
            color: var(--gray);
            transition: all var(--transition-md);
            background: rgba(0,0,0,0.05);
            width: 50px;
            height: 50px;
            border-radius: var(--border-radius-round);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
        }
        
        .close-modal:hover {
            color: var(--danger);
            background: rgba(220,53,69,0.1);
            transform: rotate(90deg);
        }
        
        .modal-header {
            margin-bottom: var(--spacing-xxl);
            padding-bottom: var(--spacing-xl);
            border-bottom: 3px solid var(--border);
            position: relative;
        }
        
        .modal-header h2 {
            font-size: var(--font-size-xxxl);
            font-weight: 900;
            margin-bottom: var(--spacing-md);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .modal-body {
            margin-bottom: var(--spacing-xxl);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
            padding-top: var(--spacing-xl);
            border-top: 3px solid var(--border);
        }
        
        /* ===== ENHANCED TRANSCRIPTION GUIDELINES ===== */
        .transcription-guidelines {
            background: linear-gradient(135deg, #e7f3ff, #d4e7ff);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin: var(--spacing-xl) 0;
            border-left: 8px solid var(--primary);
            box-shadow: var(--shadow-md);
        }
        
        .transcription-guidelines h4 {
            color: var(--primary);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-xl);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .transcription-guidelines ul {
            padding-left: var(--spacing-xl);
            margin-bottom: 0;
        }
        
        .transcription-guidelines li {
            margin-bottom: var(--spacing-md);
            line-height: 1.6;
            position: relative;
        }
        
        .transcription-guidelines li::before {
            content: 'âœ“';
            position: absolute;
            left: -25px;
            color: var(--success);
            font-weight: 800;
        }
        
        /* ===== LOADING ANIMATIONS ===== */
        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: var(--border-radius-round);
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: var(--spacing-sm);
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: var(--z-index-max);
            animation: fadeIn var(--transition-md);
        }
        
        .loading-overlay .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,.3);
            border-radius: var(--border-radius-round);
            border-top-color: var(--primary);
            animation: spin 1s linear infinite;
            margin-bottom: var(--spacing-xl);
        }
        
        .loading-overlay p {
            color: white;
            font-size: var(--font-size-lg);
            font-weight: 600;
            text-align: center;
        }
        
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--border-radius-md);
        }
        
        .skeleton-text {
            height: 16px;
            margin-bottom: var(--spacing-sm);
        }
        
        .skeleton-title {
            height: 24px;
            width: 60%;
            margin-bottom: var(--spacing-lg);
        }
        
        .skeleton-card {
            height: 200px;
            border-radius: var(--border-radius-lg);
        }
        
        /* ===== ACHIEVEMENT BADGES ===== */
        .achievement-badge {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--gradient-gold);
            color: #856404;
            border-radius: 50px;
            font-weight: 800;
            font-size: var(--font-size-sm);
            margin: var(--spacing-xs);
            box-shadow: var(--shadow-md);
            border: 2px solid var(--gold);
            animation: float 3s ease-in-out infinite;
        }
        
        .achievement-badge.silver {
            background: var(--gradient-silver);
            color: #495057;
            border-color: var(--silver);
        }
        
        .achievement-badge.bronze {
            background: var(--gradient-bronze);
            color: white;
            border-color: var(--bronze);
        }
        
        .badge {
            display: inline-block;
            padding: var(--spacing-xs) var(--spacing-md);
            font-size: var(--font-size-xs);
            font-weight: 800;
            border-radius: 50px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .badge-primary {
            background: var(--primary);
            color: white;
        }
        
        .badge-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .badge-success {
            background: var(--success);
            color: white;
        }
        
        .badge-warning {
            background: var(--warning);
            color: var(--dark);
        }
        
        .badge-danger {
            background: var(--danger);
            color: white;
        }
        
        .badge-info {
            background: var(--info);
            color: white;
        }
        
        .badge-light {
            background: var(--light);
            color: var(--dark);
        }
        
        .badge-dark {
            background: var(--dark);
            color: white;
        }
        
        /* ===== ADVANCED WORKSPACE TOOLS ===== */
        .advanced-tools {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--spacing-lg);
            margin: var(--spacing-xl) 0;
        }
        
        .tool-card {
            background: white;
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            text-align: center;
            transition: all var(--transition-md);
            cursor: pointer;
            border: 3px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        
        .tool-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary);
        }
        
        .tool-icon {
            font-size: var(--font-size-giant);
            margin-bottom: var(--spacing-lg);
            color: var(--primary);
            display: block;
        }
        
        .tool-name {
            font-weight: 800;
            color: var(--dark);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-lg);
        }
        
        .tool-desc {
            font-size: var(--font-size-sm);
            color: var(--gray);
            line-height: 1.6;
            margin-bottom: var(--spacing-md);
        }
        
        .tool-price {
            background: var(--warning);
            color: var(--dark);
            padding: var(--spacing-xs) var(--spacing-md);
            border-radius: 50px;
            font-size: var(--font-size-xs);
            font-weight: 800;
            margin-top: var(--spacing-sm);
            display: inline-block;
        }
        
        .tool-locked {
            position: relative;
        }
        
        .tool-locked::after {
            content: 'ðŸ”’';
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            font-size: var(--font-size-lg);
        }
        
        /* ===== TOOL-SPECIFIC STYLES ===== */
        .spell-check-highlight {
            background-color: #ffeb3b;
            padding: 2px;
            border-radius: 3px;
        }
        
        .tool-panel {
            background: white;
            border: 3px solid var(--border);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin: var(--spacing-lg) 0;
            box-shadow: var(--shadow-lg);
        }
        
        .tool-panel h4 {
            color: var(--primary);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-xl);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        /* ===== PAYMENT MODAL STYLES ===== */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: var(--z-index-modal);
            justify-content: center;
            align-items: center;
            padding: var(--spacing-md);
            overflow-y: auto;
        }
        
        .payment-content {
            background: white;
            border-radius: var(--border-radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            padding: var(--spacing-xxl);
            box-shadow: var(--shadow-xxl);
            position: relative;
            animation: scaleIn var(--transition-md);
            overflow-y: auto;
        }
        
        .payment-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 3px solid var(--border);
        }
        
        .payment-header h2 {
            color: var(--primary);
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-xxl);
            font-weight: 900;
        }
        
        .payment-amount {
            font-size: var(--font-size-giant);
            font-weight: 900;
            color: var(--success);
            margin: var(--spacing-xl) 0;
            text-align: center;
            padding: var(--spacing-xl);
            background: linear-gradient(135deg, #d4edda, #c3e6cb);
            border-radius: var(--border-radius-lg);
            border: 3px solid var(--success);
            animation: pulse 2s infinite;
        }
        
        .payment-steps {
            background: linear-gradient(135deg, #e7f3ff, #d4e7ff);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin: var(--spacing-xl) 0;
            border-left: 8px solid var(--primary);
        }
        
        .payment-steps h4 {
            color: var(--primary);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-lg);
            font-weight: 800;
        }
        
        .payment-steps ol {
            padding-left: var(--spacing-xl);
            line-height: 1.8;
            font-size: var(--font-size-md);
        }
        
        .payment-steps li {
            margin-bottom: var(--spacing-md);
            position: relative;
        }
        
        .payment-steps li::marker {
            color: var(--primary);
            font-weight: 800;
        }
        
        .mpesa-code-input {
            width: 100%;
            padding: var(--spacing-lg);
            border: 3px solid var(--border);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-lg);
            text-align: center;
            letter-spacing: 3px;
            font-weight: 800;
            margin: var(--spacing-lg) 0;
            font-family: monospace;
        }
        
        .mpesa-code-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 4px rgba(0,74,173,0.1);
        }
        
        .payment-actions {
            display: flex;
            gap: var(--spacing-lg);
            margin-top: var(--spacing-xxl);
        }
        
        .payment-actions .btn {
            flex: 1;
        }
        
        /* ===== MANUAL PAYMENT STYLES ===== */
        .manual-payment-section {
            background: linear-gradient(135deg, #e7f5ee, #d4edda);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            margin: var(--spacing-xl) 0;
            border-left: 8px solid var(--success);
        }
        
        .manual-payment-section h4 {
            color: var(--success);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-xl);
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .mpesa-number-display {
            background: var(--dark);
            color: white;
            padding: var(--spacing-lg);
            border-radius: var(--border-radius-md);
            font-family: monospace;
            font-size: var(--font-size-lg);
            text-align: center;
            margin: var(--spacing-lg) 0;
            letter-spacing: 3px;
            font-weight: 800;
            word-break: break-all;
            border: 3px solid var(--success);
            animation: glow 2s infinite;
        }
        
        .copy-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: var(--spacing-lg) var(--spacing-xl);
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-weight: 800;
            transition: all var(--transition-md);
            width: 100%;
            margin-top: var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        
        .copy-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .copy-btn:active {
            transform: translateY(0);
        }
        
        .copy-btn.copied {
            background: var(--success);
        }
        
        .transaction-message-box {
            width: 100%;
            min-height: 150px;
            padding: var(--spacing-lg);
            border: 3px solid var(--border);
            border-radius: var(--border-radius-lg);
            font-family: 'Segoe UI', sans-serif;
            font-size: var(--font-size-md);
            resize: vertical;
            margin: var(--spacing-lg) 0;
            box-shadow: inset var(--shadow-sm);
            line-height: 1.6;
        }
        
        .transaction-message-box:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: inset var(--shadow-sm), 0 0 0 4px rgba(0,74,173,0.1);
        }
        
        .payment-status-indicator {
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            text-align: center;
            font-weight: 800;
            margin: var(--spacing-xl) 0;
            font-size: var(--font-size-lg);
            animation: fadeIn var(--transition-md);
        }
        
        .payment-status-indicator.pending {
            background: var(--gradient-warning);
            color: var(--dark);
            border: 3px solid var(--warning);
        }
        
        .payment-status-indicator.approved {
            background: var(--gradient-success);
            color: white;
            border: 3px solid var(--success);
        }
        
        .payment-status-indicator.rejected {
            background: var(--gradient-danger);
            color: white;
            border: 3px solid var(--danger);
        }
        
        /* ===== MEMBERSHIP UPGRADE PROMPT ===== */
        .membership-upgrade-prompt {
            background: var(--gradient-warning);
            padding: var(--spacing-xxl);
            border-radius: var(--border-radius-xl);
            margin: var(--spacing-xl) 0;
            text-align: center;
            border-left: 8px solid var(--warning);
            box-shadow: var(--shadow-lg);
        }
        
        .membership-upgrade-prompt h4 {
            color: var(--dark);
            margin-bottom: var(--spacing-lg);
            font-size: var(--font-size-xxl);
            font-weight: 900;
        }
        
        .membership-upgrade-prompt p {
            margin-bottom: var(--spacing-xl);
            color: var(--dark);
            font-size: var(--font-size-lg);
            font-weight: 600;
        }
        
        .membership-plans {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--spacing-xl);
            margin: var(--spacing-xxl) 0;
        }
        
        .membership-plan {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xxl);
            text-align: center;
            box-shadow: var(--shadow-lg);
            transition: all var(--transition-md);
            position: relative;
            overflow: hidden;
            border: 3px solid transparent;
        }
        
        .membership-plan:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-xl);
        }
        
        .membership-plan.featured {
            border-color: var(--warning);
            transform: scale(1.05);
        }
        
        .membership-plan.featured::before {
            content: 'POPULAR';
            position: absolute;
            top: 20px;
            right: -35px;
            background: var(--warning);
            color: var(--dark);
            padding: var(--spacing-sm) var(--spacing-xl);
            transform: rotate(45deg);
            font-weight: 800;
            font-size: var(--font-size-sm);
        }
        
        .membership-plan h5 {
            font-size: var(--font-size-xl);
            font-weight: 800;
            margin-bottom: var(--spacing-lg);
            color: var(--primary);
        }
        
        .plan-price {
            font-size: var(--font-size-giant);
            font-weight: 900;
            color: var(--primary);
            margin: var(--spacing-xl) 0;
        }
        
        .plan-price span {
            font-size: var(--font-size-md);
            color: var(--gray);
            font-weight: 600;
        }
        
        .plan-features {
            list-style: none;
            padding: 0;
            margin: var(--spacing-xl) 0;
            text-align: left;
        }
        
        .plan-features li {
            margin-bottom: var(--spacing-md);
            padding-left: var(--spacing-xl);
            position: relative;
        }
        
        .plan-features li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--success);
            font-weight: 800;
        }
        
        .plan-features li.disabled {
            color: var(--gray);
            text-decoration: line-through;
        }
        
        .plan-features li.disabled::before {
            content: 'âœ—';
            color: var(--danger);
        }
        
        /* ===== ENHANCED DATA ENTRY STYLES ===== */
        .data-entry-container {
            background: white;
            border-radius: var(--border-radius-xl);
            padding: var(--spacing-xxl);
            box-shadow: var(--shadow-xl);
            margin-bottom: var(--spacing-xl);
        }
        
        .data-entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding-bottom: var(--spacing-lg);
            border-bottom: 3px solid var(--border);
        }
        
        .data-entry-controls {
            display: flex;
            gap: var(--spacing-lg);
            flex-wrap: wrap;
            margin-bottom: var(--spacing-xl);
        }
        
        .data-entry-table-container {
            overflow-x: auto;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            border: 3px solid var(--border);
            margin-bottom: var(--spacing-xl);
        }
        
        .data-entry-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        
        .data-entry-table th {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-lg);
            text-align: left;
            font-weight: 800;
            position: sticky;
            top: 0;
            border-right: 1px solid rgba(255,255,255,0.2);
            min-width: 200px;
        }
        
        .data-entry-table td {
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            background: white;
            transition: background var(--transition-sm);
            min-width: 200px;
        }
        
        .data-entry-table td:focus {
            background: #fff9c4;
            outline: 3px solid var(--warning);
        }
        
        .data-entry-table tr:nth-child(even) td {
            background: #f8f9fa;
        }
        
        .data-entry-table tr:hover td {
            background: #e9ecef;
        }
        
        .data-entry-cell {
            width: 100%;
            height: 50px;
            padding: var(--spacing-md);
            border: none;
            background: transparent;
            font-family: inherit;
            font-size: inherit;
            outline: none;
        }
        
        .data-entry-cell:focus {
            outline: none;
            background: #fff9c4;
        }
        
        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .column-actions {
            display: flex;
            gap: var(--spacing-xs);
        }
        
        .column-action-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: var(--border-radius-round);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all var(--transition-sm);
        }
        
        .column-action-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        .row-actions {
            display: flex;
            gap: var(--spacing-xs);
        }
        
        .row-action-btn {
            background: var(--light);
            border: 2px solid var(--border);
            width: 36px;
            height: 36px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: var(--font-size-sm);
            transition: all var(--transition-sm);
        }
        
        .row-action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .data-entry-stats {
            display: flex;
            justify-content: space-between;
            margin-top: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--gradient-light);
            border-radius: var(--border-radius-lg);
            font-weight: 800;
            font-size: var(--font-size-md);
        }
        
        .data-entry-stats div {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .data-entry-stats span:first-child {
            font-size: var(--font-size-xxl);
            font-weight: 900;
            color: var(--primary);
        }
        
        .data-entry-stats span:last-child {
            font-size: var(--font-size-sm);
            color: var(--gray);
            font-weight: 600;
        }
        
        /* ===== NOTIFICATION SYSTEM ===== */
        .notification-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: var(--z-index-toast);
            max-width: 400px;
        }
        
        .notification {
            background: white;
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-md);
            box-shadow: var(--shadow-xl);
            border-left: 6px solid var(--primary);
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            animation: slideInRight var(--transition-md);
            transform-origin: right;
        }
        
        .notification.success {
            border-left-color: var(--success);
        }
        
        .notification.error {
            border-left-color: var(--danger);
        }
        
        .notification.warning {
            border-left-color: var(--warning);
        }
        
        .notification.info {
            border-left-color: var(--info);
        }
        
        .notification i {
            font-size: var(--font-size-xl);
        }
        
        .notification.success i {
            color: var(--success);
        }
        
        .notification.error i {
            color: var(--danger);
        }
        
        .notification.warning i {
            color: var(--warning);
        }
        
        .notification.info i {
            color: var(--info);
        }
        
        .notification-content {
            flex: 1;
        }
        
        .notification-title {
            font-weight: 800;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-md);
        }
        
        .notification-message {
            font-size: var(--font-size-sm);
            color: var(--gray);
        }
        
        .notification-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: var(--font-size-lg);
            padding: var(--spacing-xs);
            border-radius: var(--border-radius-round);
            transition: all var(--transition-sm);
        }
        
        .notification-close:hover {
            color: var(--danger);
            background: rgba(220,53,69,0.1);
        }
        
        /* ===== PROGRESS BAR STYLES ===== */
        .progress {
            height: 12px;
            background: var(--light);
            border-radius: 6px;
            overflow: hidden;
            margin: var(--spacing-md) 0;
            box-shadow: inset var(--shadow-sm);
        }
        
        .progress-bar {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 6px;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        .progress-bar.success {
            background: var(--gradient-success);
        }
        
        .progress-bar.warning {
            background: var(--gradient-warning);
        }
        
        .progress-bar.danger {
            background: var(--gradient-danger);
        }
        
        .progress-bar.info {
            background: var(--gradient-info);
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-xs);
            font-size: var(--font-size-sm);
            font-weight: 600;
        }
        
        /* ===== RATING STYLES ===== */
        .rating {
            display: flex;
            gap: var(--spacing-xs);
        }
        
        .rating-star {
            color: var(--gray-light);
            font-size: var(--font-size-lg);
            cursor: pointer;
            transition: all var(--transition-sm);
        }
        
        .rating-star.active {
            color: var(--warning);
            transform: scale(1.2);
        }
        
        .rating-star:hover {
            color: var(--warning);
            transform: scale(1.1);
        }
        
        /* ===== CHAT STYLES ===== */
        .chat-container {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            height: 500px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-lg);
            text-align: center;
            font-weight: 800;
            font-size: var(--font-size-lg);
        }
        
        .chat-messages {
            flex: 1;
            padding: var(--spacing-lg);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
        }
        
        .chat-message {
            max-width: 80%;
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--border-radius-lg);
            position: relative;
        }
        
        .chat-message.sent {
            background: var(--gradient-primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: var(--border-radius-xs);
        }
        
        .chat-message.received {
            background: var(--light);
            color: var(--dark);
            align-self: flex-start;
            border-bottom-left-radius: var(--border-radius-xs);
        }
        
        .chat-input {
            padding: var(--spacing-lg);
            border-top: 2px solid var(--border);
            display: flex;
            gap: var(--spacing-md);
        }
        
        .chat-input input {
            flex: 1;
            padding: var(--spacing-md);
            border: 2px solid var(--border);
            border-radius: var(--border-radius-md);
            font-size: var(--font-size-md);
        }
        
        .chat-input input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* ===== CALENDAR STYLES ===== */
        .calendar {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }
        
        .calendar-header {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-xl);
            text-align: center;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: var(--border);
        }
        
        .calendar-day {
            background: white;
            padding: var(--spacing-md);
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }
        
        .calendar-day.header {
            background: var(--light);
            font-weight: 800;
            color: var(--primary);
            min-height: auto;
        }
        
        .calendar-day.today {
            background: var(--gradient-primary);
            color: white;
        }
        
        .calendar-event {
            background: var(--success);
            color: white;
            padding: 2px 6px;
            border-radius: var(--border-radius-xs);
            font-size: var(--font-size-xs);
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* ===== PAGINATION STYLES ===== */
        .pagination {
            display: flex;
            justify-content: center;
            gap: var(--spacing-xs);
            margin: var(--spacing-xl) 0;
        }
        
        .page-item {
            display: inline-block;
        }
        
        .page-link {
            padding: var(--spacing-md) var(--spacing-lg);
            border: 2px solid var(--border);
            background: white;
            color: var(--primary);
            font-weight: 700;
            text-decoration: none;
            border-radius: var(--border-radius-md);
            transition: all var(--transition-md);
        }
        
        .page-link:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-item.active .page-link {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .page-item.disabled .page-link {
            background: var(--light);
            color: var(--gray);
            cursor: not-allowed;
        }
        
        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1400px) {
            .tasks-grid, .my-tasks-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            }
            
            .advanced-tools {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
        }
        
        @media (max-width: 1200px) {
            .membership-plans {
                grid-template-columns: 1fr;
                max-width: 500px;
                margin-left: auto;
                margin-right: auto;
            }
            
            .membership-plan.featured {
                transform: none;
            }
        }
        
        @media (max-width: 992px) {
            .page-header h1 {
                font-size: var(--font-size-xxxl);
            }
            
            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tasks-grid, .my-tasks-grid {
                grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            }
            
            .filters-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .modal-content {
                padding: var(--spacing-xxl) var(--spacing-xl);
            }
            
            .payment-content {
                padding: var(--spacing-xl);
            }
        }
        
        @media (max-width: 768px) {
            .header-right .user-info {
                display: none;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            nav {
                position: fixed;
                top: 80px;
                left: 0;
                height: calc(100vh - 80px);
                transform: translateX(-100%);
                z-index: var(--z-index-sticky);
                background: white;
                width: 300px;
            }
            
            nav.active {
                transform: translateX(0);
            }
            
            .stats-cards {
                grid-template-columns: 1fr;
            }
            
            .tasks-grid, .my-tasks-grid {
                grid-template-columns: 1fr;
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .task-header {
                flex-direction: column;
                gap: var(--spacing-md);
                align-items: flex-start;
            }
            
            .task-reward {
                text-align: left;
                align-items: flex-start;
            }
            
            .tasks-tabs {
                flex-wrap: wrap;
            }
            
            .refresh-indicator {
                flex-direction: column;
                text-align: center;
                gap: var(--spacing-lg);
            }
            
            .admin-review-notice {
                flex-direction: column;
                text-align: center;
                gap: var(--spacing-lg);
            }
            
            .modal-content {
                padding: var(--spacing-xl) var(--spacing-lg);
            }
            
            .toolbar {
                justify-content: center;
            }
            
            .page-header {
                padding: var(--spacing-xxl) var(--spacing-xl);
            }
            
            .page-header h1 {
                font-size: var(--font-size-xxl);
            }
            
            .advanced-tools {
                grid-template-columns: 1fr 1fr;
            }
            
            .payment-actions {
                flex-direction: column;
            }
            
            .payment-content {
                padding: var(--spacing-lg);
            }
            
            main {
                padding: var(--spacing-xl);
            }
            
            .section-header {
                flex-direction: column;
                gap: var(--spacing-lg);
                align-items: stretch;
            }
            
            .section-actions {
                justify-content: center;
            }
            
            .data-entry-controls {
                justify-content: center;
            }
            
            .data-entry-stats {
                flex-direction: column;
                gap: var(--spacing-lg);
            }
        }
        
        @media (max-width: 576px) {
            .page-header h1 {
                font-size: var(--font-size-xl);
            }
            
            .stat-value {
                font-size: var(--font-size-xxxl);
            }
            
            .task-title {
                font-size: var(--font-size-lg);
            }
            
            .task-reward {
                font-size: var(--font-size-xxl);
            }
            
            .advanced-tools {
                grid-template-columns: 1fr;
            }
            
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .tool-btn {
                width: 100%;
                text-align: center;
                justify-content: center;
            }
            
            .task-actions {
                flex-direction: column;
            }
            
            .payment-steps ol {
                padding-left: var(--spacing-lg);
            }
            
            .payment-content {
                padding: var(--spacing-md);
            }
            
            .manual-payment-section {
                padding: var(--spacing-lg);
            }
            
            .mpesa-number-display {
                font-size: var(--font-size-md);
                padding: var(--spacing-md);
            }
            
            .payment-header h2 {
                font-size: var(--font-size-xl);
            }
            
            .payment-amount {
                font-size: var(--font-size-xxxl);
            }
            
            .tab-btn {
                padding: var(--spacing-md) var(--spacing-lg);
                font-size: var(--font-size-sm);
            }
            
            .btn {
                padding: var(--spacing-md) var(--spacing-lg);
                font-size: var(--font-size-sm);
            }
        }
        
        @media (max-width: 400px) {
            .header-left h1 {
                font-size: var(--font-size-xl);
            }
            
            .page-header {
                padding: var(--spacing-xl);
            }
            
            .my-tasks-section, .filters-section {
                padding: var(--spacing-xl);
            }
            
            .modal-content {
                padding: var(--spacing-xl) var(--spacing-md);
            }
            
            .payment-content {
                padding: var(--spacing-md) var(--spacing-sm);
            }
            
            .notification-container {
                left: 10px;
                right: 10px;
                max-width: none;
            }
        }
        
        /* ===== DARK MODE SUPPORT ===== */
        @media (prefers-color-scheme: dark) {
            :root {
                --primary: #3a6fc8;
                --primary-dark: #2a5db0;
                --light: #343a40;
                --dark: #f8f9fa;
                --gray: #adb5bd;
                --border: #495057;
                --gradient-light: linear-gradient(135deg, #343a40, #495057);
                --gradient-card: linear-gradient(135deg, #212529, #343a40);
            }
            
            body {
                background: linear-gradient(135deg, #212529 0%, #343a40 100%);
                color: var(--dark);
            }
            
            .task-card, .stat-card, .my-tasks-section, .filters-section, .workspace-area, .modal-content, .payment-content {
                background: var(--gradient-card);
                color: var(--dark);
            }
            
            .text-editor, .data-entry-cell, .transaction-message-box, .mpesa-code-input {
                background: #343a40;
                color: var(--dark);
                border-color: #495057;
            }
            
            .file-upload-area {
                background: rgba(52, 58, 64, 0.5);
            }
        }
        
        /* ===== PRINT STYLES ===== */
        @media print {
            header, nav, .filters-section, .task-actions, .btn, .modal, .payment-modal {
                display: none !important;
            }
            
            .container {
                display: block;
            }
            
            main {
                padding: 0;
            }
            
            .task-card {
                break-inside: avoid;
                box-shadow: none;
                border: 1px solid #000;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Loading Academic Writing Hub...</p>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <header>
        <div class="header-left">
            <h1>Academic Writing Hub</h1>
            <div class="slogan">Empowering Academic Excellence Through Quality Writing Services</div>
        </div>
        <div class="header-right">
            <div class="notification-bell" id="notificationBell">
                <i class="fas fa-bell"></i>
                <span class="notification-count" id="notificationCount">3</span>
            </div>
            <div class="user-menu" id="userMenu">
                <div class="user-avatar" id="userAvatar">U</div>
                <div class="user-info">
                    <span class="user-name" id="userName">Loading User...</span>
                    <span class="user-role" id="userRole">Member</span>
                </div>
                <i class="fas fa-chevron-down"></i>
            </div>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <div class="container">
        <nav id="sidebar">
            <a href="dashboard.html">
                <i class="fas fa-home"></i>
                Dashboard
            </a>
            <a href="membership.html">
                <i class="fas fa-crown"></i>
                Membership
            </a>
            <a href="tasks.html" class="active">
                <i class="fas fa-tasks"></i>
                Tasks
                <span class="badge badge-primary" id="tasksBadge">0</span>
            </a>
            <a href="withdraw.html">
                <i class="fas fa-wallet"></i>
                Withdraw
            </a>
            <a href="referrals.html">
                <i class="fas fa-users"></i>
                Referrals
            </a>
            <a href="profile.html">
                <i class="fas fa-user"></i>
                Profile
            </a>
            <a href="support.html">
                <i class="fas fa-headset"></i>
                Support
            </a>
            <a href="leaderboard.html">
                <i class="fas fa-trophy"></i>
                Leaderboard
            </a>
            <a href="calendar.html">
                <i class="fas fa-calendar"></i>
                Calendar
            </a>
            <a href="settings.html">
                <i class="fas fa-cog"></i>
                Settings
            </a>
            <a href="#" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i>
                Logout
            </a>
            
            <div class="nav-footer">
                <div class="nav-stats">
                    <div>
                        <span>Online Users:</span>
                        <span id="onlineUsers">1,234</span>
                    </div>
                    <div>
                        <span>Tasks Completed:</span>
                        <span id="globalTasks">45,678</span>
                    </div>
                    <div>
                        <span>Total Earnings:</span>
                        <span id="globalEarnings">KSh 12.5M</span>
                    </div>
                </div>
            </div>
        </nav>

        <main>
            <div class="page-header">
                <h1><i class="fas fa-tasks"></i> Available Tasks</h1>
                <p>Complete academic writing tasks to earn money. Filter by type, difficulty, or deadline to find tasks that match your expertise. Every completed task contributes to your academic and financial growth!</p>
                <div class="page-header-actions">
                    <button class="btn btn-primary" id="quickTaskBtn">
                        <i class="fas fa-bolt"></i>
                        Quick Task
                    </button>
                    <button class="btn btn-outline-primary" id="refreshTasksBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh Tasks
                    </button>
                    <button class="btn btn-outline-secondary" id="viewGuidelinesBtn">
                        <i class="fas fa-book"></i>
                        View Guidelines
                    </button>
                </div>
            </div>

            <div class="admin-review-notice">
                <div class="icon"><i class="fas fa-clock"></i></div>
                <div class="content">
                    <h4>Task Review Schedule Update</h4>
                    <p><strong>Admin reviews submitted tasks every Tuesday and Thursday from 9 AM to 5 PM.</strong> Plan your submissions to ensure timely approval and payment. Urgent reviews available for premium members.</p>
                </div>
                <button class="close-notice" id="closeNoticeBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="refresh-indicator">
                <div class="icon"><i class="fas fa-sync-alt"></i></div>
                <div class="info">
                    <h4>Intelligent Auto-Refresh System</h4>
                    <p>Tasks refresh automatically every 6 hours. New tasks are added based on your performance and membership level. Next refresh in:</p>
                </div>
                <div class="refresh-countdown" id="refreshCountdown">
                    <i class="fas fa-clock"></i>
                    <span id="countdownTimer">05:43:21</span>
                </div>
            </div>

            <div class="stats-cards">
                <div class="stat-card balance">
                    <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                    <div class="stat-value" id="balanceAmount">KSh 0.00</div>
                    <div class="stat-label">Available Balance</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        12% this week
                    </div>
                </div>
                <div class="stat-card tasks">
                    <div class="stat-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-value" id="completedTasks">0</div>
                    <div class="stat-label">Completed Tasks</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        3 today
                    </div>
                </div>
                <div class="stat-card earnings">
                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="stat-value" id="totalEarnings">KSh 0.00</div>
                    <div class="stat-label">Total Earnings</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        24% growth
                    </div>
                </div>
                <div class="stat-card pending">
                    <div class="stat-icon"><i class="fas fa-clock"></i></div>
                    <div class="stat-value" id="pendingEarnings">KSh 0.00</div>
                    <div class="stat-label">Pending Review</div>
                    <div class="stat-trend neutral">
                        <i class="fas fa-minus"></i>
                        Stable
                    </div>
                </div>
                <div class="stat-card available">
                    <div class="stat-icon"><i class="fas fa-briefcase"></i></div>
                    <div class="stat-value" id="availableTasks">0</div>
                    <div class="stat-label">Available Tasks</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        5 new
                    </div>
                </div>
                <div class="stat-card rating">
                    <div class="stat-icon"><i class="fas fa-star"></i></div>
                    <div class="stat-value" id="userRating">0.0</div>
                    <div class="stat-label">Quality Rating</div>
                    <div class="stat-trend positive">
                        <i class="fas fa-arrow-up"></i>
                        Improving
                    </div>
                </div>
            </div>

            <div class="my-tasks-section">
                <div class="section-header">
                    <h3><i class="fas fa-history"></i> My Tasks History</h3>
                    <div class="section-actions">
                        <button class="btn btn-sm btn-outline-primary" id="exportHistoryBtn">
                            <i class="fas fa-download"></i>
                            Export
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" id="clearHistoryBtn">
                            <i class="fas fa-trash"></i>
                            Clear Filters
                        </button>
                    </div>
                </div>
                
                <div class="tasks-summary">
                    <div class="tasks-summary-grid">
                        <div class="summary-item summary-total">
                            <div class="summary-value" id="totalTasksCount">0</div>
                            <div class="summary-label">Total Tasks</div>
                        </div>
                        <div class="summary-item summary-approved">
                            <div class="summary-value" id="approvedTasksCount">0</div>
                            <div class="summary-label">Approved</div>
                        </div>
                        <div class="summary-item summary-pending">
                            <div class="summary-value" id="pendingTasksCount">0</div>
                            <div class="summary-label">Under Review</div>
                        </div>
                        <div class="summary-item summary-progress">
                            <div class="summary-value" id="inProgressTasksCount">0</div>
                            <div class="summary-label">In Progress</div>
                        </div>
                        <div class="summary-item summary-rejected">
                            <div class="summary-value" id="rejectedTasksCount">0</div>
                            <div class="summary-label">Rejected</div>
                        </div>
                        <div class="summary-item summary-expired">
                            <div class="summary-value" id="expiredTasksCount">0</div>
                            <div class="summary-label">Expired</div>
                        </div>
                    </div>
                </div>

                <div class="tasks-tabs">
                    <button class="tab-btn active" data-tab="all-tasks">
                        All Tasks
                        <span class="badge" id="allTasksBadge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="in-progress">
                        In Progress
                        <span class="badge" id="inProgressBadge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="submitted">
                        Under Review
                        <span class="badge" id="submittedBadge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="completed">
                        Approved
                        <span class="badge" id="completedBadge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="rejected">
                        Rejected
                        <span class="badge" id="rejectedBadge">0</span>
                    </button>
                    <button class="tab-btn" data-tab="expired">
                        Expired
                        <span class="badge" id="expiredBadge">0</span>
                    </button>
                </div>

                <div class="my-tasks-grid" id="myTasksContainer">
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                    <div class="skeleton-card"></div>
                </div>
            </div>

            <div class="filters-section">
                <div class="section-header">
                    <h3><i class="fas fa-filter"></i> Advanced Task Filters</h3>
                    <div class="section-actions">
                        <button class="btn btn-sm btn-primary" id="applyFiltersBtn">
                            <i class="fas fa-check"></i>
                            Apply Filters
                        </button>
                        <button class="btn btn-sm btn-outline-danger" id="resetFiltersBtn">
                            <i class="fas fa-times"></i>
                            Reset All
                        </button>
                    </div>
                </div>
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="taskType">
                            <i class="fas fa-tag"></i>
                            Task Type
                        </label>
                        <select id="taskType">
                            <option value="all">All Types</option>
                            <option value="academic_writing">Academic Writing</option>
                            <option value="academic_research">Academic Research</option>
                            <option value="content_writing">Content Writing</option>
                            <option value="data_entry">Data Entry</option>
                            <option value="transcription">Audio Transcription</option>
                            <option value="proofreading">Proofreading</option>
                            <option value="editing">Editing</option>
                            <option value="formatting">Formatting</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="difficulty">
                            <i class="fas fa-signal"></i>
                            Difficulty Level
                        </label>
                        <select id="difficulty">
                            <option value="all">All Levels</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                            <option value="expert">Expert</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="membership">
                            <i class="fas fa-crown"></i>
                            Required Membership
                        </label>
                        <select id="membership">
                            <option value="all">All Levels</option>
                            <option value="starter">Starter (KSh 3,500)</option>
                            <option value="pro">Pro (KSh 5,500)</option>
                            <option value="premium">Premium (KSh 8,000)</option>
                            <option value="elite">Elite (KSh 12,000)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="rewardRange">
                            <i class="fas fa-money-bill-wave"></i>
                            Reward Range
                        </label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="minReward" placeholder="Min" min="0" style="flex: 1;">
                            <span>to</span>
                            <input type="number" id="maxReward" placeholder="Max" min="0" style="flex: 1;">
                        </div>
                    </div>
                    <div class="filter-group search-box">
                        <label for="search">
                            <i class="fas fa-search"></i>
                            Search Tasks
                        </label>
                        <span class="search-icon"><i class="fas fa-search"></i></span>
                        <input type="text" id="search" placeholder="Search by title, description, or keywords...">
                    </div>
                    <div class="filter-group">
                        <label for="sortBy">
                            <i class="fas fa-sort-amount-down"></i>
                            Sort By
                        </label>
                        <select id="sortBy">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="reward_high">Highest Reward</option>
                            <option value="reward_low">Lowest Reward</option>
                            <option value="deadline">Closest Deadline</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="biddersFilter">
                            <i class="fas fa-users"></i>
                            Bidders Status
                        </label>
                        <select id="biddersFilter">
                            <option value="all">All Tasks</option>
                            <option value="available">Available Slots</option>
                            <option value="full">Full</option>
                            <option value="limited">Limited Slots</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="deadlineFilter">
                            <i class="fas fa-calendar-alt"></i>
                            Deadline
                        </label>
                        <select id="deadlineFilter">
                            <option value="all">All Deadlines</option>
                            <option value="today">Today</option>
                            <option value="tomorrow">Tomorrow</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="urgent">Urgent (24h)</option>
                        </select>
                    </div>
                </div>
                
                <div class="filter-actions">
                    <button class="btn btn-sm btn-outline-primary" id="saveFilterBtn">
                        <i class="fas fa-save"></i>
                        Save Filter
                    </button>
                    <button class="btn btn-sm btn-outline-secondary" id="loadFilterBtn">
                        <i class="fas fa-folder-open"></i>
                        Load Saved
                    </button>
                    <div style="flex: 1;"></div>
                    <span class="badge badge-info" id="filterResults">0 tasks found</span>
                </div>
            </div>

            <div id="messageContainer"></div>

            <div class="tasks-grid" id="tasksContainer">
                <!-- Tasks will be loaded here dynamically -->
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
                <div class="skeleton-card"></div>
            </div>

            <div class="pagination" id="paginationContainer">
                <!-- Pagination will be loaded here -->
            </div>
        </main>
    </div>

    <!-- Task Modal with Advanced Workspace -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <span class="close-modal" id="closeTaskModal">&times;</span>
            <div class="modal-header">
                <h2 id="modalTitle">Task Details</h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <span class="badge" id="modalTypeBadge">Academic Writing</span>
                    <span class="badge" id="modalDifficultyBadge">Intermediate</span>
                    <span class="badge" id="modalStatusBadge">Available</span>
                    <span class="badge badge-success" id="modalRewardBadge">KSh 2,500</span>
                </div>
            </div>
            <div class="modal-body">
                <div id="modalContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="closeModalBtn">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-primary" id="startTaskBtn" style="display: none;">
                    <i class="fas fa-play"></i>
                    Start Task
                </button>
                <button class="btn btn-success" id="submitTaskBtn" style="display: none;">
                    <i class="fas fa-paper-plane"></i>
                    Submit Task
                </button>
                <button class="btn btn-warning" id="saveDraftBtn" style="display: none;">
                    <i class="fas fa-save"></i>
                    Save Draft
                </button>
            </div>
        </div>
    </div>

    <!-- Manual Payment Modal -->
    <div class="payment-modal" id="manualPaymentModal">
        <div class="payment-content">
            <span class="close-modal" id="closeManualPaymentModal">&times;</span>
            <div class="payment-header">
                <h2><i class="fas fa-lock"></i> Purchase Task Access</h2>
                <p id="manualPaymentDescription">Complete payment to access this premium task</p>
            </div>
            
            <div class="payment-amount" id="manualPaymentAmount">KSh 0</div>
            
            <div class="manual-payment-section">
                <h4><i class="fas fa-mobile-alt"></i> Manual M-Pesa Payment</h4>
                <p>Send payment directly to our M-Pesa number and paste the confirmation message below for verification.</p>
                
                <div style="margin: 25px 0;">
                    <strong>M-Pesa Number:</strong>
                    <div class="mpesa-number-display" id="mpesaNumberDisplay">Loading...</div>
                    <button class="copy-btn" id="copyMpesaNumber">
                        <i class="fas fa-copy"></i>
                        Copy Number
                    </button>
                </div>
                
                <div class="payment-steps">
                    <h4><i class="fas fa-list-ol"></i> Payment Instructions</h4>
                    <ol>
                        <li>Go to M-Pesa on your phone</li>
                        <li>Select <strong>Send Money</strong></li>
                        <li>Enter Phone Number: <strong id="displayMpesaNumber">0780619918</strong></li>
                        <li>Enter Amount: <strong id="manualMpesaAmount">0</strong></li>
                        <li>Enter your M-Pesa PIN</li>
                        <li>Wait for confirmation message</li>
                        <li>Copy the entire message and paste it below</li>
                    </ol>
                </div>
                
                <div class="form-group">
                    <label for="transactionMessage" style="display: block; margin-bottom: 10px; font-weight: 600;">
                        <i class="fas fa-comment-alt"></i>
                        Paste M-Pesa Confirmation Message
                    </label>
                    <textarea id="transactionMessage" class="transaction-message-box" placeholder="Paste the complete M-Pesa confirmation message here..."></textarea>
                    <small style="display: block; margin-top: 8px; color: var(--gray);">
                        <i class="fas fa-info-circle"></i>
                        Paste the complete message you received from M-Pesa after payment
                    </small>
                </div>
                
                <div class="payment-status-indicator pending" id="paymentStatusIndicator" style="display: none;">
                    <i class="fas fa-clock"></i>
                    Payment Under Review - Admin will approve within 24 hours
                </div>
            </div>
            
            <div class="payment-actions">
                <button class="btn btn-success" id="submitPayment">
                    <i class="fas fa-check-circle"></i>
                    Submit Payment for Review
                </button>
                <button class="btn btn-danger" id="cancelManualPayment">
                    <i class="fas fa-times"></i>
                    Cancel
                </button>
            </div>
        </div>
    </div>

    <!-- Membership Upgrade Modal -->
    <div class="modal" id="membershipUpgradeModal">
        <div class="modal-content">
            <span class="close-modal" id="closeMembershipUpgradeModal">&times;</span>
            <div class="payment-header">
                <h2><i class="fas fa-crown"></i> Membership Upgrade Required</h2>
                <p>Upgrade your membership to access premium tasks and features</p>
            </div>
            
            <div class="membership-upgrade-prompt">
                <h4>Unlock Higher Earning Potential</h4>
                <p>This task requires <strong id="requiredMembershipLevel">Premium</strong> membership level. Upgrade now to unlock access to higher-paying tasks and exclusive features.</p>
                
                <div class="membership-plans">
                    <div class="membership-plan">
                        <h5>Starter</h5>
                        <div class="plan-price">KSh 3,500<span>/month</span></div>
                        <ul class="plan-features">
                            <li>Basic academic tasks</li>
                            <li>Up to 5 tasks per day</li>
                            <li>Standard support</li>
                            <li>Basic earning rate</li>
                            <li class="disabled">Premium tasks</li>
                            <li class="disabled">Priority support</li>
                            <li class="disabled">Advanced tools</li>
                        </ul>
                        <button class="btn btn-outline-primary" onclick="selectMembership('starter')">
                            Select Starter
                        </button>
                    </div>
                    
                    <div class="membership-plan featured">
                        <h5>Pro</h5>
                        <div class="plan-price">KSh 5,500<span>/month</span></div>
                        <ul class="plan-features">
                            <li>All starter features</li>
                            <li>Up to 15 tasks per day</li>
                            <li>Priority support</li>
                            <li>20% higher earnings</li>
                            <li>Access to pro tasks</li>
                            <li>Advanced writing tools</li>
                            <li class="disabled">Elite tasks</li>
                        </ul>
                        <button class="btn btn-warning" onclick="selectMembership('pro')">
                            Upgrade to Pro
                        </button>
                    </div>
                    
                    <div class="membership-plan">
                        <h5>Premium</h5>
                        <div class="plan-price">KSh 8,000<span>/month</span></div>
                        <ul class="plan-features">
                            <li>All pro features</li>
                            <li>Unlimited tasks</li>
                            <li>VIP support</li>
                            <li>40% higher earnings</li>
                            <li>All premium tasks</li>
                            <li>All advanced tools</li>
                            <li>Early access to tasks</li>
                        </ul>
                        <button class="btn btn-success" onclick="selectMembership('premium')">
                            Upgrade to Premium
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="payment-actions">
                <button class="btn btn-primary" id="goToMembershipPage">
                    <i class="fas fa-arrow-right"></i>
                    Upgrade Now
                </button>
                <button class="btn btn-danger" id="cancelUpgrade">
                    <i class="fas fa-times"></i>
                    Maybe Later
                </button>
            </div>
        </div>
    </div>

    <!-- Task Guidelines Modal -->
    <div class="modal" id="guidelinesModal">
        <div class="modal-content">
            <span class="close-modal" id="closeGuidelinesModal">&times;</span>
            <div class="modal-header">
                <h2><i class="fas fa-book"></i> Task Submission Guidelines</h2>
            </div>
            <div class="modal-body">
                <div class="transcription-guidelines">
                    <h4><i class="fas fa-clipboard-check"></i> General Guidelines</h4>
                    <ul>
                        <li>All submissions must be original work - plagiarism will result in immediate rejection</li>
                        <li>Follow the specific requirements provided for each task</li>
                        <li>Submit before the deadline to avoid expiration</li>
                        <li>Use proper formatting and citations where required</li>
                        <li>Check your work for grammar and spelling errors</li>
                    </ul>
                </div>
                
                <div class="transcription-guidelines" style="background: linear-gradient(135deg, #e7f5ee, #d4edda); border-left-color: var(--success);">
                    <h4><i class="fas fa-file-alt"></i> Academic Writing Guidelines</h4>
                    <ul>
                        <li>Use formal academic language</li>
                        <li>Include proper citations (APA, MLA, or Chicago style)</li>
                        <li>Maintain academic integrity</li>
                        <li>Follow the specified word count</li>
                        <li>Include a bibliography/reference list</li>
                    </ul>
                </div>
                
                <div class="transcription-guidelines" style="background: linear-gradient(135deg, #fff3cd, #ffeaa7); border-left-color: var(--warning);">
                    <h4><i class="fas fa-exclamation-triangle"></i> Important Notes</h4>
                    <ul>
                        <li>Tasks expire after deadline - expired tasks cannot be submitted</li>
                        <li>Each task has limited slots - first come, first served</li>
                        <li>Quality rating affects your future task access</li>
                        <li>Repeated rejections may limit your account</li>
                        <li>Always save your work before submitting</li>
                    </ul>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="closeGuidelinesBtn">
                    <i class="fas fa-check"></i>
                    I Understand
                </button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="payment-header">
                <h2 style="color: var(--success);"><i class="fas fa-check-circle"></i> Success!</h2>
                <p id="successMessage">Operation completed successfully</p>
            </div>
            <div class="modal-body" style="text-align: center; padding: 40px;">
                <i class="fas fa-check-circle" style="font-size: 80px; color: var(--success); margin-bottom: 30px;"></i>
                <h3 id="successTitle">Task Submitted Successfully</h3>
                <p id="successDescription">Your task has been submitted for review. You will be notified when it's approved.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-success" id="closeSuccessModal">
                    <i class="fas fa-check"></i>
                    Continue
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script>
        // ===== SUPABASE CONFIGURATION =====
        const SUPABASE_URL = "https://lfrjtklkbppihaaiuxef.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxmcmp0a2xrYnBwaWhhYWl1eGVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwNTI5MzMsImV4cCI6MjA3NDYyODkzM30.2FVqnt5daF2Tw-RmVBwOGgt4GuIQQSkG8IUZt30QxIM";

        // Initialize Supabase client
        let supabaseClient;
        try {
            supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('Supabase client initialized successfully');
        } catch (error) {
            console.error('Failed to initialize Supabase:', error);
            showNotification('Failed to initialize application', 'error');
        }

        // Global variables
        let currentUser = null;
        let userProfile = null;
        let allTasks = [];
        let userTasks = [];
        let filteredTasks = [];
        let currentTab = 'all-tasks';
        let currentTaskId = null;
        let currentTask = null;
        let audioPlayer = null;
        let isPlaying = false;
        let searchTimeout;
        let timerInterval = null;
        let timerSeconds = 0;
        let isTimerRunning = false;
        let isAssigningTask = false;
        let currentUserTask = null;
        let currentPaymentType = null;
        let currentPaymentAmount = 0;
        let dataEntryTable = null;
        let dataEntryRows = 5;
        let dataEntryCols = 4;
        let ADMIN_MPESA_NUMBER = "0780619918";
        const TRANSCRIPTION_ACCESS_FEE = 200;
        let currentPage = 1;
        let tasksPerPage = 12;
        let totalPages = 1;
        let savedFilters = [];
        let notifications = [];
        let autoSaveInterval = null;

        // Membership tiers with updated pricing
        const MEMBERSHIP_TIERS = {
            'starter': { name: 'Starter', price: 3500, level: 1, color: 'var(--primary)' },
            'pro': { name: 'Pro', price: 5500, level: 2, color: 'var(--warning)' },
            'premium': { name: 'Premium', price: 8000, level: 3, color: 'var(--success)' },
            'elite': { name: 'Elite', price: 12000, level: 4, color: 'var(--gold)' }
        };

        // Task types with icons
        const TASK_TYPES = {
            'academic_writing': { name: 'Academic Writing', icon: 'fas fa-graduation-cap', color: 'var(--primary)' },
            'academic_research': { name: 'Academic Research', icon: 'fas fa-search', color: 'var(--info)' },
            'content_writing': { name: 'Content Writing', icon: 'fas fa-pen-alt', color: 'var(--success)' },
            'data_entry': { name: 'Data Entry', icon: 'fas fa-table', color: 'var(--warning)' },
            'transcription': { name: 'Audio Transcription', icon: 'fas fa-headphones', color: 'var(--secondary)' },
            'proofreading': { name: 'Proofreading', icon: 'fas fa-check-double', color: 'var(--info)' },
            'editing': { name: 'Editing', icon: 'fas fa-edit', color: 'var(--primary-light)' },
            'formatting': { name: 'Formatting', icon: 'fas fa-align-left', color: 'var(--gray)' }
        };

        // Difficulty levels
        const DIFFICULTY_LEVELS = {
            'beginner': { name: 'Beginner', color: 'var(--success)', icon: 'fas fa-seedling' },
            'intermediate': { name: 'Intermediate', color: 'var(--warning)', icon: 'fas fa-tree' },
            'advanced': { name: 'Advanced', color: 'var(--danger)', icon: 'fas fa-mountain' },
            'expert': { name: 'Expert', color: 'var(--primary-dark)', icon: 'fas fa-crown' }
        };

        // DOM Elements
        const loadingOverlay = document.getElementById('loadingOverlay');
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebar = document.getElementById('sidebar');
        const logoutBtn = document.getElementById('logoutBtn');
        const tasksContainer = document.getElementById('tasksContainer');
        const myTasksContainer = document.getElementById('myTasksContainer');
        const messageContainer = document.getElementById('messageContainer');
        const refreshCountdown = document.getElementById('refreshCountdown');
        const countdownTimer = document.getElementById('countdownTimer');
        const taskModal = document.getElementById('taskModal');
        const closeTaskModalBtn = document.getElementById('closeTaskModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const startTaskBtn = document.getElementById('startTaskBtn');
        const submitTaskBtn = document.getElementById('submitTaskBtn');
        const saveDraftBtn = document.getElementById('saveDraftBtn');
        const modalContent = document.getElementById('modalContent');
        const modalTitle = document.getElementById('modalTitle');
        const modalTypeBadge = document.getElementById('modalTypeBadge');
        const modalDifficultyBadge = document.getElementById('modalDifficultyBadge');
        const modalStatusBadge = document.getElementById('modalStatusBadge');
        const modalRewardBadge = document.getElementById('modalRewardBadge');
        
        // Manual Payment Modal Elements
        const manualPaymentModal = document.getElementById('manualPaymentModal');
        const closeManualPaymentModalBtn = document.getElementById('closeManualPaymentModal');
        const manualPaymentTitle = document.getElementById('manualPaymentTitle');
        const manualPaymentDescription = document.getElementById('manualPaymentDescription');
        const manualPaymentAmount = document.getElementById('manualPaymentAmount');
        const manualMpesaAmount = document.getElementById('manualMpesaAmount');
        const mpesaNumberDisplay = document.getElementById('mpesaNumberDisplay');
        const displayMpesaNumber = document.getElementById('displayMpesaNumber');
        const copyMpesaNumberBtn = document.getElementById('copyMpesaNumber');
        const transactionMessage = document.getElementById('transactionMessage');
        const paymentStatusIndicator = document.getElementById('paymentStatusIndicator');
        const submitPaymentBtn = document.getElementById('submitPayment');
        const cancelManualPaymentBtn = document.getElementById('cancelManualPayment');
        
        // Membership Upgrade Modal Elements
        const membershipUpgradeModal = document.getElementById('membershipUpgradeModal');
        const closeMembershipUpgradeModalBtn = document.getElementById('closeMembershipUpgradeModal');
        const requiredMembershipLevel = document.getElementById('requiredMembershipLevel');
        const goToMembershipPageBtn = document.getElementById('goToMembershipPage');
        const cancelUpgradeBtn = document.getElementById('cancelUpgrade');
        
        // Guidelines Modal Elements
        const guidelinesModal = document.getElementById('guidelinesModal');
        const closeGuidelinesModalBtn = document.getElementById('closeGuidelinesModal');
        const closeGuidelinesBtn = document.getElementById('closeGuidelinesBtn');
        const viewGuidelinesBtn = document.getElementById('viewGuidelinesBtn');
        
        // Success Modal Elements
        const successModal = document.getElementById('successModal');
        const successMessage = document.getElementById('successMessage');
        const successTitle = document.getElementById('successTitle');
        const successDescription = document.getElementById('successDescription');
        const closeSuccessModalBtn = document.getElementById('closeSuccessModal');
        
        // Notification Elements
        const notificationBell = document.getElementById('notificationBell');
        const notificationCount = document.getElementById('notificationCount');
        const notificationContainer = document.getElementById('notificationContainer');
        
        // Filter Elements
        const taskTypeFilter = document.getElementById('taskType');
        const difficultyFilter = document.getElementById('difficulty');
        const membershipFilter = document.getElementById('membership');
        const minRewardFilter = document.getElementById('minReward');
        const maxRewardFilter = document.getElementById('maxReward');
        const searchFilter = document.getElementById('search');
        const sortByFilter = document.getElementById('sortBy');
        const biddersFilter = document.getElementById('biddersFilter');
        const deadlineFilter = document.getElementById('deadlineFilter');
        const applyFiltersBtn = document.getElementById('applyFiltersBtn');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const saveFilterBtn = document.getElementById('saveFilterBtn');
        const loadFilterBtn = document.getElementById('loadFilterBtn');
        const filterResults = document.getElementById('filterResults');
        const quickTaskBtn = document.getElementById('quickTaskBtn');
        const refreshTasksBtn = document.getElementById('refreshTasksBtn');
        
        // Pagination
        const paginationContainer = document.getElementById('paginationContainer');
        
        // Stats Elements
        const balanceAmount = document.getElementById('balanceAmount');
        const completedTasks = document.getElementById('completedTasks');
        const totalEarnings = document.getElementById('totalEarnings');
        const pendingEarnings = document.getElementById('pendingEarnings');
        const availableTasks = document.getElementById('availableTasks');
        const userRating = document.getElementById('userRating');
        const userName = document.getElementById('userName');
        const userRole = document.getElementById('userRole');
        const userAvatar = document.getElementById('userAvatar');
        
        // Task count badges
        const tasksBadge = document.getElementById('tasksBadge');
        const allTasksBadge = document.getElementById('allTasksBadge');
        const inProgressBadge = document.getElementById('inProgressBadge');
        const submittedBadge = document.getElementById('submittedBadge');
        const completedBadge = document.getElementById('completedBadge');
        const rejectedBadge = document.getElementById('rejectedBadge');
        const expiredBadge = document.getElementById('expiredBadge');
        
        // Task summary counts
        const totalTasksCount = document.getElementById('totalTasksCount');
        const approvedTasksCount = document.getElementById('approvedTasksCount');
        const pendingTasksCount = document.getElementById('pendingTasksCount');
        const inProgressTasksCount = document.getElementById('inProgressTasksCount');
        const rejectedTasksCount = document.getElementById('rejectedTasksCount');
        const expiredTasksCount = document.getElementById('expiredTasksCount');
        
        // Close notice button
        const closeNoticeBtn = document.getElementById('closeNoticeBtn');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // ===== INITIALIZATION FUNCTIONS =====
        async function initializeApp() {
            showLoading();
            setupEventListeners();
            await checkAuth();
            await initializeNotifications();
            startAutoRefreshTimer();
            startCountdownTimer();
            hideLoading();
        }

        function showLoading() {
            loadingOverlay.style.display = 'flex';
        }

        function hideLoading() {
            setTimeout(() => {
                loadingOverlay.style.display = 'none';
            }, 1000);
        }

        function setupEventListeners() {
            // Mobile menu
            mobileMenuBtn.addEventListener('click', function() {
                sidebar.classList.toggle('active');
            });

            document.addEventListener('click', function(e) {
                if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                    sidebar.classList.remove('active');
                }
            });

            // Logout
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                handleLogout();
            });

            // Tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showTab(this.getAttribute('data-tab'));
                });
            });

            // Modal close buttons
            closeTaskModalBtn.addEventListener('click', closeTaskModal);
            closeModalBtn.addEventListener('click', closeTaskModal);
            closeManualPaymentModalBtn.addEventListener('click', closeManualPaymentModal);
            closeMembershipUpgradeModalBtn.addEventListener('click', closeMembershipUpgradeModal);
            closeGuidelinesModalBtn.addEventListener('click', closeGuidelinesModal);
            closeGuidelinesBtn.addEventListener('click', closeGuidelinesModal);
            closeSuccessModalBtn.addEventListener('click', closeSuccessModal);
            closeNoticeBtn.addEventListener('click', function() {
                document.querySelector('.admin-review-notice').style.display = 'none';
            });

            // Window click handlers for modals
            window.addEventListener('click', function(e) {
                if (e.target === taskModal) closeTaskModal();
                if (e.target === manualPaymentModal) closeManualPaymentModal();
                if (e.target === membershipUpgradeModal) closeMembershipUpgradeModal();
                if (e.target === guidelinesModal) closeGuidelinesModal();
                if (e.target === successModal) closeSuccessModal();
            });

            // Filter event listeners
            taskTypeFilter.addEventListener('change', applyFilters);
            difficultyFilter.addEventListener('change', applyFilters);
            membershipFilter.addEventListener('change', applyFilters);
            minRewardFilter.addEventListener('change', applyFilters);
            maxRewardFilter.addEventListener('change', applyFilters);
            sortByFilter.addEventListener('change', applyFilters);
            biddersFilter.addEventListener('change', applyFilters);
            deadlineFilter.addEventListener('change', applyFilters);
            searchFilter.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => applyFilters(), 500);
            });

            applyFiltersBtn.addEventListener('click', applyFilters);
            resetFiltersBtn.addEventListener('click', resetFilters);
            saveFilterBtn.addEventListener('click', saveCurrentFilter);
            loadFilterBtn.addEventListener('click', showSavedFilters);

            // Manual payment event listeners
            copyMpesaNumberBtn.addEventListener('click', copyMpesaNumber);
            submitPaymentBtn.addEventListener('click', submitManualPayment);
            cancelManualPaymentBtn.addEventListener('click', closeManualPaymentModal);
            
            // Membership upgrade event listeners
            goToMembershipPageBtn.addEventListener('click', redirectToMembership);
            cancelUpgradeBtn.addEventListener('click', closeMembershipUpgradeModal);
            
            // Guidelines modal
            viewGuidelinesBtn.addEventListener('click', showGuidelinesModal);
            
            // Quick actions
            quickTaskBtn.addEventListener('click', findQuickTask);
            refreshTasksBtn.addEventListener('click', refreshTasks);
            
            // Notification bell
            notificationBell.addEventListener('click', toggleNotifications);
            
            // Start task button
            startTaskBtn.addEventListener('click', startTask);
            submitTaskBtn.addEventListener('click', submitCurrentTask);
            saveDraftBtn.addEventListener('click', saveTaskDraft);
            
            // Export and clear buttons
            document.getElementById('exportHistoryBtn').addEventListener('click', exportTaskHistory);
            document.getElementById('clearHistoryBtn').addEventListener('click', clearTaskFilters);
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Escape key closes modals
                if (e.key === 'Escape') {
                    closeTaskModal();
                    closeManualPaymentModal();
                    closeMembershipUpgradeModal();
                    closeGuidelinesModal();
                    closeSuccessModal();
                }
                
                // Ctrl+F focuses search
                if (e.ctrlKey && e.key === 'f') {
                    e.preventDefault();
                    searchFilter.focus();
                }
                
                // Ctrl+R refreshes tasks
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    refreshTasks();
                }
                
                // Ctrl+S saves draft
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    if (saveDraftBtn.style.display !== 'none') {
                        saveTaskDraft();
                    }
                }
            });
        }

        // ===== AUTHENTICATION FUNCTIONS =====
        async function checkAuth() {
            if (!supabaseClient) {
                showNotification('Application not initialized. Please refresh the page.', 'error');
                return;
            }

            try {
                const { data: { session }, error } = await supabaseClient.auth.getSession();
                if (!session || error) {
                    window.location.href = "login.html";
                    return;
                }
                currentUser = session.user;
                await loadUserData();
            } catch (error) {
                console.error('Auth error:', error);
                showNotification('Authentication error. Please login again.', 'error');
                setTimeout(() => {
                    window.location.href = "login.html";
                }, 2000);
            }
        }

        async function loadUserData() {
            try {
                // Load user profile
                const { data: profile, error } = await supabaseClient
                    .from('profiles')
                    .select('*')
                    .eq('id', currentUser.id)
                    .single();

                if (error) {
                    // Create profile if it doesn't exist
                    if (error.code === 'PGRST116') {
                        await createUserProfile();
                        return;
                    }
                    throw error;
                }
                
                userProfile = profile;
                updateUserUI(profile);
                
                // Load tasks data
                await Promise.all([
                    loadTasks(),
                    loadUserTasks(),
                    loadNotifications()
                ]);
                
                // Update badges and counts
                updateTaskBadges();
                
            } catch (error) {
                console.error("Data load error:", error);
                showNotification('Failed to load user data', 'error');
            }
        }

        async function createUserProfile() {
            try {
                const { data, error } = await supabaseClient
                    .from('profiles')
                    .insert([{
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: currentUser.email.split('@')[0],
                        role: 'starter',
                        balance: 0,
                        tasks_completed: 0,
                        total_earnings: 0,
                        created_at: new Date().toISOString()
                    }])
                    .select()
                    .single();

                if (error) throw error;
                userProfile = data;
                updateUserUI(data);
                await loadTasks();
            } catch (error) {
                console.error("Profile creation error:", error);
                showNotification('Failed to create user profile', 'error');
            }
        }

        function updateUserUI(profile) {
            // Update user info
            userName.textContent = profile.full_name || 'User';
            userRole.textContent = profile.role ? profile.role.charAt(0).toUpperCase() + profile.role.slice(1) : 'Member';
            userAvatar.textContent = (profile.full_name || 'U').charAt(0).toUpperCase();
            
            // Update stats
            balanceAmount.textContent = `KSh ${(profile.balance || 0).toLocaleString()}`;
            completedTasks.textContent = profile.tasks_completed || 0;
            totalEarnings.textContent = `KSh ${(profile.total_earnings || 0).toLocaleString()}`;
            
            // Update rating
            const rating = profile.rating || 0;
            userRating.textContent = rating.toFixed(1);
            userRating.style.color = rating >= 4.5 ? 'var(--success)' : 
                                   rating >= 3.5 ? 'var(--warning)' : 
                                   'var(--danger)';
            
            // Update avatar gradient based on role
            const roleColors = {
                'starter': 'var(--primary)',
                'pro': 'var(--warning)',
                'premium': 'var(--success)',
                'elite': 'var(--gold)'
            };
            userAvatar.style.background = `linear-gradient(135deg, ${roleColors[profile.role] || 'var(--primary)'}, ${roleColors[profile.role + '_dark'] || 'var(--primary-dark)'})`;
        }

        async function handleLogout() {
            try {
                const { error } = await supabaseClient.auth.signOut();
                if (error) throw error;
                showNotification('Logged out successfully', 'success');
                setTimeout(() => {
                    window.location.href = "login.html";
                }, 1500);
            } catch (error) {
                console.error('Logout error:', error);
                showNotification('Failed to log out', 'error');
            }
        }

        // ===== TASK MANAGEMENT FUNCTIONS =====
        async function loadTasks() {
            try {
                const { data: tasks, error } = await supabaseClient
                    .from('tasks')
                    .select('*')
                    .eq('status', 'active')
                    .order('created_at', { ascending: false });

                if (error) throw error;
                allTasks = tasks || [];
                
                // Process tasks to check expiration and bidder limits
                allTasks = allTasks.map(task => {
                    const processedTask = { ...task };
                    
                    // Check if task is expired
                    if (task.deadline) {
                        const deadline = new Date(task.deadline);
                        const now = new Date();
                        processedTask.is_expired = deadline < now;
                    }
                    
                    // Get current bidder count
                    processedTask.current_bidders = task.current_bidders || 0;
                    processedTask.is_full = task.max_bidders && task.current_bidders >= task.max_bidders;
                    
                    return processedTask;
                });
                
                availableTasks.textContent = allTasks.length;
                applyFilters();
                
            } catch (error) {
                console.error("Tasks load error:", error);
                showNotification('Failed to load tasks', 'error');
            }
        }

        async function loadUserTasks() {
            try {
                const { data: assignedTasks, error } = await supabaseClient
                    .from('user_tasks')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .order('assigned_at', { ascending: false });

                if (error) throw error;
                userTasks = assignedTasks || [];
                updateEarningsStats();
                renderMyTasks();
                
            } catch (error) {
                console.error("User tasks error:", error);
                userTasks = [];
                updateEarningsStats();
                renderMyTasks();
            }
        }

        function updateEarningsStats() {
            if (!userProfile || !userTasks) return;

            const totalTasks = userTasks.length;
            const approvedTasks = userTasks.filter(task => task.status === 'approved').length;
            const pendingTasks = userTasks.filter(task => task.status === 'submitted').length;
            const rejectedTasks = userTasks.filter(task => task.status === 'rejected').length;
            const inProgressTasks = userTasks.filter(task => task.status === 'assigned' || task.status === 'in_progress').length;
            const expiredTasks = userTasks.filter(task => task.status === 'expired').length;

            const totalEarningsValue = userTasks
                .filter(task => task.status === 'approved')
                .reduce((sum, task) => sum + (task.paid_amount || 0), 0);

            const pendingEarningsValue = userTasks
                .filter(task => task.status === 'submitted')
                .reduce((sum, task) => {
                    const taskDetails = allTasks.find(t => t.id === task.task_id);
                    return sum + (taskDetails ? taskDetails.reward_amount : 0);
                }, 0);

            // Update UI
            pendingEarnings.textContent = 'KSh ' + (pendingEarningsValue.toLocaleString());
            totalTasksCount.textContent = totalTasks;
            approvedTasksCount.textContent = approvedTasks;
            pendingTasksCount.textContent = pendingTasks;
            inProgressTasksCount.textContent = inProgressTasks;
            rejectedTasksCount.textContent = rejectedTasks;
            expiredTasksCount.textContent = expiredTasks;

            // Update badges
            allTasksBadge.textContent = totalTasks;
            inProgressBadge.textContent = inProgressTasks;
            submittedBadge.textContent = pendingTasks;
            completedBadge.textContent = approvedTasks;
            rejectedBadge.textContent = rejectedTasks;
            expiredBadge.textContent = expiredTasks;
        }

        function updateTaskBadges() {
            // Update main tasks badge
            const availableTasksCount = allTasks.filter(task => {
                const userTask = userTasks.find(ut => ut.task_id === task.id);
                return !userTask && !task.is_expired && !task.is_full;
            }).length;
            
            tasksBadge.textContent = availableTasksCount;
        }

        // ===== FILTERING AND SORTING =====
        function applyFilters() {
            const taskType = taskTypeFilter.value;
            const difficulty = difficultyFilter.value;
            const membership = membershipFilter.value;
            const minReward = parseInt(minRewardFilter.value) || 0;
            const maxReward = parseInt(maxRewardFilter.value) || Infinity;
            const searchTerm = searchFilter.value.toLowerCase();
            const sortBy = sortByFilter.value;
            const biddersStatus = biddersFilter.value;
            const deadlineStatus = deadlineFilter.value;

            filteredTasks = allTasks.filter(task => {
                // Type filter
                if (taskType !== 'all' && task.task_type !== taskType) return false;
                
                // Difficulty filter
                if (difficulty !== 'all' && task.difficulty !== difficulty) return false;
                
                // Membership filter
                if (membership !== 'all' && task.required_membership !== membership) return false;
                
                // Reward range filter
                if (task.reward_amount < minReward || task.reward_amount > maxReward) return false;
                
                // Search filter
                if (searchTerm && !task.title.toLowerCase().includes(searchTerm) && 
                    !task.description.toLowerCase().includes(searchTerm)) return false;
                
                // Bidders status filter
                if (biddersStatus !== 'all') {
                    if (biddersStatus === 'available' && task.is_full) return false;
                    if (biddersStatus === 'full' && !task.is_full) return false;
                    if (biddersStatus === 'limited' && (!task.max_bidders || task.current_bidders >= task.max_bidders - 2)) return false;
                }
                
                // Deadline filter
                if (deadlineStatus !== 'all' && task.deadline) {
                    const now = new Date();
                    const deadline = new Date(task.deadline);
                    const timeDiff = deadline - now;
                    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    
                    switch(deadlineStatus) {
                        case 'today':
                            if (daysDiff !== 0) return false;
                            break;
                        case 'tomorrow':
                            if (daysDiff !== 1) return false;
                            break;
                        case 'week':
                            if (daysDiff > 7) return false;
                            break;
                        case 'month':
                            if (daysDiff > 30) return false;
                            break;
                        case 'urgent':
                            if (daysDiff > 1) return false;
                            break;
                    }
                }
                
                return true;
            });

            // Sort tasks
            filteredTasks.sort((a, b) => {
                switch(sortBy) {
                    case 'newest':
                        return new Date(b.created_at) - new Date(a.created_at);
                    case 'oldest':
                        return new Date(a.created_at) - new Date(b.created_at);
                    case 'reward_high':
                        return b.reward_amount - a.reward_amount;
                    case 'reward_low':
                        return a.reward_amount - b.reward_amount;
                    case 'deadline':
                        if (!a.deadline) return 1;
                        if (!b.deadline) return -1;
                        return new Date(a.deadline) - new Date(b.deadline);
                    default:
                        return 0;
                }
            });

            // Update filter results count
            filterResults.textContent = `${filteredTasks.length} tasks found`;
            
            // Render paginated tasks
            renderPaginatedTasks();
        }

        function resetFilters() {
            taskTypeFilter.value = 'all';
            difficultyFilter.value = 'all';
            membershipFilter.value = 'all';
            minRewardFilter.value = '';
            maxRewardFilter.value = '';
            searchFilter.value = '';
            sortByFilter.value = 'newest';
            biddersFilter.value = 'all';
            deadlineFilter.value = 'all';
            applyFilters();
            showNotification('Filters reset successfully', 'success');
        }

        function saveCurrentFilter() {
            const filterName = prompt('Enter a name for this filter:');
            if (!filterName) return;
            
            const filter = {
                name: filterName,
                taskType: taskTypeFilter.value,
                difficulty: difficultyFilter.value,
                membership: membershipFilter.value,
                minReward: minRewardFilter.value,
                maxReward: maxRewardFilter.value,
                sortBy: sortByFilter.value,
                biddersFilter: biddersFilter.value,
                deadlineFilter: deadlineFilter.value,
                search: searchFilter.value,
                createdAt: new Date().toISOString()
            };
            
            savedFilters.push(filter);
            localStorage.setItem('savedFilters', JSON.stringify(savedFilters));
            showNotification(`Filter "${filterName}" saved successfully`, 'success');
        }

        function showSavedFilters() {
            if (savedFilters.length === 0) {
                showNotification('No saved filters found', 'info');
                return;
            }
            
            const filterList = savedFilters.map(filter => 
                `<div style="padding: 10px; border-bottom: 1px solid var(--border);">
                    <strong>${filter.name}</strong>
                    <button onclick="loadFilter('${filter.name}')" style="float: right; padding: 5px 10px; background: var(--primary); color: white; border: none; border-radius: 4px; cursor: pointer;">
                        Load
                    </button>
                    <button onclick="deleteFilter('${filter.name}')" style="float: right; padding: 5px 10px; background: var(--danger); color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px;">
                        Delete
                    </button>
                </div>`
            ).join('');
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <span class="close-modal" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h3>Saved Filters</h3>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${filterList}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            modal.style.display = 'flex';
        }

        function loadFilter(filterName) {
            const filter = savedFilters.find(f => f.name === filterName);
            if (!filter) return;
            
            taskTypeFilter.value = filter.taskType;
            difficultyFilter.value = filter.difficulty;
            membershipFilter.value = filter.membership;
            minRewardFilter.value = filter.minReward;
            maxRewardFilter.value = filter.maxReward;
            sortByFilter.value = filter.sortBy;
            biddersFilter.value = filter.biddersFilter;
            deadlineFilter.value = filter.deadlineFilter;
            searchFilter.value = filter.search;
            
            applyFilters();
            showNotification(`Filter "${filterName}" loaded successfully`, 'success');
            
            // Close the modal
            document.querySelector('.modal').remove();
        }

        function deleteFilter(filterName) {
            savedFilters = savedFilters.filter(f => f.name !== filterName);
            localStorage.setItem('savedFilters', JSON.stringify(savedFilters));
            showNotification(`Filter "${filterName}" deleted`, 'success');
            
            // Refresh the modal
            const modal = document.querySelector('.modal');
            if (modal) modal.remove();
            showSavedFilters();
        }

        // ===== TASK RENDERING FUNCTIONS =====
        function renderPaginatedTasks() {
            // Calculate pagination
            totalPages = Math.ceil(filteredTasks.length / tasksPerPage);
            currentPage = Math.min(currentPage, totalPages);
            
            // Get tasks for current page
            const startIndex = (currentPage - 1) * tasksPerPage;
            const endIndex = startIndex + tasksPerPage;
            const pageTasks = filteredTasks.slice(startIndex, endIndex);
            
            // Render tasks
            renderTasks(pageTasks);
            
            // Render pagination
            renderPagination();
        }

        function renderTasks(tasks) {
            if (tasks.length === 0) {
                tasksContainer.innerHTML = `
                    <div class="no-tasks" style="grid-column: 1 / -1;">
                        <div class="icon">ðŸ“­</div>
                        <h3>No Tasks Available</h3>
                        <p>No tasks match your current filters. Try adjusting your search criteria or check back later for new tasks.</p>
                        <button class="btn btn-primary" onclick="resetFilters()" style="margin-top: 20px;">
                            Reset Filters
                        </button>
                    </div>
                `;
                return;
            }

            tasksContainer.innerHTML = tasks.map(task => {
                const userTask = userTasks.find(ut => ut.task_id === task.id);
                const isAssigned = userTask && ['assigned', 'in_progress'].includes(userTask.status);
                const isCompleted = userTask && userTask.status === 'approved';
                const isRejected = userTask && userTask.status === 'rejected';
                const isSubmitted = userTask && userTask.status === 'submitted';
                const isExpired = userTask && userTask.status === 'expired';
                const canAssign = !userTask && !task.is_expired && !task.is_full;
                
                // Check membership requirement
                const userMembership = userProfile ? userProfile.role : 'starter';
                const taskMembership = task.required_membership || 'starter';
                const membershipLevels = { 'starter': 1, 'pro': 2, 'premium': 3, 'elite': 4 };
                const hasRequiredMembership = membershipLevels[userMembership] >= membershipLevels[taskMembership];
                
                // Determine task card classes
                let cardClasses = 'task-card';
                if (task.is_expired) cardClasses += ' expired';
                if (task.is_full) cardClasses += ' full';
                if (task.featured) cardClasses += ' featured';
                
                // Task type info
                const taskTypeInfo = TASK_TYPES[task.task_type] || { name: task.task_type, icon: 'fas fa-tasks', color: 'var(--primary)' };
                const difficultyInfo = DIFFICULTY_LEVELS[task.difficulty] || { name: task.difficulty, color: 'var(--gray)', icon: 'fas fa-circle' };
                
                // Action button logic
                let actionButton = '';
                let statusBadge = '';
                let membershipNotice = '';
                let deadlineInfo = '';
                let biddersInfo = '';
                
                // Deadline information
                if (task.deadline) {
                    const now = new Date();
                    const deadline = new Date(task.deadline);
                    const timeDiff = deadline - now;
                    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    
                    let deadlineClass = 'ok';
                    let deadlineText = '';
                    
                    if (timeDiff < 0) {
                        deadlineClass = 'expired';
                        deadlineText = 'Expired';
                    } else if (daysDiff === 0) {
                        deadlineClass = 'warning';
                        deadlineText = 'Due today';
                    } else if (daysDiff === 1) {
                        deadlineClass = 'warning';
                        deadlineText = 'Due tomorrow';
                    } else if (daysDiff <= 3) {
                        deadlineClass = 'warning';
                        deadlineText = `Due in ${daysDiff} days`;
                    } else {
                        deadlineText = `Due in ${daysDiff} days`;
                    }
                    
                    deadlineInfo = `
                        <div class="task-deadline ${deadlineClass}">
                            <i class="fas fa-calendar-alt"></i>
                            ${deadlineText}
                        </div>
                    `;
                }
                
                // Bidders information
                if (task.max_bidders) {
                    const slotsLeft = task.max_bidders - (task.current_bidders || 0);
                    biddersInfo = `
                        <div class="task-bidders">
                            <i class="fas fa-users"></i>
                            <span class="bidders-count">${task.current_bidders || 0}/${task.max_bidders}</span>
                            <span>${slotsLeft} slot${slotsLeft !== 1 ? 's' : ''} left</span>
                        </div>
                    `;
                    
                    if (task.is_full) {
                        biddersInfo = `
                            <div class="bidders-info">
                                <i class="fas fa-times-circle"></i>
                                All slots filled
                            </div>
                        `;
                    }
                }
                
                // Membership requirement notice
                if (!hasRequiredMembership) {
                    membershipNotice = `
                        <div class="membership-required">
                            <i class="fas fa-lock"></i>
                            Upgrade to ${formatMembership(taskMembership)} membership to access this task
                        </div>
                    `;
                    actionButton = `
                        <button class="btn btn-warning" onclick="showMembershipUpgradeModal('${taskMembership}')">
                            <i class="fas fa-crown"></i>
                            Upgrade to Unlock
                        </button>
                    `;
                } else if (isCompleted) {
                    statusBadge = '<div class="task-status-container approved"><i class="fas fa-check-circle"></i> Task Completed - Approved</div>';
                    actionButton = '<button class="btn btn-success" disabled><i class="fas fa-check"></i> Completed</button>';
                } else if (isRejected) {
                    statusBadge = '<div class="task-status-container rejected"><i class="fas fa-times-circle"></i> Task Completed - Rejected</div>';
                    actionButton = `<button class="btn btn-primary" onclick="viewTaskDetails('${task.id}')"><i class="fas fa-eye"></i> View Details</button>`;
                } else if (isSubmitted) {
                    statusBadge = '<div class="task-status-container submitted"><i class="fas fa-clock"></i> Task Completed - Under Review</div>';
                    actionButton = '<button class="btn btn-warning" disabled><i class="fas fa-clock"></i> Under Review</button>';
                } else if (isExpired) {
                    statusBadge = '<div class="task-status-container expired"><i class="fas fa-clock"></i> Task Expired</div>';
                    actionButton = '<button class="btn btn-secondary" disabled><i class="fas fa-ban"></i> Expired</button>';
                } else if (isAssigned) {
                    statusBadge = '<div class="task-status-container in-progress"><i class="fas fa-spinner"></i> Task In Progress</div>';
                    actionButton = `<button class="btn btn-primary" onclick="viewTaskDetails('${task.id}')"><i class="fas fa-play"></i> Continue Task</button>`;
                } else if (canAssign) {
                    // For premium tasks, check payment requirement
                    if (task.requires_payment && task.payment_amount > 0) {
                        actionButton = `
                            <button class="btn btn-primary" onclick="showManualPaymentModal('${task.id}', 'task_access', ${task.payment_amount})">
                                <i class="fas fa-lock"></i>
                                Purchase Access (KSh ${task.payment_amount})
                            </button>
                        `;
                    } else {
                        actionButton = `
                            <button class="btn btn-primary" onclick="assignTaskAndOpenWorkspace('${task.id}')">
                                <i class="fas fa-play"></i>
                                Start Task
                            </button>
                        `;
                    }
                } else if (task.is_full) {
                    actionButton = '<button class="btn btn-secondary" disabled><i class="fas fa-users"></i> All Slots Filled</button>';
                } else if (task.is_expired) {
                    actionButton = '<button class="btn btn-secondary" disabled><i class="fas fa-clock"></i> Expired</button>';
                }
                
                return `
                    <div class="${cardClasses}">
                        <div class="task-header">
                            <div>
                                <div class="task-title">
                                    <i class="${taskTypeInfo.icon}" style="color: ${taskTypeInfo.color}; margin-right: 8px;"></i>
                                    ${task.title}
                                </div>
                                <span class="task-type" style="background: ${taskTypeInfo.color}20; color: ${taskTypeInfo.color}; border-color: ${taskTypeInfo.color}40;">
                                    ${taskTypeInfo.name}
                                </span>
                            </div>
                            <div class="task-reward">
                                KSh ${task.reward_amount.toLocaleString()}
                                <span>reward</span>
                            </div>
                        </div>
                        
                        <div class="task-description">
                            ${task.description}
                        </div>
                        
                        ${deadlineInfo}
                        ${biddersInfo}
                        ${membershipNotice}
                        ${statusBadge}
                        
                        <div class="task-meta">
                            <div class="task-difficulty">
                                <span class="difficulty-${task.difficulty}" style="color: ${difficultyInfo.color};">
                                    <i class="${difficultyInfo.icon}"></i>
                                    ${difficultyInfo.name}
                                </span>
                            </div>
                            <div class="task-requirements">
                                Requires: <strong style="color: ${MEMBERSHIP_TIERS[task.required_membership]?.color || 'var(--primary)'}">
                                    ${formatMembership(task.required_membership)}
                                </strong>
                            </div>
                        </div>
                        
                        <div class="task-actions">
                            ${actionButton}
                            <button class="btn btn-outline-primary" onclick="viewTaskDetails('${task.id}')">
                                <i class="fas fa-info-circle"></i>
                                Details
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderPagination() {
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <li class="page-item ${i === currentPage ? 'active' : ''}">
                        <a class="page-link" href="#" onclick="changePage(${i}); return false;">
                            ${i}
                        </a>
                    </li>
                `;
            }
            
            // Next button
            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;
            
            paginationContainer.innerHTML = `
                <ul class="pagination">
                    ${paginationHTML}
                </ul>
            `;
        }

        function changePage(page) {
            if (page < 1 || page > totalPages || page === currentPage) return;
            currentPage = page;
            applyFilters();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderMyTasks() {
            let filteredUserTasks = userTasks;
            
            switch(currentTab) {
                case 'in-progress': 
                    filteredUserTasks = filteredUserTasks.filter(task => 
                        task.status === 'assigned' || task.status === 'in_progress'
                    ); 
                    break;
                case 'submitted': 
                    filteredUserTasks = filteredUserTasks.filter(task => task.status === 'submitted'); 
                    break;
                case 'completed': 
                    filteredUserTasks = filteredUserTasks.filter(task => task.status === 'approved'); 
                    break;
                case 'rejected': 
                    filteredUserTasks = filteredUserTasks.filter(task => task.status === 'rejected'); 
                    break;
                case 'expired':
                    filteredUserTasks = filteredUserTasks.filter(task => task.status === 'expired');
                    break;
            }

            if (filteredUserTasks.length === 0) {
                myTasksContainer.innerHTML = `
                    <div class="no-tasks" style="grid-column: 1 / -1;">
                        <div class="icon">ðŸ“­</div>
                        <h3>No tasks in this category</h3>
                        <p>You don't have any tasks in the "${currentTab.replace('-', ' ')}" status yet.</p>
                        ${currentTab === 'all-tasks' ? '<button class="btn btn-primary" onclick="applyFilters()" style="margin-top: 20px;">Browse Available Tasks</button>' : ''}
                    </div>
                `;
                return;
            }

            myTasksContainer.innerHTML = filteredUserTasks.map(userTask => {
                const task = allTasks.find(t => t.id === userTask.task_id);
                if (!task) return '';

                const taskTypeInfo = TASK_TYPES[task.task_type] || { name: task.task_type, icon: 'fas fa-tasks', color: 'var(--primary)' };
                const difficultyInfo = DIFFICULTY_LEVELS[task.difficulty] || { name: task.difficulty, color: 'var(--gray)', icon: 'fas fa-circle' };
                
                let statusBadge = '', statusColor = '', earningsInfo = '', actionButton = '', statusText = '';
                let deadlineInfo = '';
                
                // Deadline information
                if (task.deadline && userTask.status !== 'approved' && userTask.status !== 'rejected') {
                    const now = new Date();
                    const deadline = new Date(task.deadline);
                    const timeDiff = deadline - now;
                    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    
                    let deadlineClass = 'ok';
                    let deadlineText = '';
                    
                    if (timeDiff < 0) {
                        deadlineClass = 'expired';
                        deadlineText = 'Expired';
                    } else if (daysDiff === 0) {
                        deadlineClass = 'warning';
                        deadlineText = 'Due today';
                    } else if (daysDiff === 1) {
                        deadlineClass = 'warning';
                        deadlineText = 'Due tomorrow';
                    } else if (daysDiff <= 3) {
                        deadlineClass = 'warning';
                        deadlineText = `Due in ${daysDiff} days`;
                    } else {
                        deadlineText = `Due in ${daysDiff} days`;
                    }
                    
                    deadlineInfo = `
                        <div class="task-deadline ${deadlineClass}">
                            <i class="fas fa-calendar-alt"></i>
                            ${deadlineText}
                        </div>
                    `;
                }
                
                switch(userTask.status) {
                    case 'approved': 
                        statusBadge = '<i class="fas fa-check-circle"></i> Approved'; 
                        statusText = 'Task Completed - Approved';
                        statusColor = 'approved'; 
                        earningsInfo = `<div style="color: var(--success); margin: 8px 0; font-weight: 800; font-size: var(--font-size-lg);">Earned: KSh ${(userTask.paid_amount || task.reward_amount || 0).toLocaleString()}</div>`;
                        actionButton = '<button class="btn btn-success" disabled><i class="fas fa-check"></i> Task Completed</button>';
                        break;
                    case 'rejected': 
                        statusBadge = '<i class="fas fa-times-circle"></i> Rejected'; 
                        statusText = 'Task Completed - Rejected';
                        statusColor = 'rejected';
                        actionButton = `<button class="btn btn-primary" onclick="viewTaskDetails('${task.id}')"><i class="fas fa-eye"></i> View Details</button>`;
                        break;
                    case 'submitted': 
                        statusBadge = '<i class="fas fa-clock"></i> Under Review'; 
                        statusText = 'Task Completed - Under Review';
                        statusColor = 'submitted';
                        actionButton = '<button class="btn btn-warning" disabled><i class="fas fa-clock"></i> Under Review</button>';
                        break;
                    case 'expired':
                        statusBadge = '<i class="fas fa-clock"></i> Expired';
                        statusText = 'Task Expired';
                        statusColor = 'expired';
                        actionButton = '<button class="btn btn-secondary" disabled><i class="fas fa-ban"></i> Expired</button>';
                        break;
                    default: 
                        statusBadge = '<i class="fas fa-spinner"></i> In Progress'; 
                        statusText = 'Task In Progress';
                        statusColor = 'in-progress';
                        actionButton = `<button class="btn btn-primary" onclick="viewTaskDetails('${task.id}')"><i class="fas fa-play"></i> Continue Task</button>`;
                }

                // Format date
                const assignedDate = new Date(userTask.assigned_at).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                });
                
                return `
                    <div class="task-card">
                        <div class="task-header">
                            <div>
                                <div class="task-title">
                                    <i class="${taskTypeInfo.icon}" style="color: ${taskTypeInfo.color}; margin-right: 8px;"></i>
                                    ${task.title}
                                </div>
                                <span class="task-type" style="background: ${taskTypeInfo.color}20; color: ${taskTypeInfo.color}; border-color: ${taskTypeInfo.color}40;">
                                    ${taskTypeInfo.name}
                                </span>
                            </div>
                            <div class="task-reward">
                                KSh ${task.reward_amount.toLocaleString()}
                                <span>reward</span>
                            </div>
                        </div>
                        
                        <div class="task-status-container ${statusColor}">
                            <strong>${statusText}</strong>
                        </div>
                        
                        ${deadlineInfo}
                        ${earningsInfo}
                        
                        <div style="font-size: var(--font-size-sm); color: var(--gray); margin: 8px 0; font-weight: 600;">
                            <i class="fas fa-calendar"></i> Assigned: ${assignedDate}
                        </div>
                        
                        <div class="task-meta">
                            <div class="task-difficulty">
                                <span class="difficulty-${task.difficulty}" style="color: ${difficultyInfo.color};">
                                    <i class="${difficultyInfo.icon}"></i>
                                    ${difficultyInfo.name}
                                </span>
                            </div>
                            <div class="task-requirements">
                                Requires: <strong>${formatMembership(task.required_membership)}</strong>
                            </div>
                        </div>
                        
                        <div class="task-actions">
                            ${actionButton}
                            <button class="btn btn-outline-primary" onclick="viewTaskDetails('${task.id}')">
                                <i class="fas fa-info-circle"></i>
                                Details
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showTab(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            renderMyTasks();
        }

        // ===== TASK DETAILS AND WORKSPACE =====
        async function viewTaskDetails(taskId) {
            showLoading();
            
            try {
                const task = allTasks.find(t => t.id === taskId);
                const userTask = userTasks.find(ut => ut.task_id === taskId);
                
                if (!task) {
                    showNotification('Task not found', 'error');
                    hideLoading();
                    return;
                }
                
                currentTaskId = taskId;
                currentTask = task;
                currentUserTask = userTask;
                
                // Update modal header
                const taskTypeInfo = TASK_TYPES[task.task_type] || { name: task.task_type, color: 'var(--primary)' };
                const difficultyInfo = DIFFICULTY_LEVELS[task.difficulty] || { name: task.difficulty, color: 'var(--gray)' };
                
                modalTitle.textContent = task.title;
                modalTypeBadge.textContent = taskTypeInfo.name;
                modalTypeBadge.style.backgroundColor = `${taskTypeInfo.color}20`;
                modalTypeBadge.style.color = taskTypeInfo.color;
                modalTypeBadge.style.borderColor = `${taskTypeInfo.color}40`;
                
                modalDifficultyBadge.textContent = difficultyInfo.name;
                modalDifficultyBadge.style.color = difficultyInfo.color;
                
                modalRewardBadge.textContent = `KSh ${task.reward_amount.toLocaleString()}`;
                
                // Set status badge
                if (userTask) {
                    const statusColors = {
                        'approved': 'var(--success)',
                        'rejected': 'var(--danger)',
                        'submitted': 'var(--warning)',
                        'expired': 'var(--gray)',
                        'assigned': 'var(--info)',
                        'in_progress': 'var(--info)'
                    };
                    modalStatusBadge.textContent = formatTaskStatus(userTask.status);
                    modalStatusBadge.style.color = statusColors[userTask.status] || 'var(--primary)';
                    modalStatusBadge.style.display = 'inline-block';
                } else {
                    modalStatusBadge.style.display = 'none';
                }
                
                // Build modal content
                let content = `
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 30px; background: linear-gradient(135deg, var(--light), #e9ecef); padding: 30px; border-radius: 20px; box-shadow: var(--shadow-md);">
                        <div><strong style="color: var(--primary);"><i class="fas fa-tag"></i> Task Type:</strong> ${taskTypeInfo.name}</div>
                        <div><strong style="color: var(--primary);"><i class="fas fa-signal"></i> Difficulty:</strong> <span style="color: ${difficultyInfo.color}; font-weight: 700;">${difficultyInfo.name}</span></div>
                        <div><strong style="color: var(--primary);"><i class="fas fa-money-bill-wave"></i> Reward:</strong> KSh ${task.reward_amount.toLocaleString()}</div>
                        <div><strong style="color: var(--primary);"><i class="fas fa-crown"></i> Membership:</strong> ${formatMembership(task.required_membership)}</div>
                `;
                
                if (task.deadline) {
                    const deadline = new Date(task.deadline);
                    const now = new Date();
                    const timeDiff = deadline - now;
                    const daysDiff = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
                    
                    let deadlineStatus = 'ok';
                    let deadlineText = '';
                    
                    if (timeDiff < 0) {
                        deadlineStatus = 'expired';
                        deadlineText = 'Expired';
                    } else if (daysDiff === 0) {
                        deadlineStatus = 'warning';
                        deadlineText = 'Due today';
                    } else if (daysDiff === 1) {
                        deadlineStatus = 'warning';
                        deadlineText = 'Due tomorrow';
                    } else if (daysDiff <= 3) {
                        deadlineStatus = 'warning';
                        deadlineText = `Due in ${daysDiff} days`;
                    } else {
                        deadlineText = `Due in ${daysDiff} days`;
                    }
                    
                    content += `
                        <div><strong style="color: var(--primary);"><i class="fas fa-calendar-alt"></i> Deadline:</strong> 
                            <span class="task-deadline ${deadlineStatus}" style="display: inline-flex; align-items: center; gap: 5px; margin-left: 10px;">
                                ${deadlineText}
                            </span>
                        </div>
                    `;
                }
                
                if (task.max_bidders) {
                    const slotsLeft = task.max_bidders - (task.current_bidders || 0);
                    content += `
                        <div><strong style="color: var(--primary);"><i class="fas fa-users"></i> Bidders:</strong> 
                            ${task.current_bidders || 0}/${task.max_bidders} (${slotsLeft} slot${slotsLeft !== 1 ? 's' : ''} left)
                        </div>
                    `;
                }
                
                if (task.word_count_target) {
                    content += `<div><strong style="color: var(--primary);"><i class="fas fa-file-word"></i> Word Count:</strong> ${task.word_count_target} words</div>`;
                }
                
                content += `</div>`;
                
                // Audio information for transcription tasks
                if (task.task_type === 'transcription' && task.audio_url) {
                    content += `
                        <div style="margin-bottom: 25px; padding: 25px; background: linear-gradient(135deg, #e7f3ff, #d4e7ff); border-radius: 20px; border-left: 8px solid var(--primary); box-shadow: var(--shadow-md);">
                            <h4 style="color: var(--primary); margin-bottom: 15px; font-size: var(--font-size-xl);"><i class="fas fa-headphones"></i> Audio File</h4>
                            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                                <div style="flex: 1; min-width: 300px;">
                                    <strong>Audio URL:</strong> 
                                    <a href="${task.audio_url}" target="_blank" style="color: var(--primary); text-decoration: underline; word-break: break-all; display: block; margin-top: 5px;">
                                        ${task.audio_url}
                                    </a>
                                </div>
                                <button class="btn btn-primary" onclick="testAudio('${task.audio_url}')" style="padding: 12px 24px;">
                                    <i class="fas fa-play"></i>
                                    Test Audio
                                </button>
                            </div>
                        </div>
                    `;
                }
                
                // Requirements section
                if (task.requirements) {
                    content += `
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: var(--primary); margin-bottom: 20px; font-size: var(--font-size-xl);"><i class="fas fa-clipboard-list"></i> Task Requirements</h3>
                            <div style="background: linear-gradient(135deg, #e7f3ff, #d4e7ff); padding: 30px; border-radius: 20px; border-left: 8px solid var(--primary); box-shadow: var(--shadow-md);">
                    `;
                    
                    try {
                        const reqData = task.requirements;
                        let reqArray;
                        if (typeof reqData === 'string') {
                            reqArray = JSON.parse(reqData);
                        } else {
                            reqArray = reqData;
                        }
                        
                        if (Array.isArray(reqArray)) {
                            content += '<ul style="margin: 0; padding: 0; list-style: none;">';
                            reqArray.forEach(req => {
                                content += `
                                    <li style="margin-bottom: 15px; padding-left: 15px; background: white; padding: 20px; border-radius: 15px; box-shadow: var(--shadow-sm); border-left: 6px solid var(--primary); position: relative;">
                                        <i class="fas fa-check" style="position: absolute; left: -10px; top: 50%; transform: translateY(-50%); background: var(--primary); color: white; width: 20px; height: 20px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px;"></i>
                                        ${req}
                                    </li>
                                `;
                            });
                            content += '</ul>';
                        } else {
                            content += `<div style="background: white; padding: 25px; border-radius: 15px; box-shadow: var(--shadow-sm); border-left: 6px solid var(--primary);">${reqData}</div>`;
                        }
                    } catch (e) {
                        content += `<div style="background: white; padding: 25px; border-radius: 15px; box-shadow: var(--shadow-sm); border-left: 6px solid var(--primary);">${task.requirements}</div>`;
                    }
                    
                    content += `</div></div>`;
                }
                
                // Description section
                content += `
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: var(--primary); margin-bottom: 20px; font-size: var(--font-size-xl);"><i class="fas fa-align-left"></i> Task Description</h3>
                        <div style="background: white; padding: 30px; border-radius: 20px; border: 3px solid var(--border); box-shadow: var(--shadow-md);">
                            <p style="line-height: 1.8; margin: 0; font-size: var(--font-size-md); color: var(--dark);">${task.description}</p>
                        </div>
                    </div>
                `;
                
                // Admin feedback for rejected tasks
                if (userTask && userTask.status === 'rejected' && userTask.admin_feedback) {
                    content += `
                        <div style="margin-bottom: 30px;">
                            <h3 style="color: var(--danger); margin-bottom: 20px; font-size: var(--font-size-xl);"><i class="fas fa-comment-alt"></i> Rejection Feedback</h3>
                            <div style="background: linear-gradient(135deg, #f8d7da, #f5c6cb); padding: 30px; border-radius: 20px; border-left: 8px solid var(--danger); box-shadow: var(--shadow-md);">
                                <strong style="color: #721c24; font-size: var(--font-size-lg);">Reason for Rejection:</strong>
                                <div style="margin-top: 15px; color: #721c24; line-height: 1.7; font-size: var(--font-size-md); padding: 20px; background: rgba(255,255,255,0.7); border-radius: 10px;">
                                    ${userTask.admin_feedback}
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // Timer display for in-progress tasks
                if (userTask && (userTask.status === 'assigned' || userTask.status === 'in_progress')) {
                    const timeSpent = userTask.time_spent || 0;
                    const hours = Math.floor(timeSpent / 3600);
                    const minutes = Math.floor((timeSpent % 3600) / 60);
                    const seconds = timeSpent % 60;
                    
                    content += `
                        <div class="timer-display">
                            <h4 style="margin-bottom: 15px; font-size: var(--font-size-xl);"><i class="fas fa-clock"></i> Time Spent on Task</h4>
                            <div id="timerDisplay" style="font-size: var(--font-size-giant); font-weight: 900; margin: 20px 0; font-family: monospace;">
                                ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}
                            </div>
                            <div style="color: var(--warning); font-weight: 700; font-size: var(--font-size-sm); background: rgba(255,193,7,0.1); padding: 10px; border-radius: 8px; display: inline-block;">
                                <i class="fas fa-exclamation-triangle"></i>
                                Timer starts automatically and cannot be paused
                            </div>
                        </div>
                    `;
                }
                
                // Advanced tools section
                content += createAdvancedToolsSection(task);
                
                // Workspace based on task type and status
                if (userTask) {
                    if (userTask.status === 'assigned' || userTask.status === 'in_progress') {
                        // Editable workspace
                        if (task.task_type === 'transcription') {
                            content += createTranscriptionWorkspace(task, userTask);
                        } else if (task.task_type === 'data_entry') {
                            content += createDataEntryWorkspace(task, userTask);
                        } else {
                            content += createWorkspace(task, userTask, true);
                        }
                        
                        // Show appropriate buttons
                        startTaskBtn.style.display = 'none';
                        submitTaskBtn.style.display = 'block';
                        saveDraftBtn.style.display = 'block';
                        
                    } else if (userTask.status === 'submitted' || userTask.status === 'approved' || userTask.status === 'rejected') {
                        // Read-only workspace
                        content += createWorkspace(task, userTask, false);
                        
                        // Hide action buttons
                        startTaskBtn.style.display = 'none';
                        submitTaskBtn.style.display = 'none';
                        saveDraftBtn.style.display = 'none';
                    }
                } else {
                    // No user task - show start button if conditions are met
                    const userMembership = userProfile ? userProfile.role : 'starter';
                    const taskMembership = task.required_membership || 'starter';
                    const membershipLevels = { 'starter': 1, 'pro': 2, 'premium': 3, 'elite': 4 };
                    const hasRequiredMembership = membershipLevels[userMembership] >= membershipLevels[taskMembership];
                    
                    if (!task.is_expired && !task.is_full && hasRequiredMembership) {
                        if (task.requires_payment && task.payment_amount > 0) {
                            // Show payment required notice
                            content += `
                                <div style="margin-bottom: 30px; padding: 30px; background: linear-gradient(135deg, #fff3cd, #ffeaa7); border-radius: 20px; border-left: 8px solid var(--warning); box-shadow: var(--shadow-md);">
                                    <h4 style="color: var(--warning); margin-bottom: 20px; font-size: var(--font-size-xl);"><i class="fas fa-lock"></i> Purchase Task Access</h4>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                                        <div>
                                            <strong>Task Type:</strong> ${taskTypeInfo.name}
                                        </div>
                                        <div>
                                            <strong>Access Fee:</strong> KSh ${task.payment_amount}
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 15px;">
                                        <button class="btn btn-success" onclick="showManualPaymentModal('${task.id}', 'task_access', ${task.payment_amount})">
                                            <i class="fas fa-shopping-cart"></i>
                                            Purchase Access (KSh ${task.payment_amount})
                                        </button>
                                    </div>
                                </div>
                            `;
                            
                            startTaskBtn.style.display = 'none';
                        } else {
                            startTaskBtn.style.display = 'block';
                            startTaskBtn.textContent = 'Start Task';
                            startTaskBtn.innerHTML = '<i class="fas fa-play"></i> Start Task';
                        }
                        
                        submitTaskBtn.style.display = 'none';
                        saveDraftBtn.style.display = 'none';
                    } else {
                        startTaskBtn.style.display = 'none';
                        submitTaskBtn.style.display = 'none';
                        saveDraftBtn.style.display = 'none';
                    }
                }
                
                modalContent.innerHTML = content;
                taskModal.style.display = 'flex';
                
                // Initialize task-specific features
                setTimeout(() => {
                    if (task.task_type === 'transcription') {
                        initializeAudioPlayer(task.audio_url);
                    } else if (task.task_type === 'data_entry') {
                        initializeDataEntryTable();
                    }
                    
                    // Start timer if task is in progress
                    if (userTask && (userTask.status === 'assigned' || userTask.status === 'in_progress')) {
                        startTaskTimer();
                    }
                }, 100);
                
            } catch (error) {
                console.error('Error loading task details:', error);
                showNotification('Failed to load task details', 'error');
            } finally {
                hideLoading();
            }
        }

        function createAdvancedToolsSection(task) {
            const taskTypeInfo = TASK_TYPES[task.task_type] || { name: task.task_type, icon: 'fas fa-tasks' };
            
            let toolsHTML = '<div style="margin-bottom: 40px;">';
            toolsHTML += `<h3 style="color: var(--primary); margin-bottom: 25px; font-size: var(--font-size-xl); font-weight: 800;"><i class="fas fa-tools"></i> Advanced Workspace Tools</h3>`;
            toolsHTML += '<div class="advanced-tools">';
            
            // Common tools for all task types
            const commonTools = [
                { icon: 'fas fa-edit', name: 'Text Editor', desc: 'Rich text editor with formatting options', color: 'var(--primary)' },
                { icon: 'fas fa-save', name: 'Auto Save', desc: 'Automatically saves your work every 2 minutes', color: 'var(--success)' },
                { icon: 'fas fa-clock', name: 'Timer', desc: 'Track time spent on the task', color: 'var(--info)' },
                { icon: 'fas fa-spell-check', name: 'Spell Check', desc: 'Check spelling and grammar', color: 'var(--warning)' },
                { icon: 'fas fa-folder-open', name: 'File Manager', desc: 'Upload and manage files', color: 'var(--secondary)' }
            ];
            
            // Task-specific tools
            let taskSpecificTools = [];
            
            switch(task.task_type) {
                case 'academic_writing':
                    taskSpecificTools = [
                        { icon: 'fas fa-quote-right', name: 'Citation Tool', desc: 'Generate citations in various formats', color: 'var(--info)' },
                        { icon: 'fas fa-search', name: 'Plagiarism Check', desc: 'Check for duplicate content', color: 'var(--danger)' },
                        { icon: 'fas fa-list-ol', name: 'Outline Builder', desc: 'Create structured outlines', color: 'var(--primary)' },
                        { icon: 'fas fa-book', name: 'Research Assistant', desc: 'Find relevant academic sources', color: 'var(--success)' }
                    ];
                    break;
                case 'academic_research':
                    taskSpecificTools = [
                        { icon: 'fas fa-chart-bar', name: 'Data Analysis', desc: 'Analyze research data', color: 'var(--info)' },
                        { icon: 'fas fa-chart-line', name: 'Charts & Graphs', desc: 'Create visual representations', color: 'var(--primary)' },
                        { icon: 'fas fa-book-open', name: 'Literature Review', desc: 'Manage research sources', color: 'var(--success)' },
                        { icon: 'fas fa-clipboard-list', name: 'Methodology Builder', desc: 'Structure research methods', color: 'var(--warning)' }
                    ];
                    break;
                case 'content_writing':
                    taskSpecificTools = [
                        { icon: 'fas fa-search', name: 'SEO Analyzer', desc: 'Optimize content for search engines', color: 'var(--success)' },
                        { icon: 'fas fa-chart-line', name: 'Readability Score', desc: 'Check content readability', color: 'var(--info)' },
                        { icon: 'fas fa-key', name: 'Keyword Planner', desc: 'Find relevant keywords', color: 'var(--primary)' },
                        { icon: 'fas fa-share-alt', name: 'Social Media Format', desc: 'Format for social platforms', color: 'var(--secondary)' }
                    ];
                    break;
                case 'data_entry':
                    taskSpecificTools = [
                        { icon: 'fas fa-table', name: 'Spreadsheet', desc: 'Tabular data entry tool', color: 'var(--primary)' },
                        { icon: 'fas fa-check-circle', name: 'Data Validation', desc: 'Validate and clean data', color: 'var(--success)' },
                        { icon: 'fas fa-fill-drip', name: 'Auto-Fill', desc: 'Automatically fill repetitive data', color: 'var(--info)' },
                        { icon: 'fas fa-file-export', name: 'Export Tools', desc: 'Export data in multiple formats', color: 'var(--warning)' }
                    ];
                    break;
                case 'transcription':
                    taskSpecificTools = [
                        { icon: 'fas fa-headphones', name: 'Audio Player', desc: 'Advanced playback controls', color: 'var(--primary)' },
                        { icon: 'fas fa-clock', name: 'Timestamp Tool', desc: 'Insert timestamps easily', color: 'var(--info)' },
                        { icon: 'fas fa-tachometer-alt', name: 'Speed Control', desc: 'Adjust playback speed', color: 'var(--success)' },
                        { icon: 'fas fa-user-friends', name: 'Speaker Labels', desc: 'Identify different speakers', color: 'var(--secondary)' }
                    ];
                    break;
                case 'proofreading':
                    taskSpecificTools = [
                        { icon: 'fas fa-check-double', name: 'Grammar Check', desc: 'Advanced grammar checking', color: 'var(--success)' },
                        { icon: 'fas fa-highlighter', name: 'Highlight Tool', desc: 'Highlight errors and suggestions', color: 'var(--warning)' },
                        { icon: 'fas fa-comments', name: 'Comment System', desc: 'Add comments and feedback', color: 'var(--info)' },
                        { icon: 'fas fa-file-export', name: 'Export Corrections', desc: 'Export corrected document', color: 'var(--primary)' }
                    ];
                    break;
            }
            
            // Combine and render all tools
            const allTools = [...commonTools, ...taskSpecificTools];
            
            allTools.forEach(tool => {
                toolsHTML += `
                    <div class="tool-card" onclick="activateTool('${tool.name}', '${task.task_type}')">
                        <div class="tool-icon" style="color: ${tool.color};">${tool.icon}</div>
                        <div class="tool-name">${tool.name}</div>
                        <div class="tool-desc">${tool.desc}</div>
                    </div>
                `;
            });
            
            toolsHTML += '</div></div>';
            return toolsHTML;
        }

        function createTranscriptionWorkspace(task, userTask) {
            const isEditable = userTask && (userTask.status === 'assigned' || userTask.status === 'in_progress');
            
            let workspaceHTML = '<div class="transcription-workspace">';
            workspaceHTML += `<h3 style="color: var(--primary); margin-bottom: 25px; font-size: var(--font-size-xl); font-weight: 800;"><i class="fas fa-headphones"></i> Transcription Workspace</h3>`;
            
            // Audio player section
            workspaceHTML += '<div class="audio-player-section">';
            workspaceHTML += '<h4 style="margin-bottom: 20px; color: var(--primary); font-size: var(--font-size-lg);"><i class="fas fa-play-circle"></i> Audio Player</h4>';
            workspaceHTML += '<audio id="audioPlayer" controls>';
            workspaceHTML += 'Your browser does not support the audio element.';
            workspaceHTML += '</audio>';
            workspaceHTML += '<div class="audio-controls">';
            workspaceHTML += '<button class="tool-btn" onclick="togglePlayback()"><i class="fas fa-play"></i> Play/Pause</button>';
            workspaceHTML += '<button class="tool-btn" onclick="skipBackward()"><i class="fas fa-backward"></i> Skip -15s</button>';
            workspaceHTML += '<button class="tool-btn" onclick="skipForward()"><i class="fas fa-forward"></i> Skip +15s</button>';
            workspaceHTML += '<select id="playbackSpeed" onchange="changePlaybackSpeed(this.value)" style="padding: 12px; border-radius: 8px; border: 2px solid var(--border); background: white; font-weight: 600;">';
            workspaceHTML += '<option value="0.5">0.5x Speed</option>';
            workspaceHTML += '<option value="0.75">0.75x Speed</option>';
            workspaceHTML += '<option value="1" selected>1x Normal Speed</option>';
            workspaceHTML += '<option value="1.25">1.25x Speed</option>';
            workspaceHTML += '<option value="1.5">1.5x Speed</option>';
            workspaceHTML += '<option value="2">2x Speed</option>';
            workspaceHTML += '</select>';
            workspaceHTML += '</div>';
            workspaceHTML += '</div>';
            
            // Transcription guidelines
            workspaceHTML += '<div class="transcription-guidelines">';
            workspaceHTML += '<h4 style="margin-bottom: 15px; color: var(--primary);"><i class="fas fa-clipboard-list"></i> Transcription Guidelines</h4>';
            workspaceHTML += '<ul style="padding-left: 25px; font-size: var(--font-size-md); line-height: 1.7;">';
            workspaceHTML += '<li>Transcribe exactly what you hear, including filler words (um, uh, etc.)</li>';
            workspaceHTML += '<li>Use proper punctuation and capitalization</li>';
            workspaceHTML += '<li>Indicate speaker changes with [Speaker 1], [Speaker 2], etc.</li>';
            workspaceHTML += '<li>Note unclear sections with [inaudible] or [unclear]</li>';
            workspaceHTML += '<li>Include timestamps for important sections if required</li>';
            workspaceHTML += '<li>Maintain original meaning while improving readability</li>';
            workspaceHTML += '</ul>';
            workspaceHTML += '</div>';
            
            // Text editor for transcription
            workspaceHTML += '<div class="workspace-tools">';
            workspaceHTML += '<h4><i class="fas fa-edit"></i> Transcription Editor</h4>';
            workspaceHTML += '<div class="toolbar">';
            workspaceHTML += '<button class="tool-btn" onclick="insertTimestamp()"><i class="fas fa-clock"></i> Insert Timestamp</button>';
            workspaceHTML += '<button class="tool-btn" onclick="insertSpeakerLabel()"><i class="fas fa-user"></i> Insert Speaker</button>';
            workspaceHTML += '<button class="tool-btn" onclick="insertBackgroundNote()"><i class="fas fa-volume-mute"></i> Background Note</button>';
            workspaceHTML += '<button class="tool-btn" onclick="clearText()"><i class="fas fa-trash"></i> Clear Text</button>';
            workspaceHTML += '<button class="tool-btn" onclick="wordCountCheck()"><i class="fas fa-calculator"></i> Word Count</button>';
            workspaceHTML += '</div>';
            workspaceHTML += '</div>';
            
            // Text area for transcription
            workspaceHTML += `<textarea id="transcriptionText" class="text-editor" placeholder="Start transcribing here... Type or paste your transcription. Use the tools above to insert timestamps and speaker labels." ${isEditable ? '' : 'disabled'}>`;
            workspaceHTML += userTask && userTask.submission_data ? userTask.submission_data : '';
            workspaceHTML += '</textarea>';
            
            // Word count display and actions
            workspaceHTML += '<div style="margin-top: 25px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">';
            workspaceHTML += '<div style="display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: var(--font-size-md);">';
            workspaceHTML += '<span>Word Count:</span>';
            workspaceHTML += '<span id="wordCount" class="good">0</span>';
            workspaceHTML += '</div>';
            
            if (isEditable) {
                workspaceHTML += '<div style="display: flex; gap: 15px;">';
                workspaceHTML += '<button class="btn btn-warning" onclick="saveTranscriptionDraft()">';
                workspaceHTML += '<i class="fas fa-save"></i> Save Draft';
                workspaceHTML += '</button>';
                workspaceHTML += '<button class="btn btn-success" onclick="submitTranscriptionTask()">';
                workspaceHTML += '<i class="fas fa-paper-plane"></i> Submit Transcription';
                workspaceHTML += '</button>';
                workspaceHTML += '</div>';
            }
            workspaceHTML += '</div>';
            
            workspaceHTML += '</div>';
            return workspaceHTML;
        }

        function createDataEntryWorkspace(task, userTask) {
            const isEditable = userTask && (userTask.status === 'assigned' || userTask.status === 'in_progress');
            
            let workspaceHTML = '<div class="data-entry-container">';
            workspaceHTML += `<h3 style="color: var(--primary); margin-bottom: 25px; font-size: var(--font-size-xl); font-weight: 800;"><i class="fas fa-table"></i> Data Entry Workspace</h3>`;
            
            workspaceHTML += '<div class="data-entry-header">';
            workspaceHTML += '<h4 style="color: var(--primary); margin: 0; font-size: var(--font-size-lg);">Data Entry Table</h4>';
            workspaceHTML += '<div style="display: flex; gap: 15px; flex-wrap: wrap;">';
            workspaceHTML += '<button class="btn btn-primary" onclick="addDataEntryRow()"><i class="fas fa-plus"></i> Add Row</button>';
            workspaceHTML += '<button class="btn btn-primary" onclick="addDataEntryColumn()"><i class="fas fa-plus"></i> Add Column</button>';
            workspaceHTML += '<button class="btn btn-warning" onclick="clearDataEntryTable()"><i class="fas fa-trash"></i> Clear Table</button>';
            workspaceHTML += '<button class="btn btn-success" onclick="exportDataEntryTable()"><i class="fas fa-download"></i> Export CSV</button>';
            workspaceHTML += '</div>';
            workspaceHTML += '</div>';
            
            workspaceHTML += '<div class="data-entry-controls">';
            workspaceHTML += '<div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">';
            workspaceHTML += '<span style="font-weight: 800; font-size: var(--font-size-md);">Table Actions:</span>';
            workspaceHTML += '<button class="tool-btn" onclick="sortDataEntryTable()"><i class="fas fa-sort-alpha-down"></i> Sort A-Z</button>';
            workspaceHTML += '<button class="tool-btn" onclick="filterDataEntryTable()"><i class="fas fa-filter"></i> Filter Data</button>';
            workspaceHTML += '<button class="tool-btn" onclick="validateDataEntryTable()"><i class="fas fa-check"></i> Validate Data</button>';
            workspaceHTML += '<button class="tool-btn" onclick="autoFillData()"><i class="fas fa-fill-drip"></i> Auto-Fill</button>';
            workspaceHTML += '</div>';
            workspaceHTML += '</div>';
            
            workspaceHTML += '<div class="data-entry-table-container">';
            workspaceHTML += '<table class="data-entry-table" id="dataEntryTable">';
            workspaceHTML += '<thead>';
            workspaceHTML += '<tr>';
            for (let i = 0; i < dataEntryCols; i++) {
                workspaceHTML += `<th>
                    <div class="column-header">
                        <span>Column ${i+1}</span>
                        <div class="column-actions">
                            <button class="column-action-btn" onclick="renameDataEntryColumn(${i})" title="Rename Column">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="column-action-btn" onclick="removeDataEntryColumn(${i})" title="Remove Column">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </th>`;
            }
            workspaceHTML += '<th>Actions</th>';
            workspaceHTML += '</tr>';
            workspaceHTML += '</thead>';
            workspaceHTML += '<tbody id="dataEntryTableBody">';
            for (let i = 0; i < dataEntryRows; i++) {
                workspaceHTML += '<tr>';
                for (let j = 0; j < dataEntryCols; j++) {
                    workspaceHTML += `<td><input type="text" class="data-entry-cell" data-row="${i}" data-col="${j}" placeholder="Enter data..."></td>`;
                }
                workspaceHTML += `<td>
                    <div class="row-actions">
                        <button class="row-action-btn" onclick="duplicateDataEntryRow(${i})" title="Duplicate Row">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button class="row-action-btn" onclick="removeDataEntryRow(${i})" title="Remove Row">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </td>`;
                workspaceHTML += '</tr>';
            }
            workspaceHTML += '</tbody>';
            workspaceHTML += '</table>';
            workspaceHTML += '</div>';
            
            workspaceHTML += '<div class="data-entry-stats">';
            workspaceHTML += '<div>';
            workspaceHTML += '<span id="dataEntryRowCount">' + dataEntryRows + '</span>';
            workspaceHTML += '<span>Total Rows</span>';
            workspaceHTML += '</div>';
            workspaceHTML += '<div>';
            workspaceHTML += '<span id="dataEntryColCount">' + dataEntryCols + '</span>';
            workspaceHTML += '<span>Total Columns</span>';
            workspaceHTML += '</div>';
            workspaceHTML += '<div>';
            workspaceHTML += '<span id="dataEntryFilledCount">0</span>';
            workspaceHTML += '<span>Filled Cells</span>';
            workspaceHTML += '</div>';
            workspaceHTML += '<div>';
            workspaceHTML += '<span id="dataEntryEmptyCount">' + (dataEntryRows * dataEntryCols) + '</span>';
            workspaceHTML += '<span>Empty Cells</span>';
            workspaceHTML += '</div>';
            workspaceHTML += '</div>';
            
            if (isEditable) {
                workspaceHTML += '<div style="margin-top: 30px; text-align: center;">';
                workspaceHTML += '<button class="btn btn-warning" onclick="saveDataEntryDraft()" style="margin-right: 15px;">';
                workspaceHTML += '<i class="fas fa-save"></i> Save Draft';
                workspaceHTML += '</button>';
                workspaceHTML += '<button class="btn btn-success" onclick="submitDataEntryTask()">';
                workspaceHTML += '<i class="fas fa-paper-plane"></i> Submit Data Entry Task';
                workspaceHTML += '</button>';
                workspaceHTML += '</div>';
            }
            
            workspaceHTML += '</div>';
            return workspaceHTML;
        }

        function createWorkspace(task, userTask, isEditable) {
            const taskTypeInfo = TASK_TYPES[task.task_type] || { name: task.task_type, icon: 'fas fa-tasks' };
            
            let workspaceHTML = '<div class="workspace-tools">';
            workspaceHTML += `<h3><i class="fas fa-desktop"></i> ${taskTypeInfo.name} Workspace</h3>`;
            workspaceHTML += '<div class="workspace-tabs">';
            workspaceHTML += '<button class="workspace-tab active" onclick="switchWorkspaceTab(\'text\')"><i class="fas fa-edit"></i> Text Editor</button>';
            workspaceHTML += '<button class="workspace-tab" onclick="switchWorkspaceTab(\'upload\')"><i class="fas fa-upload"></i> File Upload</button>';
            if (task.task_type === 'data_entry') {
                workspaceHTML += '<button class="workspace-tab" onclick="switchWorkspaceTab(\'spreadsheet\')"><i class="fas fa-table"></i> Spreadsheet</button>';
            }
            if (task.task_type === 'academic_writing' || task.task_type === 'academic_research') {
                workspaceHTML += '<button class="workspace-tab" onclick="switchWorkspaceTab(\'research\')"><i class="fas fa-book"></i> Research</button>';
            }
            workspaceHTML += '</div>';
            workspaceHTML += '</div>';
            
            workspaceHTML += '<div class="workspace-area">';
            
            // Text editor tab
            workspaceHTML += '<div id="textTab" class="workspace-tab-content">';
            workspaceHTML += '<div class="toolbar" style="margin-bottom: 20px;">';
            workspaceHTML += '<button class="tool-btn" onclick="formatText(\'bold\')" title="Bold"><i class="fas fa-bold"></i></button>';
            workspaceHTML += '<button class="tool-btn" onclick="formatText(\'italic\')" title="Italic"><i class="fas fa-italic"></i></button>';
            workspaceHTML += '<button class="tool-btn" onclick="formatText(\'underline\')" title="Underline"><i class="fas fa-underline"></i></button>';
            workspaceHTML += '<button class="tool-btn" onclick="insertBulletList()" title="Bullet List"><i class="fas fa-list-ul"></i></button>';
            workspaceHTML += '<button class="tool-btn" onclick="insertNumberedList()" title="Numbered List"><i class="fas fa-list-ol"></i></button>';
            workspaceHTML += '<button class="tool-btn" onclick="insertLink()" title="Insert Link"><i class="fas fa-link"></i></button>';
            workspaceHTML += '<button class="tool-btn" onclick="insertImage()" title="Insert Image"><i class="fas fa-image"></i></button>';
            workspaceHTML += '<button class="tool-btn" onclick="clearFormatting()" title="Clear Formatting"><i class="fas fa-eraser"></i></button>';
            workspaceHTML += '</div>';
            workspaceHTML += `<textarea id="submissionText" class="text-editor" placeholder="Start working on your task here... Use the formatting tools above to style your content." ${isEditable ? '' : 'disabled'}>`;
            workspaceHTML += userTask && userTask.submission_data ? userTask.submission_data : '';
            workspaceHTML += '</textarea>';
            workspaceHTML += '<div style="margin-top: 15px; display: flex; justify-content: space-between; align-items: center;">';
            workspaceHTML += '<div style="font-weight: 600; color: var(--gray);">';
            workspaceHTML += 'Word Count: <span id="workspaceWordCount">0</span>';
            workspaceHTML += '</div>';
            workspaceHTML += '<div>';
            if (isEditable) {
                workspaceHTML += '<button class="tool-btn" onclick="autoSaveWork()" title="Save Now"><i class="fas fa-save"></i> Save Now</button>';
            }
            workspaceHTML += '</div>';
            workspaceHTML += '</div>';
            workspaceHTML += '</div>';
            
            // File upload tab
            workspaceHTML += '<div id="uploadTab" class="workspace-tab-content" style="display: none;">';
            workspaceHTML += '<div class="file-upload-area" onclick="document.getElementById(\'fileInput\').click()" ondrop="handleFiles(event)" ondragover="event.preventDefault()">';
            workspaceHTML += '<i class="fas fa-cloud-upload-alt" style="font-size: 60px; color: var(--primary); margin-bottom: 20px;"></i>';
            workspaceHTML += '<h4>Drag & Drop Files Here</h4>';
            workspaceHTML += '<p>or click to select files</p>';
            workspaceHTML += '<p style="font-size: 14px; color: var(--gray); margin-top: 10px;">Supported: PDF, DOC, DOCX, TXT, PNG, JPG (Max 10MB each)</p>';
            workspaceHTML += '<input type="file" id="fileInput" multiple style="display: none;" onchange="handleFiles(this.files)">';
            workspaceHTML += '</div>';
            workspaceHTML += '<div id="uploadedFiles"></div>';
            workspaceHTML += '</div>';
            
            // Spreadsheet tab (for data entry tasks)
            if (task.task_type === 'data_entry') {
                workspaceHTML += '<div id="spreadsheetTab" class="workspace-tab-content" style="display: none;">';
                workspaceHTML += '<div class="toolbar">';
                workspaceHTML += '<button class="tool-btn" onclick="addTableRow()"><i class="fas fa-plus"></i> Add Row</button>';
                workspaceHTML += '<button class="tool-btn" onclick="addTableColumn()"><i class="fas fa-plus"></i> Add Column</button>';
                workspaceHTML += '<button class="tool-btn" onclick="clearTable()"><i class="fas fa-trash"></i> Clear Table</button>';
                workspaceHTML += '<button class="tool-btn" onclick="downloadTable()"><i class="fas fa-download"></i> Download CSV</button>';
                workspaceHTML += '</div>';
                workspaceHTML += '<table class="spreadsheet-table" id="dataTable">';
                workspaceHTML += '<thead><tr><th contenteditable="true">Column 1</th></tr></thead>';
                workspaceHTML += '<tbody><tr><td contenteditable="true"></td></tr></tbody>';
                workspaceHTML += '</table>';
                workspaceHTML += '</div>';
            }
            
            // Research tab (for academic tasks)
            if (task.task_type === 'academic_writing' || task.task_type === 'academic_research') {
                workspaceHTML += '<div id="researchTab" class="workspace-tab-content" style="display: none;">';
                workspaceHTML += '<div style="padding: 20px; background: linear-gradient(135deg, #e7f3ff, #d4e7ff); border-radius: 15px; margin-bottom: 20px;">';
                workspaceHTML += '<h4 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-search"></i> Research Tools</h4>';
                workspaceHTML += '<div style="display: flex; gap: 10px; margin-bottom: 15px;">';
                workspaceHTML += '<input type="text" id="researchQuery" placeholder="Search for research topics..." style="flex: 1; padding: 12px; border: 2px solid var(--border); border-radius: 8px;">';
                workspaceHTML += '<button class="tool-btn" onclick="searchResearch()"><i class="fas fa-search"></i> Search</button>';
                workspaceHTML += '</div>';
                workspaceHTML += '<div id="researchResults"></div>';
                workspaceHTML += '</div>';
                workspaceHTML += '<div>';
                workspaceHTML += '<h4 style="color: var(--primary); margin-bottom: 15px;"><i class="fas fa-bookmark"></i> Saved Sources</h4>';
                workspaceHTML += '<div id="savedSources" style="min-height: 100px; padding: 15px; background: white; border-radius: 10px; border: 2px solid var(--border);">';
                workspaceHTML += '<p style="color: var(--gray); text-align: center;">No sources saved yet</p>';
                workspaceHTML += '</div>';
                workspaceHTML += '</div>';
                workspaceHTML += '</div>';
            }
            
            workspaceHTML += '</div>';
            
            // Auto-save indicator
            if (isEditable) {
                workspaceHTML += '<div id="autoSaveIndicator" style="margin-top: 15px; padding: 10px; background: var(--light); border-radius: 8px; text-align: center; font-size: 14px; color: var(--gray); display: none;">';
                workspaceHTML += '<i class="fas fa-save"></i> Auto-saved just now';
                workspaceHTML += '</div>';
            }
            
            return workspaceHTML;
        }

        // ===== TASK ACTIONS =====
        async function startTask() {
            if (!currentTaskId) {
                showNotification('No task selected', 'error');
                return;
            }
            
            await assignTaskAndOpenWorkspace(currentTaskId);
        }

        async function assignTaskAndOpenWorkspace(taskId) {
            if (isAssigningTask) {
                showNotification('Assignment already in progress. Please wait...', 'warning');
                return;
            }

            try {
                isAssigningTask = true;
                showLoading();
                
                // Check if user already has this task
                const existingTask = userTasks.find(ut => ut.task_id === taskId);
                if (existingTask) {
                    // Just open the workspace
                    viewTaskDetails(taskId);
                    hideLoading();
                    isAssigningTask = false;
                    return;
                }

                const task = allTasks.find(t => t.id === taskId);
                if (!task) {
                    showNotification('Task not found', 'error');
                    hideLoading();
                    isAssigningTask = false;
                    return;
                }

                // Check membership requirement
                const userMembership = userProfile ? userProfile.role : 'starter';
                const taskMembership = task.required_membership || 'starter';
                const membershipLevels = { 'starter': 1, 'pro': 2, 'premium': 3, 'elite': 4 };
                
                if (membershipLevels[userMembership] < membershipLevels[taskMembership]) {
                    showMembershipUpgradeModal(taskMembership);
                    hideLoading();
                    isAssigningTask = false;
                    return;
                }

                // Check if task is full
                if (task.is_full) {
                    showNotification('All slots for this task are filled', 'error');
                    hideLoading();
                    isAssigningTask = false;
                    return;
                }

                // Check if task is expired
                if (task.is_expired) {
                    showNotification('This task has expired', 'error');
                    hideLoading();
                    isAssigningTask = false;
                    return;
                }

                // Check with Supabase for existing task
                const { data: existingTasks, error: checkError } = await supabaseClient
                    .from('user_tasks')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .eq('task_id', taskId);

                if (checkError) throw checkError;

                if (existingTasks && existingTasks.length > 0) {
                    await loadUserTasks();
                    viewTaskDetails(taskId);
                    hideLoading();
                    isAssigningTask = false;
                    return;
                }

                // Update task bidder count
                const newBidderCount = (task.current_bidders || 0) + 1;
                const { error: updateError } = await supabaseClient
                    .from('tasks')
                    .update({ current_bidders: newBidderCount })
                    .eq('id', taskId);

                if (updateError) throw updateError;

                // Assign task to user
                const { data, error } = await supabaseClient
                    .from('user_tasks')
                    .insert([{ 
                        user_id: currentUser.id, 
                        task_id: taskId, 
                        status: 'assigned', 
                        assigned_at: new Date().toISOString(),
                        time_spent: 0,
                        submission_data: ''
                    }])
                    .select()
                    .single();

                if (error) {
                    if (error.code === '23505') { // Unique constraint violation
                        await loadUserTasks();
                        viewTaskDetails(taskId);
                    } else {
                        throw error;
                    }
                } else {
                    showNotification('Task assigned successfully!', 'success');
                    await loadUserTasks();
                    await loadTasks(); // Refresh tasks to update bidder count
                    viewTaskDetails(taskId);
                }
                
            } catch (error) {
                console.error('Assignment error:', error);
                showNotification('Failed to assign task: ' + error.message, 'error');
            } finally {
                hideLoading();
                isAssigningTask = false;
            }
        }

        async function submitCurrentTask() {
            if (!currentTaskId || !currentTask) {
                showNotification('No task selected', 'error');
                return;
            }

            try {
                showLoading();
                
                let submissionData = '';
                
                // Get submission data based on task type
                if (currentTask.task_type === 'transcription') {
                    const textArea = document.getElementById('transcriptionText');
                    if (textArea) {
                        submissionData = textArea.value;
                    }
                } else if (currentTask.task_type === 'data_entry') {
                    // Collect data from data entry table
                    const table = document.getElementById('dataEntryTable');
                    if (table) {
                        const data = [];
                        const rows = table.querySelectorAll('tbody tr');
                        
                        rows.forEach(row => {
                            const rowData = {};
                            const cells = row.querySelectorAll('.data-entry-cell');
                            cells.forEach((cell, index) => {
                                const columnHeader = document.querySelector(`thead th:nth-child(${index+1}) span`).textContent;
                                rowData[columnHeader] = cell.value;
                            });
                            data.push(rowData);
                        });
                        
                        submissionData = JSON.stringify(data);
                    }
                } else {
                    const textArea = document.getElementById('submissionText');
                    if (textArea) {
                        submissionData = textArea.value;
                    }
                }
                
                if (!submissionData.trim()) {
                    showNotification('Please complete the task before submitting', 'error');
                    hideLoading();
                    return;
                }

                // Validate word count if required
                if (currentTask.word_count_target) {
                    const wordCount = submissionData.trim().split(/\s+/).length;
                    if (wordCount < currentTask.word_count_target * 0.9) {
                        if (!confirm(`Your submission has ${wordCount} words, but the target is ${currentTask.word_count_target}. Are you sure you want to submit?`)) {
                            hideLoading();
                            return;
                        }
                    }
                }

                // Update user task
                const { error } = await supabaseClient
                    .from('user_tasks')
                    .update({
                        status: 'submitted',
                        submission_data: submissionData,
                        submitted_at: new Date().toISOString(),
                        time_spent: timerSeconds
                    })
                    .eq('user_id', currentUser.id)
                    .eq('task_id', currentTaskId);

                if (error) throw error;

                // Show success message
                showSuccessModal(
                    'Task Submitted Successfully',
                    'Your task has been submitted for review. You will be notified when it\'s approved.',
                    'ðŸŽ‰ Task Submitted!'
                );
                
                // Refresh data
                await loadUserTasks();
                await loadTasks();
                
                // Close task modal
                setTimeout(() => {
                    closeTaskModal();
                }, 2000);
                
            } catch (error) {
                console.error('Submission error:', error);
                showNotification('Failed to submit task: ' + error.message, 'error');
            } finally {
                hideLoading();
            }
        }

        async function submitTranscriptionTask() {
            await submitCurrentTask();
        }

        async function submitDataEntryTask() {
            await submitCurrentTask();
        }

        async function saveTaskDraft() {
            if (!currentTaskId) return;
            
            try {
                let submissionData = '';
                
                if (currentTask.task_type === 'transcription') {
                    const textArea = document.getElementById('transcriptionText');
                    if (textArea) submissionData = textArea.value;
                } else if (currentTask.task_type === 'data_entry') {
                    const table = document.getElementById('dataEntryTable');
                    if (table) {
                        const data = [];
                        const rows = table.querySelectorAll('tbody tr');
                        rows.forEach(row => {
                            const rowData = {};
                            const cells = row.querySelectorAll('.data-entry-cell');
                            cells.forEach((cell, index) => {
                                const columnHeader = document.querySelector(`thead th:nth-child(${index+1}) span`).textContent;
                                rowData[columnHeader] = cell.value;
                            });
                            data.push(rowData);
                        });
                        submissionData = JSON.stringify(data);
                    }
                } else {
                    const textArea = document.getElementById('submissionText');
                    if (textArea) submissionData = textArea.value;
                }
                
                // Save to localStorage as backup
                localStorage.setItem(`task_draft_${currentTaskId}`, submissionData);
                
                // Update in database
                const { error } = await supabaseClient
                    .from('user_tasks')
                    .update({
                        submission_data: submissionData,
                        time_spent: timerSeconds,
                        updated_at: new Date().toISOString()
                    })
                    .eq('user_id', currentUser.id)
                    .eq('task_id', currentTaskId);
                
                if (error) throw error;
                
                showNotification('Draft saved successfully', 'success');
                
            } catch (error) {
                console.error('Save draft error:', error);
                showNotification('Failed to save draft', 'error');
            }
        }

        async function saveTranscriptionDraft() {
            await saveTaskDraft();
        }

        async function saveDataEntryDraft() {
            await saveTaskDraft();
        }

        // ===== MODAL FUNCTIONS =====
        function closeTaskModal() {
            taskModal.style.display = 'none';
            modalContent.innerHTML = '';
            
            // Stop timer
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                isTimerRunning = false;
            }
            
            // Stop auto-save
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
            }
        }

        function closeManualPaymentModal() {
            manualPaymentModal.style.display = 'none';
            transactionMessage.value = '';
            paymentStatusIndicator.style.display = 'none';
            currentPaymentType = null;
            currentPaymentAmount = 0;
        }
        
        function closeMembershipUpgradeModal() {
            membershipUpgradeModal.style.display = 'none';
        }
        
        function closeGuidelinesModal() {
            guidelinesModal.style.display = 'none';
        }
        
        function closeSuccessModal() {
            successModal.style.display = 'none';
        }
        
        function showGuidelinesModal() {
            guidelinesModal.style.display = 'flex';
        }
        
        function showSuccessModal(title, description, message) {
            successTitle.textContent = title;
            successDescription.textContent = description;
            successMessage.textContent = message;
            successModal.style.display = 'flex';
        }

        function showMembershipUpgradeModal(requiredLevel) {
            requiredMembershipLevel.textContent = formatMembership(requiredLevel);
            membershipUpgradeModal.style.display = 'flex';
        }

        function showManualPaymentModal(taskId, paymentType, amount) {
            const task = allTasks.find(t => t.id === taskId);
            if (!task) return;
            
            currentPaymentType = paymentType;
            currentPaymentAmount = amount || TRANSCRIPTION_ACCESS_FEE;
            currentTaskId = taskId;
            
            manualPaymentDescription.textContent = `Pay KSh ${currentPaymentAmount} to access "${task.title}"`;
            manualPaymentAmount.textContent = `KSh ${currentPaymentAmount}`;
            manualMpesaAmount.textContent = currentPaymentAmount.toString();
            mpesaNumberDisplay.textContent = ADMIN_MPESA_NUMBER;
            displayMpesaNumber.textContent = ADMIN_MPESA_NUMBER;
            
            // Reset UI
            paymentStatusIndicator.style.display = 'none';
            transactionMessage.value = '';
            copyMpesaNumberBtn.classList.remove('copied');
            copyMpesaNumberBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Number';
            
            manualPaymentModal.style.display = 'flex';
        }

        // ===== PAYMENT FUNCTIONS =====
        function copyMpesaNumber() {
            navigator.clipboard.writeText(ADMIN_MPESA_NUMBER).then(() => {
                copyMpesaNumberBtn.classList.add('copied');
                copyMpesaNumberBtn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                showNotification('M-Pesa number copied to clipboard', 'success');
                
                setTimeout(() => {
                    copyMpesaNumberBtn.classList.remove('copied');
                    copyMpesaNumberBtn.innerHTML = '<i class="fas fa-copy"></i> Copy Number';
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                showNotification('Failed to copy M-Pesa number', 'error');
            });
        }

        async function submitManualPayment() {
            const message = transactionMessage.value.trim();
            
            if (!message) {
                showNotification('Please paste the M-Pesa confirmation message', 'error');
                return;
            }

            try {
                showLoading();
                
                // Record the payment
                const { data, error } = await supabaseClient
                    .from('payments')
                    .insert([{
                        user_id: currentUser.id,
                        transaction_message: message,
                        amount: currentPaymentAmount,
                        payment_type: currentPaymentType,
                        task_id: currentTaskId,
                        status: 'pending',
                        payment_method: 'manual_mpesa',
                        created_at: new Date().toISOString()
                    }]);
                
                if (error) throw error;
                
                // Show payment status
                paymentStatusIndicator.style.display = 'block';
                paymentStatusIndicator.textContent = 'Payment Under Review - Admin will approve within 24 hours';
                
                showNotification('âœ… Payment submitted for admin approval. You will receive access once approved.', 'success');
                
                // Close modal after 3 seconds
                setTimeout(() => {
                    closeManualPaymentModal();
                    hideLoading();
                }, 3000);
                
            } catch (error) {
                console.error('Payment error:', error);
                showNotification('Failed to submit payment: ' + error.message, 'error');
                hideLoading();
            }
        }
        
        function redirectToMembership() {
            window.location.href = 'membership.html';
        }
        
        function selectMembership(level) {
            showNotification(`Selected ${formatMembership(level)} membership`, 'success');
            closeMembershipUpgradeModal();
            // In a real app, this would redirect to payment page
        }

        // ===== UTILITY FUNCTIONS =====
        function formatTaskType(type) {
            return TASK_TYPES[type]?.name || type.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        function formatDifficulty(difficulty) {
            return DIFFICULTY_LEVELS[difficulty]?.name || difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
        }

        function formatMembership(membership) {
            return membership ? membership.charAt(0).toUpperCase() + membership.slice(1) : 'Starter';
        }

        function formatTaskStatus(status) {
            const statusMap = {
                'assigned': 'Assigned',
                'in_progress': 'In Progress',
                'submitted': 'Submitted for Review',
                'approved': 'Approved',
                'rejected': 'Rejected',
                'expired': 'Expired'
            };
            return statusMap[status] || status.replace('_', ' ').replace(/\b\w/g, l => l.toUpperCase());
        }

        // ===== TIMER FUNCTIONS =====
        function startTaskTimer() {
            if (isTimerRunning || !currentUserTask) return;
            
            isTimerRunning = true;
            timerSeconds = currentUserTask.time_spent || 0;
            
            timerInterval = setInterval(async () => {
                timerSeconds++;
                const timerDisplay = document.getElementById('timerDisplay');
                if (timerDisplay) {
                    const hours = Math.floor(timerSeconds / 3600);
                    const minutes = Math.floor((timerSeconds % 3600) / 60);
                    const seconds = timerSeconds % 60;
                    timerDisplay.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                // Auto-save time every 30 seconds
                if (timerSeconds % 30 === 0 && currentTaskId) {
                    await updateTaskTime();
                }
            }, 1000);
        }

        async function updateTaskTime() {
            if (!currentTaskId) return;
            
            try {
                await supabaseClient
                    .from('user_tasks')
                    .update({
                        time_spent: timerSeconds,
                        updated_at: new Date().toISOString()
                    })
                    .eq('user_id', currentUser.id)
                    .eq('task_id', currentTaskId);
            } catch (error) {
                console.error('Failed to update task time:', error);
            }
        }

        // ===== AUTO-REFRESH FUNCTIONS =====
        function startAutoRefreshTimer() {
            // Auto-refresh tasks every 5 minutes
            setInterval(async () => {
                await loadTasks();
                showNotification('Tasks refreshed automatically', 'info');
            }, 5 * 60 * 1000);
        }

        function startCountdownTimer() {
            function updateCountdown() {
                const now = new Date();
                const midnight = new Date();
                midnight.setHours(24, 0, 0, 0);
                const timeUntilMidnight = midnight - now;
                
                const hours = Math.floor(timeUntilMidnight / (1000 * 60 * 60));
                const minutes = Math.floor((timeUntilMidnight % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeUntilMidnight % (1000 * 60)) / 1000);
                
                if (countdownTimer) {
                    countdownTimer.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }
            
            updateCountdown();
            setInterval(updateCountdown, 1000);
        }

        async function refreshTasks() {
            showLoading();
            await loadTasks();
            showNotification('Tasks refreshed successfully', 'success');
            hideLoading();
        }

        // ===== NOTIFICATION FUNCTIONS =====
        async function initializeNotifications() {
            // Load saved filters
            const saved = localStorage.getItem('savedFilters');
            if (saved) {
                try {
                    savedFilters = JSON.parse(saved);
                } catch (e) {
                    savedFilters = [];
                }
            }
            
            // Initialize notifications
            await loadNotifications();
        }

        async function loadNotifications() {
            try {
                const { data, error } = await supabaseClient
                    .from('notifications')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .eq('read', false)
                    .order('created_at', { ascending: false })
                    .limit(10);
                
                if (error) throw error;
                notifications = data || [];
                updateNotificationBadge();
                
            } catch (error) {
                console.error('Error loading notifications:', error);
                notifications = [];
            }
        }

        function updateNotificationBadge() {
            const count = notifications.length;
            notificationCount.textContent = count > 99 ? '99+' : count;
            notificationCount.style.display = count > 0 ? 'flex' : 'none';
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'times-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                <div class="notification-content">
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        function toggleNotifications() {
            if (notifications.length === 0) {
                showNotification('No new notifications', 'info');
                return;
            }
            
            // Create notifications dropdown
            const dropdown = document.createElement('div');
            dropdown.className = 'modal';
            dropdown.style.display = 'flex';
            dropdown.style.alignItems = 'flex-start';
            dropdown.style.justifyContent = 'flex-end';
            dropdown.style.paddingTop = '100px';
            
            const content = document.createElement('div');
            content.className = 'modal-content';
            content.style.maxWidth = '400px';
            content.style.maxHeight = '500px';
            content.style.overflowY = 'auto';
            
            let notificationsHTML = '<h3 style="margin-bottom: 20px; color: var(--primary);"><i class="fas fa-bell"></i> Notifications</h3>';
            
            notifications.forEach(notification => {
                notificationsHTML += `
                    <div style="padding: 15px; border-bottom: 1px solid var(--border);">
                        <div style="font-weight: 700; margin-bottom: 5px;">${notification.title || 'Notification'}</div>
                        <div style="font-size: 14px; color: var(--gray);">${notification.message}</div>
                        <div style="font-size: 12px; color: var(--gray); margin-top: 5px;">
                            ${new Date(notification.created_at).toLocaleDateString()}
                        </div>
                    </div>
                `;
            });
            
            notificationsHTML += `
                <div style="padding: 15px; text-align: center;">
                    <button class="btn btn-sm btn-primary" onclick="markAllNotificationsAsRead()" style="width: 100%;">
                        Mark All as Read
                    </button>
                </div>
            `;
            
            content.innerHTML = notificationsHTML;
            dropdown.appendChild(content);
            
            // Close when clicking outside
            dropdown.addEventListener('click', function(e) {
                if (e.target === dropdown) {
                    document.body.removeChild(dropdown);
                }
            });
            
            document.body.appendChild(dropdown);
        }

        async function markAllNotificationsAsRead() {
            try {
                const { error } = await supabaseClient
                    .from('notifications')
                    .update({ read: true })
                    .eq('user_id', currentUser.id)
                    .eq('read', false);
                
                if (error) throw error;
                
                notifications = [];
                updateNotificationBadge();
                showNotification('All notifications marked as read', 'success');
                
                // Close dropdown
                const dropdown = document.querySelector('.modal');
                if (dropdown) document.body.removeChild(dropdown);
                
            } catch (error) {
                console.error('Error marking notifications as read:', error);
                showNotification('Failed to mark notifications as read', 'error');
            }
        }

        // ===== QUICK TASK FUNCTION =====
        function findQuickTask() {
            // Find the easiest available task
            const availableTasks = allTasks.filter(task => {
                const userTask = userTasks.find(ut => ut.task_id === task.id);
                return !userTask && !task.is_expired && !task.is_full;
            });
            
            if (availableTasks.length === 0) {
                showNotification('No available tasks found', 'info');
                return;
            }
            
            // Sort by difficulty (beginner first) and reward
            availableTasks.sort((a, b) => {
                const difficultyOrder = { 'beginner': 1, 'intermediate': 2, 'advanced': 3, 'expert': 4 };
                const diffA = difficultyOrder[a.difficulty] || 5;
                const diffB = difficultyOrder[b.difficulty] || 5;
                
                if (diffA !== diffB) return diffA - diffB;
                return b.reward_amount - a.reward_amount; // Higher reward first within same difficulty
            });
            
            // Take the first task
            const quickTask = availableTasks[0];
            viewTaskDetails(quickTask.id);
        }

        // ===== EXPORT FUNCTIONS =====
        function exportTaskHistory() {
            if (userTasks.length === 0) {
                showNotification('No task history to export', 'info');
                return;
            }
            
            let csv = 'Task ID,Task Title,Status,Assigned Date,Submitted Date,Paid Amount,Reward Amount\n';
            
            userTasks.forEach(userTask => {
                const task = allTasks.find(t => t.id === userTask.task_id);
                if (task) {
                    csv += `"${task.id}","${task.title}","${userTask.status}","${userTask.assigned_at}","${userTask.submitted_at || ''}","${userTask.paid_amount || 0}","${task.reward_amount}"\n`;
                }
            });
            
            // Create and download CSV file
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `task_history_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            
            showNotification('Task history exported successfully', 'success');
        }

        function clearTaskFilters() {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[data-tab="all-tasks"]').classList.add('active');
            currentTab = 'all-tasks';
            renderMyTasks();
            showNotification('Task filters cleared', 'success');
        }

        // ===== AUDIO PLAYER FUNCTIONS =====
        function initializeAudioPlayer(audioUrl) {
            audioPlayer = document.getElementById('audioPlayer');
            if (audioPlayer && audioUrl) {
                audioPlayer.src = audioUrl;
                
                audioPlayer.addEventListener('play', function() {
                    isPlaying = true;
                });
                
                audioPlayer.addEventListener('pause', function() {
                    isPlaying = false;
                });
                
                // Update progress bar
                audioPlayer.addEventListener('timeupdate', function() {
                    const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                    const progressBar = document.querySelector('.audio-progress-bar');
                    if (progressBar) {
                        progressBar.style.width = `${progress}%`;
                    }
                });
            }
        }

        function togglePlayback() {
            if (audioPlayer) {
                if (isPlaying) {
                    audioPlayer.pause();
                } else {
                    audioPlayer.play();
                }
            }
        }

        function skipBackward() {
            if (audioPlayer) {
                audioPlayer.currentTime = Math.max(0, audioPlayer.currentTime - 15);
            }
        }

        function skipForward() {
            if (audioPlayer) {
                audioPlayer.currentTime = Math.min(audioPlayer.duration, audioPlayer.currentTime + 15);
            }
        }

        function changePlaybackSpeed(speed) {
            if (audioPlayer) {
                audioPlayer.playbackRate = parseFloat(speed);
            }
        }

        function testAudio(audioUrl) {
            if (audioUrl) {
                window.open(audioUrl, '_blank');
            } else {
                showNotification('No audio URL available', 'error');
            }
        }

        // ===== WORKSPACE FUNCTIONS =====
        function switchWorkspaceTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.workspace-tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.workspace-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab and mark as active
            const tabElement = document.getElementById(tabName + 'Tab');
            if (tabElement) {
                tabElement.style.display = 'block';
            }
            
            // Find and activate the clicked tab
            const tabs = document.querySelectorAll('.workspace-tab');
            tabs.forEach(tab => {
                if (tab.textContent.includes(tabName.replace('_', ' '))) {
                    tab.classList.add('active');
                }
            });
        }

        function insertTimestamp() {
            const textArea = document.getElementById('transcriptionText');
            if (textArea && audioPlayer) {
                const minutes = Math.floor(audioPlayer.currentTime / 60);
                const seconds = Math.floor(audioPlayer.currentTime % 60);
                const timestamp = `[${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}] `;
                insertAtCursor(textArea, timestamp);
            }
        }

        function insertSpeakerLabel() {
            const textArea = document.getElementById('transcriptionText');
            if (textArea) {
                const speakerLabel = '[Speaker]: ';
                insertAtCursor(textArea, speakerLabel);
            }
        }

        function insertBackgroundNote() {
            const textArea = document.getElementById('transcriptionText');
            if (textArea) {
                const note = '[Background noise] ';
                insertAtCursor(textArea, note);
            }
        }

        function clearText() {
            const textArea = document.getElementById('transcriptionText');
            if (textArea && confirm('Are you sure you want to clear all text?')) {
                textArea.value = '';
                updateWordCount();
            }
        }

        function formatText(command) {
            document.execCommand(command, false, null);
        }

        function wordCountCheck() {
            const textArea = document.getElementById('transcriptionText') || document.getElementById('submissionText');
            if (textArea) {
                const wordCount = textArea.value.trim().split(/\s+/).length;
                const charCount = textArea.value.length;
                showNotification(`Word Count: ${wordCount} words, Character Count: ${charCount} characters`, 'info');
                updateWordCount();
            }
        }

        function updateWordCount() {
            const textArea = document.getElementById('transcriptionText');
            const wordCountSpan = document.getElementById('wordCount');
            
            if (textArea && wordCountSpan) {
                const wordCount = textArea.value.trim().split(/\s+/).length;
                wordCountSpan.textContent = wordCount;
                
                // Color code based on word count
                if (wordCount < 100) {
                    wordCountSpan.className = 'low';
                } else if (wordCount < 500) {
                    wordCountSpan.className = 'good';
                } else {
                    wordCountSpan.className = 'excellent';
                }
            }
            
            // Update workspace word count
            const workspaceTextArea = document.getElementById('submissionText');
            const workspaceWordCount = document.getElementById('workspaceWordCount');
            if (workspaceTextArea && workspaceWordCount) {
                const wordCount = workspaceTextArea.value.trim().split(/\s+/).length;
                workspaceWordCount.textContent = wordCount;
            }
        }

        function autoSaveWork() {
            const textArea = document.getElementById('submissionText');
            if (textArea && currentTaskId) {
                localStorage.setItem(`task_draft_${currentTaskId}`, textArea.value);
                
                const indicator = document.getElementById('autoSaveIndicator');
                if (indicator) {
                    indicator.style.display = 'block';
                    setTimeout(() => {
                        indicator.style.display = 'none';
                    }, 2000);
                }
                
                showNotification('Work auto-saved', 'success');
            }
        }

        // Helper function to insert text at cursor position
        function insertAtCursor(textArea, text) {
            const start = textArea.selectionStart;
            const end = textArea.selectionEnd;
            const value = textArea.value;
            
            textArea.value = value.substring(0, start) + text + value.substring(end);
            textArea.selectionStart = textArea.selectionEnd = start + text.length;
            textArea.focus();
        }

        // ===== DATA ENTRY FUNCTIONS =====
        function initializeDataEntryTable() {
            const cells = document.querySelectorAll('.data-entry-cell');
            cells.forEach(cell => {
                cell.addEventListener('input', updateDataEntryStats);
            });
            
            updateDataEntryStats();
        }

        function updateDataEntryStats() {
            const cells = document.querySelectorAll('.data-entry-cell');
            let filledCount = 0;
            let emptyCount = 0;
            
            cells.forEach(cell => {
                if (cell.value.trim() !== '') {
                    filledCount++;
                    cell.style.backgroundColor = '#e8f5e8';
                } else {
                    emptyCount++;
                    cell.style.backgroundColor = '';
                }
            });
            
            document.getElementById('dataEntryFilledCount').textContent = filledCount;
            document.getElementById('dataEntryEmptyCount').textContent = emptyCount;
        }

        function addDataEntryRow() {
            const tableBody = document.getElementById('dataEntryTableBody');
            const newRow = document.createElement('tr');
            const rowIndex = tableBody.children.length;
            
            for (let i = 0; i < dataEntryCols; i++) {
                const cell = document.createElement('td');
                cell.innerHTML = `<input type="text" class="data-entry-cell" data-row="${rowIndex}" data-col="${i}" placeholder="Enter data...">`;
                newRow.appendChild(cell);
            }
            
            const actionsCell = document.createElement('td');
            actionsCell.innerHTML = `
                <div class="row-actions">
                    <button class="row-action-btn" onclick="duplicateDataEntryRow(${rowIndex})" title="Duplicate Row">
                        <i class="fas fa-copy"></i>
                    </button>
                    <button class="row-action-btn" onclick="removeDataEntryRow(${rowIndex})" title="Remove Row">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            newRow.appendChild(actionsCell);
            
            tableBody.appendChild(newRow);
            dataEntryRows++;
            document.getElementById('dataEntryRowCount').textContent = dataEntryRows;
            
            // Add event listeners
            const newCells = newRow.querySelectorAll('.data-entry-cell');
            newCells.forEach(cell => {
                cell.addEventListener('input', updateDataEntryStats);
            });
            
            updateDataEntryStats();
        }

        function addDataEntryColumn() {
            const tableHead = document.querySelector('#dataEntryTable thead tr');
            const tableBody = document.querySelector('#dataEntryTable tbody');
            const colIndex = dataEntryCols;
            
            // Add header cell
            const headerCell = document.createElement('th');
            headerCell.innerHTML = `
                <div class="column-header">
                    <span>Column ${colIndex+1}</span>
                    <div class="column-actions">
                        <button class="column-action-btn" onclick="renameDataEntryColumn(${colIndex})" title="Rename Column">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="column-action-btn" onclick="removeDataEntryColumn(${colIndex})" title="Remove Column">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `;
            tableHead.appendChild(headerCell);
            
            // Add cells to all rows
            const rows = tableBody.querySelectorAll('tr');
            rows.forEach((row, rowIndex) => {
                const cell = document.createElement('td');
                cell.innerHTML = `<input type="text" class="data-entry-cell" data-row="${rowIndex}" data-col="${colIndex}" placeholder="Enter data...">`;
                row.appendChild(cell);
                
                // Add event listener
                const newCell = cell.querySelector('.data-entry-cell');
                newCell.addEventListener('input', updateDataEntryStats);
            });
            
            dataEntryCols++;
            document.getElementById('dataEntryColCount').textContent = dataEntryCols;
            updateDataEntryStats();
        }

        function removeDataEntryRow(rowIndex) {
            const tableBody = document.getElementById('dataEntryTableBody');
            const rows = tableBody.querySelectorAll('tr');
            
            if (rows.length <= 1) {
                showNotification('Cannot remove the last row', 'error');
                return;
            }
            
            if (rowIndex >= 0 && rowIndex < rows.length) {
                tableBody.removeChild(rows[rowIndex]);
                dataEntryRows--;
                document.getElementById('dataEntryRowCount').textContent = dataEntryRows;
                
                // Update indices
                const remainingRows = tableBody.querySelectorAll('tr');
                remainingRows.forEach((row, index) => {
                    const cells = row.querySelectorAll('.data-entry-cell');
                    cells.forEach(cell => {
                        cell.setAttribute('data-row', index);
                    });
                    
                    // Update action buttons
                    const actionButtons = row.querySelectorAll('.row-action-btn');
                    if (actionButtons[0]) {
                        actionButtons[0].setAttribute('onclick', `duplicateDataEntryRow(${index})`);
                    }
                    if (actionButtons[1]) {
                        actionButtons[1].setAttribute('onclick', `removeDataEntryRow(${index})`);
                    }
                });
                
                updateDataEntryStats();
            }
        }

        function removeDataEntryColumn(colIndex) {
            const tableHead = document.querySelector('#dataEntryTable thead tr');
            const tableBody = document.querySelector('#dataEntryTable tbody');
            
            if (tableHead.children.length <= 2) {
                showNotification('Cannot remove the last column', 'error');
                return;
            }
            
            if (colIndex >= 0 && colIndex < dataEntryCols) {
                // Remove header
                tableHead.removeChild(tableHead.children[colIndex]);
                
                // Remove cells
                const rows = tableBody.querySelectorAll('tr');
                rows.forEach(row => {
                    row.removeChild(row.children[colIndex]);
                });
                
                dataEntryCols--;
                document.getElementById('dataEntryColCount').textContent = dataEntryCols;
                
                // Update indices
                const headerCells = tableHead.querySelectorAll('th');
                headerCells.forEach((cell, index) => {
                    if (index < dataEntryCols) {
                        const span = cell.querySelector('span');
                        if (span) span.textContent = `Column ${index+1}`;
                        
                        const actionButtons = cell.querySelectorAll('.column-action-btn');
                        if (actionButtons[0]) {
                            actionButtons[0].setAttribute('onclick', `renameDataEntryColumn(${index})`);
                        }
                        if (actionButtons[1]) {
                            actionButtons[1].setAttribute('onclick', `removeDataEntryColumn(${index})`);
                        }
                    }
                });
                
                // Update cell indices
                const allCells = document.querySelectorAll('.data-entry-cell');
                allCells.forEach(cell => {
                    const currentCol = parseInt(cell.getAttribute('data-col'));
                    if (currentCol > colIndex) {
                        cell.setAttribute('data-col', currentCol - 1);
                    }
                });
                
                updateDataEntryStats();
            }
        }

        function duplicateDataEntryRow(rowIndex) {
            const tableBody = document.getElementById('dataEntryTableBody');
            const rows = tableBody.querySelectorAll('tr');
            
            if (rowIndex >= 0 && rowIndex < rows.length) {
                const rowToDuplicate = rows[rowIndex];
                const newRow = rowToDuplicate.cloneNode(true);
                
                // Update row index
                const newRowIndex = tableBody.children.length;
                const cells = newRow.querySelectorAll('.data-entry-cell');
                cells.forEach(cell => {
                    cell.setAttribute('data-row', newRowIndex);
                });
                
                // Update action buttons
                const actionButtons = newRow.querySelectorAll('.row-action-btn');
                if (actionButtons[0]) {
                    actionButtons[0].setAttribute('onclick', `duplicateDataEntryRow(${newRowIndex})`);
                }
                if (actionButtons[1]) {
                    actionButtons[1].setAttribute('onclick', `removeDataEntryRow(${newRowIndex})`);
                }
                
                tableBody.appendChild(newRow);
                dataEntryRows++;
                document.getElementById('dataEntryRowCount').textContent = dataEntryRows;
                
                // Add event listeners
                const newCells = newRow.querySelectorAll('.data-entry-cell');
                newCells.forEach(cell => {
                    cell.addEventListener('input', updateDataEntryStats);
                });
                
                updateDataEntryStats();
            }
        }

        function renameDataEntryColumn(colIndex) {
            const newName = prompt('Enter new column name:', `Column ${colIndex+1}`);
            if (newName && newName.trim() !== '') {
                const headerCells = document.querySelectorAll('#dataEntryTable thead th');
                if (colIndex >= 0 && colIndex < headerCells.length) {
                    const span = headerCells[colIndex].querySelector('span');
                    if (span) {
                        span.textContent = newName;
                    }
                }
            }
        }

        function clearDataEntryTable() {
            if (confirm('Are you sure you want to clear all data from the table?')) {
                const cells = document.querySelectorAll('.data-entry-cell');
                cells.forEach(cell => {
                    cell.value = '';
                });
                updateDataEntryStats();
                showNotification('Table cleared successfully', 'success');
            }
        }

        function exportDataEntryTable() {
            const table = document.getElementById('dataEntryTable');
            let csv = [];
            
            // Headers
            const headers = [];
            const headerCells = table.querySelectorAll('thead th');
            headerCells.forEach((cell, index) => {
                if (index < dataEntryCols) {
                    const span = cell.querySelector('span');
                    headers.push(span ? span.textContent : `Column ${index+1}`);
                }
            });
            csv.push(headers.join(','));
            
            // Data
            const rows = table.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const rowData = [];
                const cells = row.querySelectorAll('.data-entry-cell');
                cells.forEach(cell => {
                    rowData.push(`"${cell.value.replace(/"/g, '""')}"`);
                });
                csv.push(rowData.join(','));
            });
            
            // Download
            const csvContent = "data:text/csv;charset=utf-8," + csv.join('\n');
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `data_entry_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Data exported as CSV', 'success');
        }

        function sortDataEntryTable() {
            showNotification('Table sorting functionality would be implemented here', 'info');
        }

        function filterDataEntryTable() {
            showNotification('Table filtering functionality would be implemented here', 'info');
        }

        function validateDataEntryTable() {
            const cells = document.querySelectorAll('.data-entry-cell');
            let emptyCells = 0;
            let invalidCells = 0;
            
            cells.forEach(cell => {
                const value = cell.value.trim();
                if (value === '') {
                    emptyCells++;
                    cell.style.backgroundColor = '#ffebee';
                } else {
                    // Basic validation - check if it looks like valid data
                    // This is a simple example - in a real app you'd have more specific validation
                    if (value.length > 100) {
                        invalidCells++;
                        cell.style.backgroundColor = '#fff3cd';
                    } else {
                        cell.style.backgroundColor = '#e8f5e8';
                    }
                }
            });
            
            if (emptyCells > 0 || invalidCells > 0) {
                showNotification(`Found ${emptyCells} empty cells and ${invalidCells} potentially invalid cells`, 'warning');
            } else {
                showNotification('All data validated successfully!', 'success');
            }
        }

        function autoFillData() {
            showNotification('Auto-fill would populate common data patterns', 'info');
        }

        // ===== TOOL ACTIVATION =====
        function activateTool(toolName, taskType) {
            switch(toolName) {
                case 'Text Editor':
                    switchWorkspaceTab('text');
                    showNotification('Text editor activated. Start writing your content.', 'info');
                    break;
                case 'Auto Save':
                    if (!autoSaveInterval) {
                        autoSaveInterval = setInterval(() => {
                            if (currentTaskId) autoSaveWork();
                        }, 120000); // 2 minutes
                    }
                    showNotification('Auto-save enabled. Your work will be saved automatically every 2 minutes.', 'success');
                    break;
                case 'Timer':
                    showNotification('Timer is already running and tracking your time spent on this task.', 'info');
                    break;
                case 'Spell Check':
                    const textArea = document.getElementById('submissionText') || document.getElementById('transcriptionText');
                    if (textArea) {
                        const text = textArea.value;
                        // Simple spell check implementation
                        const commonMisspellings = ['recieve', 'seperate', 'definately', 'occured', 'untill', 'alot'];
                        let foundErrors = [];
                        
                        commonMisspellings.forEach(word => {
                            const regex = new RegExp(`\\b${word}\\b`, 'gi');
                            if (text.match(regex)) {
                                foundErrors.push(word);
                            }
                        });
                        
                        if (foundErrors.length > 0) {
                            showNotification(`Potential spelling issues: ${foundErrors.join(', ')}`, 'warning');
                        } else {
                            showNotification('No obvious spelling errors detected.', 'success');
                        }
                    }
                    break;
                case 'File Manager':
                    switchWorkspaceTab('upload');
                    showNotification('File upload area activated. You can now upload supporting files.', 'info');
                    break;
                // Add more tool implementations as needed
                default:
                    showNotification(`Tool "${toolName}" activated for ${taskType} tasks.`, 'info');
            }
        }

        // ===== FILE UPLOAD HANDLING =====
        function handleFiles(files) {
            const fileList = files.length ? files : event.dataTransfer.files;
            const uploadedFilesDiv = document.getElementById('uploadedFiles');
            
            if (!uploadedFilesDiv) return;
            
            // Clear previous files if needed
            if (uploadedFilesDiv.children.length === 0) {
                uploadedFilesDiv.innerHTML = '<h4 style="margin-bottom: 15px; color: var(--primary);"><i class="fas fa-folder-open"></i> Uploaded Files</h4>';
            }
            
            for (let i = 0; i < fileList.length; i++) {
                const file = fileList[i];
                const fileItem = document.createElement('div');
                fileItem.style.cssText = 'background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: var(--shadow-sm); border-left: 4px solid var(--primary);';
                fileItem.innerHTML = `
                    <div style="flex: 1;">
                        <div style="font-weight: 700; margin-bottom: 5px;">${file.name}</div>
                        <div style="font-size: 14px; color: var(--gray);">
                            ${(file.size / 1024).toFixed(2)} KB â€¢ ${file.type || 'Unknown type'}
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <button class="tool-btn" onclick="previewFile(this)" style="background: var(--info);" title="Preview">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="tool-btn" onclick="removeFile(this)" style="background: var(--danger);" title="Remove">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                uploadedFilesDiv.appendChild(fileItem);
            }
            
            showNotification(`Added ${fileList.length} file(s)`, 'success');
        }

        function previewFile(button) {
            const fileItem = button.closest('div');
            const fileName = fileItem.querySelector('div > div:first-child').textContent;
            showNotification(`Previewing: ${fileName}`, 'info');
            // In a real app, this would open a file preview
        }

        function removeFile(button) {
            const fileItem = button.closest('div');
            fileItem.remove();
            showNotification('File removed', 'info');
        }

        // ===== GLOBAL EXPORTS =====
        // Export functions to global scope for HTML onclick handlers
        window.showTab = showTab;
        window.viewTaskDetails = viewTaskDetails;
        window.assignTaskAndOpenWorkspace = assignTaskAndOpenWorkspace;
        window.submitCurrentTask = submitCurrentTask;
        window.submitTranscriptionTask = submitTranscriptionTask;
        window.submitDataEntryTask = submitDataEntryTask;
        window.saveTaskDraft = saveTaskDraft;
        window.saveTranscriptionDraft = saveTranscriptionDraft;
        window.saveDataEntryDraft = saveDataEntryDraft;
        window.closeTaskModal = closeTaskModal;
        window.switchWorkspaceTab = switchWorkspaceTab;
        window.showMembershipUpgradeModal = showMembershipUpgradeModal;
        window.showManualPaymentModal = showManualPaymentModal;
        window.showGuidelinesModal = showGuidelinesModal;
        window.selectMembership = selectMembership;
        window.handleFiles = handleFiles;
        window.previewFile = previewFile;
        window.removeFile = removeFile;
        window.togglePlayback = togglePlayback;
        window.skipBackward = skipBackward;
        window.skipForward = skipForward;
        window.changePlaybackSpeed = changePlaybackSpeed;
        window.insertTimestamp = insertTimestamp;
        window.insertSpeakerLabel = insertSpeakerLabel;
        window.insertBackgroundNote = insertBackgroundNote;
        window.clearText = clearText;
        window.formatText = formatText;
        window.wordCountCheck = wordCountCheck;
        window.autoSaveWork = autoSaveWork;
        window.activateTool = activateTool;
        window.testAudio = testAudio;
        window.addDataEntryRow = addDataEntryRow;
        window.addDataEntryColumn = addDataEntryColumn;
        window.removeDataEntryRow = removeDataEntryRow;
        window.removeDataEntryColumn = removeDataEntryColumn;
        window.duplicateDataEntryRow = duplicateDataEntryRow;
        window.renameDataEntryColumn = renameDataEntryColumn;
        window.clearDataEntryTable = clearDataEntryTable;
        window.exportDataEntryTable = exportDataEntryTable;
        window.sortDataEntryTable = sortDataEntryTable;
        window.filterDataEntryTable = filterDataEntryTable;
        window.validateDataEntryTable = validateDataEntryTable;
        window.autoFillData = autoFillData;
        window.changePage = changePage;
        window.loadFilter = loadFilter;
        window.deleteFilter = deleteFilter;
        window.markAllNotificationsAsRead = markAllNotificationsAsRead;

        // Initialize the app
        initializeApp();
    </script>
</body>
</html>
