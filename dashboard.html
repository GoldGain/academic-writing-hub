<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Academic Writing Hub - Earn through academic writing, research, and content creation">
  <meta name="keywords" content="academic writing, earn money online, freelance writing, research papers, content creation">
  <meta name="author" content="Academic Writing Hub">
  <meta name="theme-color" content="#004aad">
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Apple Touch Icon -->
  <link rel="apple-touch-icon" href="/icons/icon-192x192.png">
  
  <title>Dashboard - Academic Writing Hub</title>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- AOS Animation -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  
  <!-- Toast Notifications -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  
  <!-- Supabase JS Library -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <style>
    :root {
      --primary: #004aad;
      --primary-light: #3a6fc8;
      --primary-dark: #00337a;
      --secondary: #ff6b35;
      --secondary-light: #ff8c5a;
      --success: #10b981;
      --success-light: #34d399;
      --warning: #f59e0b;
      --warning-light: #fbbf24;
      --danger: #ef4444;
      --danger-light: #f87171;
      --light: #f8fafc;
      --dark: #1e293b;
      --dark-light: #334155;
      --gray: #64748b;
      --gray-light: #e2e8f0;
      --border: #e2e8f0;
      --card-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      --hover-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.06);
      --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
      --gradient-success: linear-gradient(135deg, var(--success) 0%, var(--success-light) 100%);
      --gradient-warning: linear-gradient(135deg, var(--warning) 0%, var(--warning-light) 100%);
      --gradient-danger: linear-gradient(135deg, var(--danger) 0%, var(--danger-light) 100%);
      --gold: #ffd700;
      --gold-light: #fff9c4;
      --gold-dark: #b8860b;
      --executive: #8b5cf6;
      --vip: #f59e0b;
      --elite: #dc2626;
      --purple: #8b5cf6;
      --teal: #14b8a6;
      --cyan: #06b6d4;
      --pink: #ec4899;
      --indigo: #6366f1;
      --dark-bg: #0f172a;
      --dark-card: #1e293b;
      --dark-border: #334155;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      overflow-x: hidden;
      transition: all 0.3s ease;
    }

    body.dark-mode {
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e2e8f0;
    }

    /* Moving Header Announcement - SLOWED DOWN TO HALF SPEED */
    .header-announcement {
      background: var(--gradient-primary);
      color: white;
      padding: 12px 20px;
      text-align: center;
      font-size: 16px;
      font-weight: 600;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 2000;
      box-shadow: 0 2px 15px rgba(0, 74, 173, 0.2);
      overflow: hidden;
      height: 45px;
    }

    .announcement-container {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 40px;
      width: 100%;
    }

    .marquee-text {
      white-space: nowrap;
      animation: marquee 40s linear infinite; /* CHANGED FROM 20s TO 40s (HALF SPEED) */
      display: flex;
      align-items: center;
      gap: 40px;
      padding: 0 20px;
    }

    .marquee-text span {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .marquee-text i {
      font-size: 14px;
      color: var(--gold);
    }

    @keyframes marquee {
      0% {
        transform: translateX(100%);
      }
      100% {
        transform: translateX(-100%);
      }
    }

    /* Pause animation on hover */
    .header-announcement:hover .marquee-text {
      animation-play-state: paused;
    }

    /* Header Styles */
    header {
      background: white;
      color: var(--dark);
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 25px rgba(0, 0, 0, 0.08);
      position: sticky;
      top: 45px;
      z-index: 1000;
      backdrop-filter: blur(10px);
      min-height: 75px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }

    body.dark-mode header {
      background: var(--dark-card);
      color: #e2e8f0;
      border-bottom-color: rgba(255, 255, 255, 0.05);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo {
      width: 50px;
      height: 50px;
      background: var(--gradient-primary);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      box-shadow: 0 4px 15px rgba(0, 74, 173, 0.2);
      color: white;
      transition: transform 0.3s ease;
    }

    .logo:hover {
      transform: rotate(15deg);
    }

    .header-title {
      display: flex;
      flex-direction: column;
    }

    .header-title h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 900;
      letter-spacing: -0.5px;
      line-height: 1.2;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-title .slogan {
      font-size: 13px;
      color: var(--gray);
      margin-top: 2px;
      font-weight: 500;
    }

    body.dark-mode .header-title .slogan {
      color: #94a3b8;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    /* Theme Toggle */
    .theme-toggle {
      position: relative;
      width: 60px;
      height: 30px;
      background: rgba(0, 74, 173, 0.1);
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      display: flex;
      align-items: center;
      padding: 0 5px;
    }

    body.dark-mode .theme-toggle {
      background: rgba(255, 255, 255, 0.1);
    }

    .theme-toggle::before {
      content: '';
      position: absolute;
      left: 5px;
      width: 22px;
      height: 22px;
      background: var(--primary);
      border-radius: 50%;
      transition: transform 0.3s ease;
    }

    body.dark-mode .theme-toggle::before {
      transform: translateX(30px);
      background: var(--warning);
    }

    .theme-toggle i {
      font-size: 14px;
      z-index: 1;
    }

    .theme-toggle .fa-sun {
      margin-right: auto;
      color: var(--warning);
    }

    .theme-toggle .fa-moon {
      margin-left: auto;
      color: var(--primary);
    }

    body.dark-mode .theme-toggle .fa-sun {
      color: var(--warning-light);
    }

    body.dark-mode .theme-toggle .fa-moon {
      color: #94a3b8;
    }

    /* Notification Bell */
    .notification-bell {
      position: relative;
      width: 45px;
      height: 45px;
      background: rgba(0, 74, 173, 0.1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      color: var(--primary);
    }

    body.dark-mode .notification-bell {
      background: rgba(255, 255, 255, 0.1);
      color: #e2e8f0;
    }

    .notification-bell:hover {
      background: rgba(0, 74, 173, 0.2);
      transform: translateY(-2px);
    }

    body.dark-mode .notification-bell:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .notification-count {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      font-size: 11px;
      font-weight: 800;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* User Menu */
    .user-menu {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      padding: 8px 16px;
      border-radius: 50px;
      transition: all 0.3s ease;
      background: rgba(0, 74, 173, 0.05);
      position: relative;
      min-width: 180px;
    }

    body.dark-mode .user-menu {
      background: rgba(255, 255, 255, 0.05);
    }

    .user-menu:hover {
      background: rgba(0, 74, 173, 0.1);
      transform: translateY(-2px);
    }

    body.dark-mode .user-menu:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .user-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: var(--gradient-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      color: white;
      box-shadow: 0 4px 15px rgba(255, 107, 53, 0.2);
      font-size: 18px;
      transition: transform 0.3s ease;
    }

    .user-avatar:hover {
      transform: scale(1.1);
    }

    .user-info {
      flex: 1;
      min-width: 0;
    }

    .user-name {
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .user-role {
      font-size: 11px;
      opacity: 0.8;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 2px;
    }

    .mobile-menu-btn {
      display: none;
      background: rgba(0, 74, 173, 0.1);
      border: none;
      color: var(--primary);
      width: 45px;
      height: 45px;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 20px;
    }

    body.dark-mode .mobile-menu-btn {
      background: rgba(255, 255, 255, 0.1);
      color: #e2e8f0;
    }

    .mobile-menu-btn:hover {
      background: rgba(0, 74, 173, 0.2);
      transform: rotate(90deg);
    }

    body.dark-mode .mobile-menu-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Container Layout */
    .container {
      display: flex;
      min-height: calc(100vh - 120px);
      margin-top: 45px;
      overflow: hidden;
    }

    /* Enhanced Sidebar with More Features */
    nav {
      width: 320px;
      background: white;
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(0, 0, 0, 0.05);
      padding: 25px 0;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 5px 0 30px rgba(0, 0, 0, 0.05);
      z-index: 999;
      overflow-y: auto;
      position: relative;
      display: flex;
      flex-direction: column;
    }

    body.dark-mode nav {
      background: var(--dark-card);
      border-right-color: rgba(255, 255, 255, 0.05);
    }

    .sidebar-header {
      padding: 0 25px 25px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
    }

    body.dark-mode .sidebar-header {
      border-bottom-color: rgba(255, 255, 255, 0.05);
    }

    .sidebar-header h3 {
      font-size: 14px;
      font-weight: 700;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    body.dark-mode .sidebar-header h3 {
      color: #94a3b8;
    }

    nav a {
      padding: 16px 30px;
      text-decoration: none;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 15px;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      margin: 5px 0;
      border-left: 4px solid transparent;
      font-weight: 600;
    }

    body.dark-mode nav a {
      color: #e2e8f0;
    }

    nav a::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      width: 4px;
      height: 100%;
      background: var(--primary);
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    nav a:hover::before {
      transform: scaleY(1);
    }

    nav a:hover {
      background: linear-gradient(90deg, rgba(0, 74, 173, 0.05), transparent);
      color: var(--primary);
      transform: translateX(5px);
    }

    body.dark-mode nav a:hover {
      background: linear-gradient(90deg, rgba(0, 74, 173, 0.1), transparent);
      color: #60a5fa;
    }

    nav a.active {
      background: linear-gradient(90deg, rgba(0, 74, 173, 0.1), transparent);
      color: var(--primary);
      border-left-color: var(--primary);
    }

    body.dark-mode nav a.active {
      background: linear-gradient(90deg, rgba(0, 74, 173, 0.2), transparent);
      color: #60a5fa;
    }

    .nav-icon {
      width: 24px;
      text-align: center;
      font-size: 18px;
      transition: transform 0.3s ease;
    }

    nav a:hover .nav-icon {
      transform: scale(1.2);
    }

    .nav-badge {
      background: var(--secondary);
      color: white;
      font-size: 11px;
      padding: 3px 10px;
      border-radius: 20px;
      margin-left: auto;
      font-weight: 800;
      min-width: 24px;
      text-align: center;
      animation: badgePulse 2s infinite;
    }

    @keyframes badgePulse {
      0% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0.4); }
      70% { box-shadow: 0 0 0 5px rgba(255, 107, 53, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 107, 53, 0); }
    }

    /* Sidebar Bottom Section */
    .sidebar-bottom {
      margin-top: auto;
      padding: 20px 25px;
      border-top: 1px solid rgba(0, 0, 0, 0.05);
    }

    body.dark-mode .sidebar-bottom {
      border-top-color: rgba(255, 255, 255, 0.05);
    }

    .app-download-card {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      border-radius: 16px;
      padding: 20px;
      color: white;
      margin-bottom: 20px;
    }

    .app-download-card h4 {
      font-size: 16px;
      font-weight: 700;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .app-download-card p {
      font-size: 13px;
      opacity: 0.9;
      margin-bottom: 15px;
      line-height: 1.4;
    }

    .app-stores {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .store-btn {
      padding: 12px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s ease;
      text-decoration: none;
    }

    .store-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }

    .store-btn i {
      font-size: 16px;
    }

    .pwa-install-btn {
      width: 100%;
      padding: 12px;
      background: var(--success);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s ease;
      margin-top: 10px;
    }

    .pwa-install-btn:hover {
      background: var(--success-light);
      transform: translateY(-2px);
    }

    /* Main Content */
    main {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      position: relative;
      max-width: calc(100vw - 320px);
    }

    body.dark-mode main {
      background: linear-gradient(135deg, #0f172a 0%, #1c2536 100%);
    }

    /* Welcome Hero */
    .welcome-hero {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 50%, var(--secondary) 100%);
      color: white;
      padding: 40px;
      border-radius: 24px;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 74, 173, 0.3);
      animation: gradientShift 8s ease infinite;
    }

    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .welcome-hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" x="0" y="0" width="20" height="20" patternUnits="userSpaceOnUse"><circle cx="10" cy="10" r="1" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
      animation: patternMove 20s linear infinite;
    }

    @keyframes patternMove {
      0% { background-position: 0 0; }
      100% { background-position: 20px 20px; }
    }

    .welcome-content {
      position: relative;
      z-index: 2;
    }

    .welcome-content h2 {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 15px;
      line-height: 1.2;
    }

    .welcome-content p {
      font-size: 16px;
      opacity: 0.9;
      max-width: 600px;
      margin-bottom: 30px;
    }

    .welcome-actions {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .welcome-btn {
      padding: 12px 24px;
      border-radius: 50px;
      border: none;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .welcome-btn.primary {
      background: white;
      color: var(--primary);
    }

    .welcome-btn.secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .welcome-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }

    .welcome-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
    }

    .welcome-stat {
      display: flex;
      flex-direction: column;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .welcome-stat:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.25);
    }

    .welcome-stat-value {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 8px;
    }

    .welcome-stat-label {
      font-size: 13px;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--card-shadow);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(0, 0, 0, 0.05);
      animation: fadeInUp 0.6s ease forwards;
      opacity: 0;
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; }
    .stat-card:nth-child(4) { animation-delay: 0.4s; }
    .stat-card:nth-child(5) { animation-delay: 0.5s; }

    body.dark-mode .stat-card {
      background: var(--dark-card);
      border-color: rgba(255, 255, 255, 0.05);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--gradient-primary);
      transform: scaleX(0);
      transform-origin: left;
      transition: transform 0.4s ease;
    }

    .stat-card:hover {
      transform: translateY(-10px);
      box-shadow: var(--hover-shadow);
    }

    .stat-card:hover::before {
      transform: scaleX(1);
    }

    .stat-card.balance { border-top: 4px solid var(--success); }
    .stat-card.earnings { border-top: 4px solid var(--warning); }
    .stat-card.today { border-top: 4px solid var(--purple); }
    .stat-card.membership { border-top: 4px solid var(--primary); }
    .stat-card.tasks { border-top: 4px solid var(--danger); }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 20px;
    }

    .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      color: white;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .stat-card.balance .stat-icon { background: var(--gradient-success); }
    .stat-card.earnings .stat-icon { background: var(--gradient-warning); }
    .stat-card.today .stat-icon { background: linear-gradient(135deg, var(--purple) 0%, #a78bfa 100%); }
    .stat-card.membership .stat-icon { background: var(--gradient-primary); }
    .stat-card.tasks .stat-icon { background: var(--gradient-danger); }

    .stat-trend {
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .trend-up {
      background: rgba(16, 185, 129, 0.15);
      color: var(--success);
    }

    .trend-down {
      background: rgba(239, 68, 68, 0.15);
      color: var(--danger);
    }

    .trend-neutral {
      background: rgba(100, 116, 139, 0.15);
      color: var(--gray);
    }

    body.dark-mode .trend-up {
      background: rgba(16, 185, 129, 0.25);
    }
    body.dark-mode .trend-down {
      background: rgba(239, 68, 68, 0.25);
    }
    body.dark-mode .trend-neutral {
      background: rgba(100, 116, 139, 0.25);
    }

    .stat-value {
      font-size: 40px;
      font-weight: 900;
      color: var(--dark);
      margin-bottom: 10px;
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    body.dark-mode .stat-value {
      color: #fff;
    }

    .currency-conversion {
      font-size: 14px;
      color: var(--gray);
      font-weight: 500;
      margin-top: 5px;
      opacity: 0.8;
    }

    body.dark-mode .currency-conversion {
      color: #94a3b8;
    }

    .stat-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    body.dark-mode .stat-label {
      color: #94a3b8;
    }

    /* Enhanced Earnings Dashboard */
    .earnings-dashboard {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      color: white;
      padding: 40px;
      border-radius: 24px;
      margin: 30px 0;
      position: relative;
      overflow: hidden;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3);
    }

    .earnings-bg {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0.1;
      background: 
        radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(255, 107, 53, 0.3) 0%, transparent 50%);
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      position: relative;
      z-index: 2;
    }

    .dashboard-header h3 {
      font-size: 28px;
      font-weight: 800;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .dashboard-header h3 i {
      color: var(--gold);
      animation: spinSlow 3s linear infinite;
    }

    @keyframes spinSlow {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .period-selector {
      display: flex;
      gap: 10px;
      background: rgba(255, 255, 255, 0.1);
      padding: 8px;
      border-radius: 50px;
      backdrop-filter: blur(10px);
    }

    .period-btn {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      padding: 10px 25px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .period-btn:hover {
      color: white;
      background: rgba(255, 255, 255, 0.1);
    }

    .period-btn.active {
      background: var(--gold);
      color: #1e293b;
      box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
    }

    .earnings-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
      position: relative;
      z-index: 2;
    }

    .earning-stat-card {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 25px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }

    .earning-stat-card:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.25);
    }

    .earning-stat-value {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 10px;
      color: var(--gold);
    }

    .earning-stat-label {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .earning-stat-change {
      font-size: 13px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .change-up {
      color: var(--success-light);
    }

    .change-down {
      color: var(--danger-light);
    }

    /* Charts Section */
    .charts-section {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }

    .chart-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--card-shadow);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    body.dark-mode .chart-card {
      background: var(--dark-card);
    }

    .chart-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--hover-shadow);
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
    }

    .chart-header h4 {
      font-size: 18px;
      font-weight: 800;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 12px;
    }

    body.dark-mode .chart-header h4 {
      color: #fff;
    }

    .chart-actions {
      display: flex;
      gap: 10px;
    }

    .chart-btn {
      background: rgba(0, 74, 173, 0.1);
      border: none;
      color: var(--primary);
      padding: 8px 16px;
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    body.dark-mode .chart-btn {
      background: rgba(255, 255, 255, 0.1);
      color: #e2e8f0;
    }

    .chart-btn:hover {
      background: rgba(0, 74, 173, 0.2);
    }

    body.dark-mode .chart-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }

    /* Quick Actions */
    .quick-actions-section {
      margin-bottom: 40px;
    }

    .quick-actions-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 25px;
    }

    .action-card {
      background: white;
      border-radius: 20px;
      padding: 30px;
      text-decoration: none;
      color: var(--dark);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: var(--card-shadow);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    body.dark-mode .action-card {
      background: var(--dark-card);
      color: #e2e8f0;
    }

    .action-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(0, 74, 173, 0.05), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .action-card:hover {
      transform: translateY(-10px);
      box-shadow: var(--hover-shadow);
      border-color: var(--primary);
    }

    body.dark-mode .action-card:hover {
      border-color: #60a5fa;
    }

    .action-card:hover::before {
      opacity: 1;
    }

    .action-icon {
      width: 80px;
      height: 80px;
      border-radius: 20px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: white;
      margin-bottom: 25px;
      box-shadow: 0 10px 30px rgba(0, 74, 173, 0.3);
      transition: all 0.3s ease;
    }

    .action-card:hover .action-icon {
      transform: scale(1.1) rotate(5deg);
    }

    .action-card:nth-child(2) .action-icon {
      background: linear-gradient(135deg, var(--success) 0%, var(--success-light) 100%);
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    }

    .action-card:nth-child(3) .action-icon {
      background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
      box-shadow: 0 10px 30px rgba(255, 107, 53, 0.3);
    }

    .action-card:nth-child(4) .action-icon {
      background: linear-gradient(135deg, var(--warning) 0%, var(--warning-light) 100%);
      box-shadow: 0 10px 30px rgba(245, 158, 11, 0.3);
    }

    .action-title {
      font-size: 22px;
      font-weight: 800;
      margin-bottom: 15px;
    }

    .action-desc {
      font-size: 15px;
      color: var(--gray);
      line-height: 1.6;
      margin-bottom: 20px;
    }

    body.dark-mode .action-desc {
      color: #94a3b8;
    }

    .action-btn {
      padding: 12px 24px;
      background: rgba(0, 74, 173, 0.1);
      color: var(--primary);
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    body.dark-mode .action-btn {
      background: rgba(255, 255, 255, 0.1);
      color: #60a5fa;
    }

    .action-btn:hover {
      background: rgba(0, 74, 173, 0.2);
      transform: translateY(-2px);
    }

    body.dark-mode .action-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Achievements Section */
    .achievements-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: var(--card-shadow);
    }

    body.dark-mode .achievements-section {
      background: var(--dark-card);
    }

    .section-title {
      font-size: 24px;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    body.dark-mode .section-title {
      color: #fff;
    }

    .section-title i {
      color: var(--primary);
      font-size: 26px;
    }

    .badges-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 20px;
    }

    .badge {
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      padding: 15px;
      border-radius: 16px;
      background: rgba(0, 74, 173, 0.05);
    }

    body.dark-mode .badge {
      background: rgba(255, 255, 255, 0.05);
    }

    .badge:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: var(--card-shadow);
    }

    .badge-icon {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      color: white;
      font-size: 28px;
      position: relative;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
    }

    .badge.fast-task .badge-icon {
      background: linear-gradient(135deg, #ff6b35 0%, #ff8c5a 100%);
    }

    .badge.week-warrior .badge-icon {
      background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
    }

    .badge.referral-pro .badge-icon {
      background: linear-gradient(135deg, #8b5cf6 0%, #a78bfa 100%);
    }

    .badge.writing-expert .badge-icon {
      background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
    }

    .badge.top-earner .badge-icon {
      background: linear-gradient(135deg, #ef4444 0%, #f87171 100%);
    }

    .badge.consistency .badge-icon {
      background: linear-gradient(135deg, #06b6d4 0%, #22d3ee 100%);
    }

    .badge.locked .badge-icon {
      background: var(--gray-light);
      color: var(--gray);
    }

    body.dark-mode .badge.locked .badge-icon {
      background: #334155;
      color: #64748b;
    }

    .badge.earned .badge-icon::after {
      content: 'âœ“';
      position: absolute;
      top: -5px;
      right: -5px;
      width: 24px;
      height: 24px;
      background: var(--success);
      border-radius: 50%;
      color: white;
      font-size: 14px;
      font-weight: 800;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .badge-name {
      font-size: 14px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 5px;
    }

    body.dark-mode .badge-name {
      color: #fff;
    }

    .badge-progress {
      font-size: 12px;
      color: var(--gray);
      font-weight: 600;
    }

    body.dark-mode .badge-progress {
      color: #94a3b8;
    }

    /* Membership Section */
    .membership-section {
      margin-bottom: 50px;
    }

    .membership-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      background: rgba(0, 74, 173, 0.05);
      padding: 10px;
      border-radius: 50px;
      overflow-x: auto;
    }

    body.dark-mode .membership-tabs {
      background: rgba(255, 255, 255, 0.05);
    }

    .membership-tab {
      background: transparent;
      border: none;
      padding: 12px 30px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
    }

    .membership-tab:hover {
      background: rgba(0, 74, 173, 0.1);
    }

    body.dark-mode .membership-tab:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .membership-tab.active {
      background: var(--primary);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 74, 173, 0.3);
    }

    .membership-cards {
      display: none;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .membership-cards.active {
      display: grid;
    }

    .membership-card {
      background: white;
      border-radius: 24px;
      padding: 40px;
      border: 2px solid var(--border);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    body.dark-mode .membership-card {
      background: var(--dark-card);
      border-color: var(--dark-border);
    }

    .membership-card:hover {
      transform: translateY(-10px);
      box-shadow: var(--hover-shadow);
      border-color: var(--primary);
    }

    body.dark-mode .membership-card:hover {
      border-color: #60a5fa;
    }

    .membership-badge {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--secondary);
      color: white;
      font-size: 12px;
      padding: 6px 18px;
      border-radius: 20px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .membership-card.premium .membership-badge {
      background: var(--gold);
      color: var(--dark);
    }

    .membership-card.vip .membership-badge {
      background: linear-gradient(135deg, var(--vip) 0%, var(--warning-light) 100%);
    }

    .membership-card.elite .membership-badge {
      background: linear-gradient(135deg, var(--elite) 0%, var(--danger-light) 100%);
    }

    .membership-header {
      margin-bottom: 30px;
    }

    .membership-name {
      font-size: 32px;
      font-weight: 900;
      color: var(--dark);
      margin-bottom: 15px;
    }

    body.dark-mode .membership-name {
      color: #fff;
    }

    .membership-price {
      font-size: 48px;
      font-weight: 900;
      color: var(--primary);
      margin-bottom: 10px;
    }

    .membership-price small {
      font-size: 18px;
      color: var(--gray);
      font-weight: 500;
    }

    .membership-features {
      list-style: none;
      margin: 30px 0;
    }

    .membership-features li {
      padding: 14px 0;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 15px;
      font-size: 16px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    body.dark-mode .membership-features li {
      color: #e2e8f0;
      border-bottom-color: rgba(255, 255, 255, 0.05);
    }

    .membership-features li:last-child {
      border-bottom: none;
    }

    .membership-features li i {
      color: var(--success);
      font-size: 18px;
      width: 24px;
    }

    .upgrade-btn {
      width: 100%;
      padding: 20px;
      border: none;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s ease;
      background: var(--gradient-primary);
      color: white;
      box-shadow: 0 8px 30px rgba(0, 74, 173, 0.3);
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .upgrade-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 40px rgba(0, 74, 173, 0.4);
    }

    .upgrade-btn:disabled {
      background: var(--gray-light);
      color: var(--gray);
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    body.dark-mode .upgrade-btn:disabled {
      background: #334155;
      color: #94a3b8;
    }

    /* App Download Section */
    .app-download-section {
      background: linear-gradient(135deg, var(--dark) 0%, var(--dark-light) 100%);
      color: white;
      padding: 60px 40px;
      border-radius: 24px;
      margin: 50px 0;
      position: relative;
      overflow: hidden;
      text-align: center;
      box-shadow: 0 25px 70px rgba(0, 0, 0, 0.3);
    }

    .app-download-section::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite linear;
    }

    @keyframes shimmer {
      0% { transform: rotate(45deg) translateX(-100%); }
      100% { transform: rotate(45deg) translateX(100%); }
    }

    .app-content {
      position: relative;
      z-index: 2;
      max-width: 800px;
      margin: 0 auto;
    }

    .app-icon-large {
      font-size: 100px;
      margin-bottom: 30px;
      display: inline-block;
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    .app-title {
      font-size: 48px;
      font-weight: 900;
      margin-bottom: 20px;
      background: linear-gradient(135deg, var(--gold) 0%, var(--warning) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .app-subtitle {
      font-size: 20px;
      opacity: 0.9;
      margin-bottom: 50px;
      line-height: 1.6;
    }

    .app-features-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 25px;
      margin-bottom: 50px;
    }

    .app-feature {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
    }

    .app-feature:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.15);
    }

    .app-feature i {
      font-size: 36px;
      color: var(--gold);
      margin-bottom: 20px;
    }

    .app-feature h4 {
      font-size: 20px;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .app-feature p {
      font-size: 15px;
      opacity: 0.8;
      line-height: 1.5;
    }

    .store-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 40px;
      flex-wrap: wrap;
    }

    .store-btn-large {
      padding: 20px 40px;
      background: white;
      color: #333;
      border-radius: 16px;
      display: flex;
      align-items: center;
      gap: 15px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s ease;
      min-width: 200px;
    }

    .store-btn-large:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
    }

    .store-btn-large i {
      font-size: 28px;
    }

    .app-install-options {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      margin-top: 40px;
    }

    .app-install-options h4 {
      font-size: 22px;
      font-weight: 700;
      margin-bottom: 25px;
      text-align: center;
    }

    .install-methods {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }

    .install-method {
      background: rgba(255, 255, 255, 0.1);
      padding: 25px;
      border-radius: 16px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .install-method:hover {
      background: rgba(255, 255, 255, 0.15);
      transform: translateY(-5px);
    }

    .install-method i {
      font-size: 32px;
      color: var(--gold);
      margin-bottom: 15px;
    }

    .install-method h5 {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .install-method p {
      font-size: 14px;
      opacity: 0.8;
      margin-bottom: 15px;
    }

    .install-btn {
      padding: 12px 24px;
      background: var(--gold);
      color: var(--dark);
      border: none;
      border-radius: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .install-btn:hover {
      background: #ffec8b;
      transform: translateY(-2px);
    }

    /* Recent Activity */
    .recent-activity {
      margin-bottom: 50px;
    }

    .activity-filters {
      display: flex;
      gap: 15px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .activity-filter {
      background: white;
      border: 2px solid var(--border);
      padding: 12px 28px;
      border-radius: 50px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    body.dark-mode .activity-filter {
      background: var(--dark-card);
      border-color: var(--dark-border);
      color: #e2e8f0;
    }

    .activity-filter:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
    }

    body.dark-mode .activity-filter:hover {
      border-color: #60a5fa;
    }

    .activity-filter.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }

    .activity-list {
      list-style: none;
    }

    .activity-item {
      background: white;
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 25px;
      transition: all 0.3s ease;
      border: 1px solid transparent;
    }

    body.dark-mode .activity-item {
      background: var(--dark-card);
    }

    .activity-item:hover {
      transform: translateX(5px);
      border-color: var(--primary);
      box-shadow: var(--card-shadow);
    }

    body.dark-mode .activity-item:hover {
      border-color: #60a5fa;
    }

    .activity-icon {
      width: 70px;
      height: 70px;
      border-radius: 18px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 28px;
      flex-shrink: 0;
      transition: transform 0.3s ease;
    }

    .activity-item:hover .activity-icon {
      transform: rotate(15deg);
    }

    .activity-item.withdrawal .activity-icon {
      background: linear-gradient(135deg, var(--success) 0%, var(--success-light) 100%);
    }

    .activity-item.task .activity-icon {
      background: linear-gradient(135deg, var(--warning) 0%, var(--warning-light) 100%);
    }

    .activity-item.referral .activity-icon {
      background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
    }

    .activity-content {
      flex: 1;
      min-width: 0;
    }

    .activity-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 10px;
    }

    body.dark-mode .activity-title {
      color: #fff;
    }

    .activity-desc {
      font-size: 15px;
      color: var(--gray);
      margin-bottom: 15px;
      line-height: 1.5;
    }

    body.dark-mode .activity-desc {
      color: #94a3b8;
    }

    .activity-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .activity-time {
      font-size: 14px;
      color: var(--gray);
      font-weight: 500;
    }

    body.dark-mode .activity-time {
      color: #94a3b8;
    }

    .activity-amount {
      font-size: 22px;
      font-weight: 900;
      color: var(--success);
    }

    .activity-amount.negative {
      color: var(--danger);
    }

    /* Enhanced Footer */
    footer {
      background: linear-gradient(135deg, var(--dark) 0%, #1e293b 100%);
      color: #94a3b8;
      padding: 60px 30px 30px;
      border-radius: 24px 24px 0 0;
      margin-top: 60px;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 50px;
    }

    .footer-section h4 {
      color: white;
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .footer-section h4 i {
      color: var(--gold);
    }

    .footer-links {
      list-style: none;
    }

    .footer-links li {
      margin-bottom: 15px;
    }

    .footer-links a {
      color: #94a3b8;
      text-decoration: none;
      transition: all 0.3s ease;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .footer-links a:hover {
      color: white;
      transform: translateX(5px);
    }

    .footer-bottom {
      text-align: center;
      padding-top: 40px;
      margin-top: 50px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      color: #64748b;
      font-size: 14px;
    }

    /* Messages */
    .message {
      padding: 20px 30px;
      border-radius: 16px;
      margin: 20px 0;
      font-weight: 600;
      animation: slideInRight 0.5s ease;
      backdrop-filter: blur(10px);
      border-left: 4px solid transparent;
    }

    @keyframes slideInRight {
      from { transform: translateX(30px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .message.success {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(16, 185, 129, 0.05) 100%);
      color: var(--success);
      border-left-color: var(--success);
    }

    .message.error {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.05) 100%);
      color: var(--danger);
      border-left-color: var(--danger);
    }

    .message.info {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.15) 0%, rgba(59, 130, 246, 0.05) 100%);
      color: var(--primary);
      border-left-color: var(--primary);
    }

    /* Loading Animations */
    .loading {
      display: inline-block;
      width: 24px;
      height: 24px;
      border: 3px solid rgba(0, 74, 173, 0.1);
      border-top: 3px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: loading 1.5s infinite;
      border-radius: 8px;
    }

    @keyframes loading {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    body.dark-mode .skeleton {
      background: linear-gradient(90deg, #334155 25%, #475569 50%, #334155 75%);
    }

    /* Legal Pages Modal */
    .legal-modal-content {
      max-height: 60vh;
      overflow-y: auto;
      padding-right: 10px;
    }

    .legal-modal-content h3 {
      color: var(--primary);
      margin-bottom: 20px;
      font-size: 24px;
    }

    .legal-modal-content h4 {
      color: var(--dark);
      margin: 25px 0 15px;
      font-size: 18px;
    }

    body.dark-mode .legal-modal-content h4 {
      color: #fff;
    }

    .legal-modal-content p {
      margin-bottom: 15px;
      line-height: 1.6;
    }

    .legal-modal-content ul {
      margin: 15px 0;
      padding-left: 20px;
    }

    .legal-modal-content li {
      margin-bottom: 10px;
      line-height: 1.5;
    }

    /* ENHANCED TRAINING SECTION */
    .training-promo-section {
      background: linear-gradient(135deg, #1a237e 0%, #283593 50%, #3949ab 100%);
      color: white;
      padding: 40px;
      border-radius: 24px;
      margin: 30px 0;
      position: relative;
      overflow: hidden;
      box-shadow: 0 25px 70px rgba(26, 35, 126, 0.3);
    }

    .training-bg {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      opacity: 0.1;
      background: 
        radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(33, 150, 243, 0.3) 0%, transparent 50%);
    }

    .training-promo-content {
      position: relative;
      z-index: 2;
      text-align: center;
      max-width: 800px;
      margin: 0 auto;
    }

    .training-promo-content h2 {
      font-size: 36px;
      font-weight: 900;
      margin-bottom: 20px;
      color: white;
    }

    .training-promo-content p {
      font-size: 18px;
      opacity: 0.9;
      margin-bottom: 30px;
      line-height: 1.6;
    }

    .training-modules-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin: 40px 0;
    }

    .training-module {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      transition: all 0.3s ease;
      cursor: pointer;
      text-align: center;
    }

    .training-module:hover {
      transform: translateY(-10px);
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.25);
    }

    .training-module i {
      font-size: 48px;
      color: var(--gold);
      margin-bottom: 20px;
    }

    .training-module h3 {
      font-size: 22px;
      font-weight: 800;
      margin-bottom: 15px;
      color: white;
    }

    .training-module p {
      font-size: 15px;
      opacity: 0.8;
      margin-bottom: 20px;
    }

    .training-module .module-duration {
      font-size: 14px;
      color: var(--gold);
      font-weight: 600;
      margin-top: 10px;
    }

    .training-cta {
      margin-top: 40px;
    }

    .training-cta-btn {
      padding: 18px 40px;
      background: var(--gold);
      color: #1a237e;
      border: none;
      border-radius: 16px;
      font-size: 18px;
      font-weight: 800;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 8px 30px rgba(255, 215, 0, 0.3);
    }

    .training-cta-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(255, 215, 0, 0.4);
      background: #ffec8b;
    }

    /* Responsive Design - Improved for Mobile */
    @media (max-width: 1200px) {
      .charts-section {
        grid-template-columns: 1fr;
      }
      
      .membership-cards {
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      }
      
      main {
        max-width: 100%;
      }
    }

    @media (max-width: 992px) {
      nav {
        position: fixed;
        top: 120px;
        left: 0;
        height: calc(100vh - 120px);
        transform: translateX(-100%);
        width: 320px;
        box-shadow: 10px 0 40px rgba(0, 0, 0, 0.15);
        z-index: 1001;
      }

      nav.active {
        transform: translateX(0);
      }

      .mobile-menu-btn {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .header-right {
        gap: 15px;
      }

      .user-menu {
        min-width: 160px;
      }

      main {
        padding: 25px;
        width: 100%;
        max-width: 100%;
      }

      .welcome-hero {
        padding: 30px;
      }

      .welcome-content h2 {
        font-size: 30px;
      }

      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      }

      .earnings-stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
      
      /* Mobile overlay for sidebar */
      .sidebar-overlay {
        display: none;
        position: fixed;
        top: 120px;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
      }
      
      .sidebar-overlay.active {
        display: block;
      }
      
      .training-promo-section {
        padding: 30px;
      }
      
      .training-promo-content h2 {
        font-size: 30px;
      }
    }

    @media (max-width: 768px) {
      header {
        padding: 15px 20px;
      }

      .header-title h1 {
        font-size: 20px;
      }

      .header-title .slogan {
        font-size: 12px;
      }

      .user-menu {
        min-width: 140px;
        padding: 6px 12px;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        font-size: 16px;
      }

      .user-info {
        display: block;
      }

      .welcome-hero {
        padding: 25px;
      }

      .welcome-content h2 {
        font-size: 26px;
      }

      .welcome-actions {
        flex-direction: column;
      }

      .welcome-stats {
        grid-template-columns: repeat(2, 1fr);
      }

      .stats-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }

      .stat-card {
        padding: 25px;
      }

      .stat-value {
        font-size: 36px;
      }

      .earnings-dashboard {
        padding: 30px 25px;
      }

      .dashboard-header {
        flex-direction: column;
        gap: 20px;
        align-items: flex-start;
      }

      .period-selector {
        width: 100%;
        justify-content: space-between;
      }

      .period-btn {
        flex: 1;
        text-align: center;
        padding: 10px 15px;
      }

      .quick-actions-grid {
        grid-template-columns: 1fr;
      }

      .action-card {
        padding: 25px;
      }

      .membership-cards {
        grid-template-columns: 1fr;
      }

      .app-download-section {
        padding: 40px 25px;
      }

      .app-title {
        font-size: 36px;
      }

      .app-features-grid {
        grid-template-columns: 1fr;
      }

      .store-buttons {
        flex-direction: column;
        align-items: center;
      }

      .store-btn-large {
        width: 100%;
        max-width: 300px;
      }

      .install-methods {
        grid-template-columns: 1fr;
      }
      
      .training-modules-grid {
        grid-template-columns: 1fr;
      }
      
      .training-promo-content h2 {
        font-size: 26px;
      }
      
      .training-promo-content p {
        font-size: 16px;
      }
    }

    @media (max-width: 576px) {
      .header-left {
        gap: 10px;
      }

      .logo {
        width: 45px;
        height: 45px;
        font-size: 20px;
      }

      .header-title h1 {
        font-size: 18px;
      }

      .theme-toggle {
        width: 50px;
        height: 26px;
      }

      .theme-toggle::before {
        width: 20px;
        height: 20px;
      }

      .welcome-hero {
        padding: 20px;
      }

      .welcome-content h2 {
        font-size: 22px;
      }

      .welcome-stats {
        grid-template-columns: 1fr;
      }

      .stat-card {
        padding: 20px;
      }

      .stat-value {
        font-size: 32px;
      }

      .earnings-stats-grid {
        grid-template-columns: 1fr;
      }

      .chart-card {
        padding: 20px;
      }

      .chart-header {
        flex-direction: column;
        gap: 15px;
        align-items: flex-start;
      }

      .chart-actions {
        width: 100%;
        justify-content: space-between;
      }

      .chart-btn {
        flex: 1;
        text-align: center;
      }

      .membership-tabs {
        overflow-x: auto;
        padding: 8px;
      }

      .membership-tab {
        padding: 10px 20px;
        font-size: 13px;
      }

      .membership-card {
        padding: 25px;
      }

      .membership-price {
        font-size: 36px;
      }

      .activity-item {
        flex-direction: column;
        text-align: center;
        gap: 15px;
      }

      .activity-meta {
        flex-direction: column;
        gap: 10px;
      }

      .footer-content {
        grid-template-columns: 1fr;
        gap: 30px;
      }
      
      .training-promo-section {
        padding: 20px;
      }
      
      .training-promo-content h2 {
        font-size: 22px;
      }
    }

    @media (max-width: 480px) {
      .header-right {
        gap: 10px;
      }

      .user-menu {
        min-width: 120px;
      }

      .user-info {
        display: none;
      }

      .welcome-content h2 {
        font-size: 20px;
      }

      .stat-icon {
        width: 50px;
        height: 50px;
        font-size: 22px;
      }

      .membership-name {
        font-size: 24px;
      }

      .app-title {
        font-size: 28px;
      }

      .app-icon-large {
        font-size: 60px;
      }
      
      .announcement-container {
        gap: 20px;
      }
      
      .marquee-text {
        gap: 20px;
      }
      
      .marquee-text span {
        font-size: 14px;
      }
      
      .training-cta-btn {
        padding: 15px 30px;
        font-size: 16px;
      }
    }
    
    /* EXTRA RESPONSIVE FIXES FOR SMALL SCREENS */
    @media (max-width: 360px) {
      .header-right {
        flex-wrap: wrap;
        justify-content: flex-end;
      }
      
      .user-menu {
        min-width: 100px;
      }
      
      .welcome-content h2 {
        font-size: 18px;
      }
      
      .training-module {
        padding: 20px;
      }
      
      .training-module i {
        font-size: 36px;
      }
      
      .training-module h3 {
        font-size: 18px;
      }
    }
    
    /* Prevent horizontal scrolling */
    html, body {
      max-width: 100%;
      overflow-x: hidden;
    }
    
    /* Ensure all content fits within viewport */
    .container {
      max-width: 100vw;
    }
  </style>
</head>
<body>

  <!-- Moving Header Announcement -->
  <div class="header-announcement">
    <div class="announcement-container">
      <div class="marquee-text">
        <span><i class="fas fa-star"></i> ACADEMIC WRITING HUB <i class="fas fa-star"></i></span>
        <span><i class="fas fa-graduation-cap"></i> Professional Academic Writing Platform <i class="fas fa-graduation-cap"></i></span>
        <span><i class="fas fa-dollar-sign"></i> Earn Money Writing Academic Papers <i class="fas fa-dollar-sign"></i></span>
        <span><i class="fas fa-chart-line"></i> Boost Your Writing Career <i class="fas fa-chart-line"></i></span>
        <span><i class="fas fa-users"></i> Join Thousands of Successful Writers <i class="fas fa-users"></i></span>
        <span><i class="fas fa-award"></i> Quality Writing Opportunities <i class="fas fa-award"></i></span>
        <span><i class="fas fa-rocket"></i> Start Earning Today! <i class="fas fa-rocket"></i></span>
      </div>
    </div>
  </div>

  <header>
    <div class="header-left">
      <div class="logo">
        <i class="fas fa-graduation-cap"></i>
      </div>
      <div class="header-title">
        <h1>Academic Writing Hub</h1>
        <div class="slogan">Professional Writing Platform for Academic Success</div>
      </div>
    </div>
    <div class="header-right">
      <div class="notification-bell" id="notificationBell">
        <i class="fas fa-bell"></i>
        <span class="notification-count" id="notificationCount">0</span>
      </div>
      <div class="theme-toggle" id="themeToggle">
        <i class="fas fa-sun"></i>
        <i class="fas fa-moon"></i>
      </div>
      <div class="user-menu" id="userMenu">
        <div class="user-avatar" id="userAvatar">U</div>
        <div class="user-info">
          <div class="user-name" id="userName">Loading...</div>
          <div class="user-role" id="userRole">Member</div>
        </div>
        <i class="fas fa-chevron-down"></i>
      </div>
      <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>

  <!-- Mobile Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <div class="container">
    <nav id="sidebar">
      <div class="sidebar-header">
        <h3>Navigation Menu</h3>
      </div>
      
      <a href="dashboard.html" class="active">
        <div class="nav-icon"><i class="fas fa-home"></i></div>
        <span>Dashboard</span>
        <span class="nav-badge" id="dashboardBadge">New</span>
      </a>
      
      <a href="tasks.html">
        <div class="nav-icon"><i class="fas fa-tasks"></i></div>
        <span>Writing Tasks</span>
        <span class="nav-badge" id="tasksBadge">0</span>
      </a>
      
      <a href="earnings.html">
        <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
        <span>Earnings</span>
      </a>
      
      <a href="withdraw.html">
        <div class="nav-icon"><i class="fas fa-wallet"></i></div>
        <span>Withdraw</span>
      </a>
      
      <a href="referrals.html">
        <div class="nav-icon"><i class="fas fa-user-plus"></i></div>
        <span>Refer & Earn</span>
        <span class="nav-badge" id="referralsBadge">0</span>
      </a>
      
      <a href="membership.html">
        <div class="nav-icon"><i class="fas fa-crown"></i></div>
        <span>Membership</span>
      </a>
      
      <a href="training.html">
        <div class="nav-icon"><i class="fas fa-graduation-cap"></i></div>
        <span>Training</span>
        <span class="nav-badge" id="trainingBadge">Free</span>
      </a>
      
      <a href="leaderboard.html">
        <div class="nav-icon"><i class="fas fa-medal"></i></div>
        <span>Leaderboard</span>
      </a>
      
      <a href="support.html">
        <div class="nav-icon"><i class="fas fa-headset"></i></div>
        <span>Help Center</span>
      </a>
      
      <a href="profile.html">
        <div class="nav-icon"><i class="fas fa-user-cog"></i></div>
        <span>Profile Settings</span>
      </a>
      
      <a href="#" id="logoutBtn">
        <div class="nav-icon"><i class="fas fa-sign-out-alt"></i></div>
        <span>Logout</span>
      </a>

      <!-- App Download Card -->
      <div class="sidebar-bottom">
        <div class="app-download-card">
          <h4><i class="fas fa-mobile-alt"></i> Mobile App</h4>
          <p>Download our mobile app for better experience and notifications</p>
          <div class="app-stores">
            <button class="store-btn" onclick="downloadApp('ios')">
              <i class="fab fa-apple"></i> App Store
            </button>
            <button class="store-btn" onclick="downloadApp('android')">
              <i class="fab fa-android"></i> Play Store
            </button>
            <button class="pwa-install-btn" id="pwaInstallBtn">
              <i class="fas fa-download"></i> Install PWA
            </button>
          </div>
        </div>
      </div>
    </nav>

    <main>
      <!-- Message Container -->
      <div id="messageContainer"></div>

      <!-- Welcome Hero Section -->
      <div class="welcome-hero" data-aos="fade-up">
        <div class="welcome-content">
          <h2 id="welcomeMessage">Welcome back, Writer!</h2>
          <p>Continue your journey in academic writing excellence. Track your progress, complete tasks, and maximize your earnings with our comprehensive platform.</p>
          
          <div class="welcome-actions">
            <button class="welcome-btn secondary" onclick="window.location.href='training.html'">
              <i class="fas fa-graduation-cap"></i> Training Center
            </button>
            <button class="welcome-btn secondary" onclick="showAppDownloadModal()">
              <i class="fas fa-mobile-alt"></i> Get Mobile App
            </button>
          </div>
          
          <div class="welcome-stats">
            <div class="welcome-stat">
              <div class="welcome-stat-value" id="heroBalance">$0.00</div>
              <div class="welcome-stat-label">Available Balance</div>
            </div>
            <div class="welcome-stat">
              <div class="welcome-stat-value" id="heroEarnings">$0.00</div>
              <div class="welcome-stat-label">Total Earnings</div>
            </div>
            <div class="welcome-stat">
              <div class="welcome-stat-value" id="heroTasks">0</div>
              <div class="welcome-stat-label">Tasks Completed</div>
            </div>
            <div class="welcome-stat">
              <div class="welcome-stat-value" id="heroStreak">0</div>
              <div class="welcome-stat-label">Day Streak</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Training Promo Section -->
      <div class="training-promo-section" data-aos="fade-up">
        <div class="training-bg"></div>
        <div class="training-promo-content">
          <h2><i class="fas fa-graduation-cap"></i> Master Academic Writing Skills</h2>
          <p>Boost your earnings potential with our comprehensive training modules. Learn transcription, data entry, academic writing, and research skills from industry experts.</p>
          
          <div class="training-modules-grid">
            <div class="training-module" onclick="window.location.href='training.html#transcription'">
              <i class="fas fa-keyboard"></i>
              <h3>Transcription</h3>
              <p>Learn to convert audio/video to text accurately with proper formatting and time coding</p>
              <div class="module-duration">4 Modules â€¢ 8 Hours</div>
            </div>
            
            <div class="training-module" onclick="window.location.href='training.html#data-entry'">
              <i class="fas fa-table"></i>
              <h3>Data Entry</h3>
              <p>Master data organization, spreadsheet management, and data validation techniques</p>
              <div class="module-duration">3 Modules â€¢ 6 Hours</div>
            </div>
            
            <div class="training-module" onclick="window.location.href='training.html#academic-writing'">
              <i class="fas fa-pen-fancy"></i>
              <h3>Academic Writing</h3>
              <p>Learn essay structure, research paper formatting, citation styles, and academic tone</p>
              <div class="module-duration">6 Modules â€¢ 12 Hours</div>
            </div>
            
            <div class="training-module" onclick="window.location.href='training.html#academic-research'">
              <i class="fas fa-search"></i>
              <h3>Academic Research</h3>
              <p>Master research methodologies, source evaluation, and literature review techniques</p>
              <div class="module-duration">5 Modules â€¢ 10 Hours</div>
            </div>
          </div>
          
          <div class="training-cta">
            <button class="training-cta-btn" onclick="window.location.href='training.html'">
              <i class="fas fa-play-circle"></i> Start Learning Now
            </button>
          </div>
        </div>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card balance" data-aos="fade-up">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-wallet"></i>
            </div>
            <span class="stat-trend trend-up" id="balanceTrend">+0%</span>
          </div>
          <div class="stat-value" id="balanceAmount">$0.00</div>
          <div class="currency-conversion" id="balanceKsh">Ksh 0</div>
          <div class="stat-label">Account Balance</div>
        </div>
        
        <div class="stat-card earnings" data-aos="fade-up" data-aos-delay="100">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <span class="stat-trend trend-up" id="earningsTrend">+0%</span>
          </div>
          <div class="stat-value" id="totalEarnings">$0.00</div>
          <div class="currency-conversion" id="earningsKsh">Ksh 0</div>
          <div class="stat-label">Total Earnings</div>
        </div>
        
        <div class="stat-card today" data-aos="fade-up" data-aos-delay="200">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-sun"></i>
            </div>
            <span class="stat-trend trend-up" id="todayTrend">+0%</span>
          </div>
          <div class="stat-value" id="todayEarnings">$0.00</div>
          <div class="currency-conversion" id="todayKsh">Ksh 0</div>
          <div class="stat-label">Today's Earnings</div>
        </div>
        
        <div class="stat-card membership" data-aos="fade-up" data-aos-delay="300">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-crown"></i>
            </div>
            <span class="stat-trend trend-neutral">â€”</span>
          </div>
          <div class="stat-value" id="membershipType">Basic</div>
          <div class="stat-label">Membership Level</div>
        </div>
        
        <div class="stat-card tasks" data-aos="fade-up" data-aos-delay="400">
          <div class="stat-header">
            <div class="stat-icon">
              <i class="fas fa-check-circle"></i>
            </div>
            <span class="stat-trend trend-up" id="tasksTrend">+0%</span>
          </div>
          <div class="stat-value" id="tasksCompleted">0</div>
          <div class="stat-label">Tasks Completed</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions-section" data-aos="fade-up">
        <h3 class="section-title"><i class="fas fa-bolt"></i> Quick Actions</h3>
        <div class="quick-actions-grid">
          <div class="action-card" onclick="window.location.href='tasks.html'">
            <div class="action-icon">
              <i class="fas fa-search"></i>
            </div>
            <h3 class="action-title">Browse All Tasks</h3>
            <p class="action-desc">Explore hundreds of available writing tasks across various academic disciplines and difficulty levels.</p>
            <button class="action-btn">View Tasks</button>
          </div>
          
          <div class="action-card" onclick="window.location.href='withdraw.html'">
            <div class="action-icon">
              <i class="fas fa-money-bill-wave"></i>
            </div>
            <h3 class="action-title">Withdraw Earnings</h3>
            <p class="action-desc">Cash out your hard-earned money instantly to M-Pesa, bank account, or other payment methods.</p>
            <button class="action-btn">Withdraw Now</button>
          </div>
          
          <div class="action-card" onclick="showReferralModal()">
            <div class="action-icon">
              <i class="fas fa-user-plus"></i>
            </div>
            <h3 class="action-title">Invite & Earn</h3>
            <p class="action-desc">Invite friends and earn 15% commission on their earnings. No limit on referrals!</p>
            <button class="action-btn">Invite Friends</button>
          </div>
          
          <div class="action-card" onclick="window.location.href='training.html'">
            <div class="action-icon">
              <i class="fas fa-graduation-cap"></i>
            </div>
            <h3 class="action-title">Skill Training</h3>
            <p class="action-desc">Improve your academic writing skills with our comprehensive training modules and resources.</p>
            <button class="action-btn">Start Learning</button>
          </div>
        </div>
      </div>

      <!-- Earnings Dashboard -->
      <div class="earnings-dashboard" data-aos="fade-up">
        <div class="earnings-bg"></div>
        <div class="dashboard-header">
          <h3><i class="fas fa-chart-bar"></i> Earnings Analytics Dashboard</h3>
          <div class="period-selector">
            <button class="period-btn active" data-period="today">Today</button>
            <button class="period-btn" data-period="week">This Week</button>
            <button class="period-btn" data-period="month">This Month</button>
            <button class="period-btn" data-period="year">This Year</button>
          </div>
        </div>
        
        <div class="earnings-stats-grid">
          <div class="earning-stat-card">
            <div class="earning-stat-value" id="availableBalance">$0.00</div>
            <div class="earning-stat-label">Available Balance</div>
            <div class="earning-stat-change change-up" id="balanceChange">+$0 (0%)</div>
          </div>
          <div class="earning-stat-card">
            <div class="earning-stat-value" id="periodEarnings">$0.00</div>
            <div class="earning-stat-label" id="periodLabel">Today's Earnings</div>
            <div class="earning-stat-change change-up" id="periodChange">+$0 (0%)</div>
          </div>
          <div class="earning-stat-card">
            <div class="earning-stat-value" id="bonusEarnings">$0.00</div>
            <div class="earning-stat-label">Referral Bonus</div>
            <div class="earning-stat-change change-up" id="bonusChange">+$0 (0%)</div>
          </div>
          <div class="earning-stat-card">
            <div class="earning-stat-value" id="taskEarnings">$0.00</div>
            <div class="earning-stat-label">Task Earnings</div>
            <div class="earning-stat-change change-up" id="taskChange">+$0 (0%)</div>
          </div>
        </div>
      </div>

      <!-- Charts Section -->
      <div class="charts-section">
        <div class="chart-card" data-aos="fade-up">
          <div class="chart-header">
            <h4><i class="fas fa-chart-line"></i> Earnings Trend Analysis</h4>
            <div class="chart-actions">
              <button class="chart-btn" data-chart="7d">7 Days</button>
              <button class="chart-btn active" data-chart="30d">30 Days</button>
              <button class="chart-btn" data-chart="90d">90 Days</button>
              <button class="chart-btn" data-chart="year">1 Year</button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="earningsChart"></canvas>
          </div>
        </div>
        
        <div class="chart-card" data-aos="fade-up" data-aos-delay="200">
          <div class="chart-header">
            <h4><i class="fas fa-tasks"></i> Task Distribution</h4>
            <div class="chart-actions">
              <button class="chart-btn active" data-type="category">By Category</button>
              <button class="chart-btn" data-type="status">By Status</button>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="tasksChart"></canvas>
          </div>
        </div>
      </div>

      <!-- Achievements Section -->
      <div class="achievements-section" data-aos="fade-up">
        <h3 class="section-title"><i class="fas fa-trophy"></i> Your Achievements</h3>
        <div class="badges-grid" id="achievementsGrid">
          <div class="badge earned fast-task" onclick="showAchievementModal('fast-task')">
            <div class="badge-icon">
              <i class="fas fa-bolt"></i>
            </div>
            <div class="badge-name">Fast Task</div>
            <div class="badge-progress">Completed first task</div>
          </div>
          <div class="badge earned week-warrior" onclick="showAchievementModal('week-warrior')">
            <div class="badge-icon">
              <i class="fas fa-fire"></i>
            </div>
            <div class="badge-name">Week Warrior</div>
            <div class="badge-progress">7 days streak</div>
          </div>
          <div class="badge earned referral-pro" onclick="showAchievementModal('referral-pro')">
            <div class="badge-icon">
              <i class="fas fa-users"></i>
            </div>
            <div class="badge-name">Referral Pro</div>
            <div class="badge-progress">5+ referrals</div>
          </div>
          <div class="badge writing-expert" onclick="showAchievementModal('writing-expert')">
            <div class="badge-icon">
              <i class="fas fa-pen-fancy"></i>
            </div>
            <div class="badge-name">Writing Expert</div>
            <div class="badge-progress">60% complete</div>
          </div>
          <div class="badge top-earner" onclick="showAchievementModal('top-earner')">
            <div class="badge-icon">
              <i class="fas fa-trophy"></i>
            </div>
            <div class="badge-name">Top Earner</div>
            <div class="badge-progress">40% complete</div>
          </div>
          <div class="badge consistency" onclick="showAchievementModal('consistency')">
            <div class="badge-icon">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="badge-name">Consistency</div>
            <div class="badge-progress">75% complete</div>
          </div>
          <div class="badge locked" onclick="showAchievementModal('quality-master')">
            <div class="badge-icon">
              <i class="fas fa-award"></i>
            </div>
            <div class="badge-name">Quality Master</div>
            <div class="badge-progress">20% complete</div>
          </div>
          <div class="badge locked" onclick="showAchievementModal('task-champion')">
            <div class="badge-icon">
              <i class="fas fa-flag-checkered"></i>
            </div>
            <div class="badge-name">Task Champion</div>
            <div class="badge-progress">50% complete</div>
          </div>
        </div>
      </div>

      <!-- Membership Section -->
      <div class="membership-section" data-aos="fade-up">
        <h3 class="section-title"><i class="fas fa-crown"></i> Upgrade Your Membership</h3>
        <p style="color: var(--gray); margin-bottom: 30px; font-size: 16px;">Select a membership package to unlock higher earnings, priority support, and exclusive features</p>
        
        <div class="membership-tabs">
          <button class="membership-tab active" data-tier="basic">Basic Packages</button>
          <button class="membership-tab" data-tier="premium">Premium Packages</button>
          <button class="membership-tab" data-tier="elite">Elite Packages</button>
        </div>
        
        <!-- Basic Packages -->
        <div class="membership-cards active" id="basicPackages">
          <div class="membership-card starter">
            <div class="membership-badge">Most Popular</div>
            <div class="membership-header">
              <h3 class="membership-name">Starter Package</h3>
              <div class="membership-price">$27.13<small>/one-time</small></div>
              <div style="color: var(--gray); font-size: 15px; margin-top: 5px;">â‰ˆ Ksh 3,500</div>
            </div>
            <ul class="membership-features">
              <li><i class="fas fa-check"></i> Basic academic writing tasks</li>
              <li><i class="fas fa-check"></i> Up to $15.50 daily earning limit</li>
              <li><i class="fas fa-check"></i> 10 tasks/day maximum</li>
              <li><i class="fas fa-check"></i> Standard withdrawal processing (24-48 hours)</li>
              <li><i class="fas fa-check"></i> Email support</li>
              <li><i class="fas fa-check"></i> Access to community forum</li>
              <li><i class="fas fa-check"></i> Basic training materials</li>
              <li><i class="fas fa-check"></i> 5% referral commission</li>
            </ul>
            <button class="upgrade-btn" onclick="upgradeMembership('starter')" id="starterUpgradeBtn">Get Started</button>
          </div>
          
          <div class="membership-card pro">
            <div class="membership-header">
              <h3 class="membership-name">Professional Package</h3>
              <div class="membership-price">$42.64<small>/one-time</small></div>
              <div style="color: var(--gray); font-size: 15px; margin-top: 5px;">â‰ˆ Ksh 5,500</div>
            </div>
            <ul class="membership-features">
              <li><i class="fas fa-check"></i> All Starter features PLUS</li>
              <li><i class="fas fa-check"></i> Advanced academic writing tasks</li>
              <li><i class="fas fa-check"></i> Up to $62.02 daily earning limit</li>
              <li><i class="fas fa-check"></i> 30 tasks/day maximum</li>
              <li><i class="fas fa-check"></i> Faster withdrawals (12-24 hours)</li>
              <li><i class="fas fa-check"></i> Priority email support</li>
              <li><i class="fas fa-check"></i> Advanced training modules</li>
              <li><i class="fas fa-check"></i> 10% referral commission</li>
            </ul>
            <button class="upgrade-btn" onclick="upgradeMembership('pro')" id="proUpgradeBtn">Go Professional</button>
          </div>
          
          <div class="membership-card premium">
            <div class="membership-badge">Best Value</div>
            <div class="membership-header">
              <h3 class="membership-name">Premium Package</h3>
              <div class="membership-price">$62.02<small>/one-time</small></div>
              <div style="color: var(--gray); font-size: 15px; margin-top: 5px;">â‰ˆ Ksh 8,000</div>
            </div>
            <ul class="membership-features">
              <li><i class="fas fa-check"></i> All Professional features PLUS</li>
              <li><i class="fas fa-check"></i> Unlimited daily earnings potential</li>
              <li><i class="fas fa-check"></i> All task categories unlocked</li>
              <li><i class="fas fa-check"></i> Unlimited tasks per day</li>
              <li><i class="fas fa-check"></i> Instant withdrawals</li>
              <li><i class="fas fa-check"></i> 24/7 premium support</li>
              <li><i class="fas fa-check"></i> Masterclass training sessions</li>
              <li><i class="fas fa-check"></i> 15% referral commission</li>
            </ul>
            <button class="upgrade-btn" onclick="upgradeMembership('premium')" id="premiumUpgradeBtn">Go Premium</button>
          </div>
        </div>
        
        <!-- Premium Packages -->
        <div class="membership-cards" id="premiumPackages">
          <div class="membership-card executive">
            <div class="membership-badge">Executive</div>
            <div class="membership-header">
              <h3 class="membership-name">Executive Package</h3>
              <div class="membership-price">$116.28<small>/one-time</small></div>
              <div style="color: var(--gray); font-size: 15px; margin-top: 5px;">â‰ˆ Ksh 15,000</div>
            </div>
            <ul class="membership-features">
              <li><i class="fas fa-check"></i> All Premium features PLUS</li>
              <li><i class="fas fa-check"></i> Personal account manager</li>
              <li><i class="fas fa-check"></i> Weekly mentorship sessions</li>
              <li><i class="fas fa-check"></i> Advanced analytics dashboard</li>
              <li><i class="fas fa-check"></i> Priority task allocation</li>
              <li><i class="fas fa-check"></i> 25% higher earning rates</li>
              <li><i class="fas fa-check"></i> Exclusive webinars</li>
              <li><i class="fas fa-check"></i> Custom earning strategies</li>
            </ul>
            <button class="upgrade-btn" onclick="upgradeMembership('executive')" id="executiveUpgradeBtn">Become Executive</button>
          </div>
          
          <div class="membership-card vip">
            <div class="membership-badge">VIP</div>
            <div class="membership-header">
              <h3 class="membership-name">VIP Package</h3>
              <div class="membership-price">$155.04<small>/one-time</small></div>
              <div style="color: var(--gray); font-size: 15px; margin-top: 5px;">â‰ˆ Ksh 20,000</div>
            </div>
            <ul class="membership-features">
              <li><i class="fas fa-check"></i> All Executive features PLUS</li>
              <li><i class="fas fa-check"></i> Dedicated support team</li>
              <li><i class="fas fa-check"></i> Monthly strategy calls</li>
              <li><i class="fas fa-check"></i> Early all-feature access</li>
              <li><i class="fas fa-check"></i> Custom task requests</li>
              <li><i class="fas fa-check"></i> 50% higher earning rates</li>
              <li><i class="fas fa-check"></i> VIP community access</li>
              <li><i class="fas fa-check"></i> 20% referral commission</li>
            </ul>
            <button class="upgrade-btn" onclick="upgradeMembership('vip')" id="vipUpgradeBtn">Become VIP</button>
          </div>
        </div>
        
        <!-- Elite Packages -->
        <div class="membership-cards" id="elitePackages">
          <div class="membership-card elite">
            <div class="membership-badge">ELITE</div>
            <div class="membership-header">
              <h3 class="membership-name">Elite Package</h3>
              <div class="membership-price">$193.80<small>/one-time</small></div>
              <div style="color: var(--gray); font-size: 15px; margin-top: 5px;">â‰ˆ Ksh 25,000</div>
            </div>
            <ul class="membership-features">
              <li><i class="fas fa-check"></i> All VIP features PLUS</li>
              <li><i class="fas fa-check"></i> 1-on-1 business coaching</li>
              <li><i class="fas fa-check"></i> Revenue sharing opportunities</li>
              <li><i class="fas fa-check"></i> Mastermind group access</li>
              <li><i class="fas fa-check"></i> Lifetime platform updates</li>
              <li><i class="fas fa-check"></i> 100% higher earning rates</li>
              <li><i class="fas fa-check"></i> Partnership opportunities</li>
              <li><i class="fas fa-check"></i> 25% referral commission</li>
              <li><i class="fas fa-check"></i> Residual income streams</li>
            </ul>
            <button class="upgrade-btn" onclick="upgradeMembership('elite')" id="eliteUpgradeBtn">Become Elite</button>
          </div>
        </div>
      </div>

      <!-- App Download Section -->
      <div class="app-download-section" data-aos="fade-up">
        <div class="app-content">
          <div class="app-icon-large">
            <i class="fas fa-mobile-alt"></i>
          </div>
          <h2 class="app-title">Download Our Mobile App</h2>
          <p class="app-subtitle">Take your academic writing business anywhere with our feature-packed mobile application. Available on iOS, Android, and as a Progressive Web App.</p>
          
          <div class="app-features-grid">
            <div class="app-feature">
              <i class="fas fa-bell"></i>
              <h4>Instant Notifications</h4>
              <p>Get real-time alerts for new tasks, deadlines, and earnings</p>
            </div>
            <div class="app-feature">
              <i class="fas fa-pencil-alt"></i>
              <h4>Mobile Writing</h4>
              <p>Write and submit tasks directly from your mobile device</p>
            </div>
            <div class="app-feature">
              <i class="fas fa-shield-alt"></i>
              <h4>Enhanced Security</h4>
              <p>Biometric login and encrypted data protection</p>
            </div>
            <div class="app-feature">
              <i class="fas fa-sync-alt"></i>
              <h4>Auto Sync</h4>
              <p>Seamless synchronization across all your devices</p>
            </div>
          </div>
          
          <div class="store-buttons">
            <a href="https://apps.apple.com/app/academic-writing-hub/id1234567890" class="store-btn-large" target="_blank">
              <i class="fab fa-apple"></i>
              <div>
                <div style="font-size: 12px;">Download on the</div>
                <div style="font-size: 20px; font-weight: bold;">App Store</div>
              </div>
            </a>
            <a href="https://play.google.com/store/apps/details?id=com.academicwritinghub.app" class="store-btn-large" target="_blank">
              <i class="fab fa-google-play"></i>
              <div>
                <div style="font-size: 12px;">Get it on</div>
                <div style="font-size: 20px; font-weight: bold;">Google Play</div>
              </div>
            </a>
          </div>
          
          <div class="app-install-options">
            <h4><i class="fas fa-download"></i> Multiple Installation Options</h4>
            <div class="install-methods">
              <div class="install-method" onclick="installPWA()">
                <i class="fas fa-globe"></i>
                <h5>Progressive Web App</h5>
                <p>Install directly from your browser. No app store required.</p>
                <button class="install-btn">Install PWA</button>
              </div>
              <div class="install-method" onclick="downloadApp('ios')">
                <i class="fab fa-apple"></i>
                <h5>iOS App</h5>
                <p>Optimized for iPhone and iPad. Available on App Store.</p>
                <button class="install-btn">Download iOS</button>
              </div>
              <div class="install-method" onclick="downloadApp('android')">
                <i class="fab fa-android"></i>
                <h5>Android App</h5>
                <p>Compatible with all Android devices. Get it on Play Store.</p>
                <button class="install-btn">Download Android</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="recent-activity" data-aos="fade-up">
        <h3 class="section-title"><i class="fas fa-history"></i> Recent Activity</h3>
        
        <div class="activity-filters">
          <button class="activity-filter active" data-filter="all">All Activities</button>
          <button class="activity-filter" data-filter="earnings">Earnings</button>
          <button class="activity-filter" data-filter="tasks">Tasks</button>
          <button class="activity-filter" data-filter="withdrawals">Withdrawals</button>
        </div>
        
        <ul class="activity-list" id="activityList">
          <!-- Activities will be loaded dynamically from Supabase -->
        </ul>
      </div>
    </main>
  </div>

  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h4><i class="fas fa-graduation-cap"></i> Academic Writing Hub</h4>
        <p style="color: #94a3b8; margin-bottom: 20px; line-height: 1.6;">Empowering students and professionals through academic writing opportunities. Join thousands of successful writers earning while enhancing their skills.</p>
        <div style="display: flex; gap: 15px; margin-top: 25px;">
          <a href="https://facebook.com/academicwritinghub" style="color: #94a3b8; font-size: 18px;" target="_blank"><i class="fab fa-facebook"></i></a>
          <a href="https://twitter.com/academicwritinghub" style="color: #94a3b8; font-size: 18px;" target="_blank"><i class="fab fa-twitter"></i></a>
          <a href="https://instagram.com/academicwritinghub" style="color: #94a3b8; font-size: 18px;" target="_blank"><i class="fab fa-instagram"></i></a>
          <a href="https://linkedin.com/company/academicwritinghub" style="color: #94a3b8; font-size: 18px;" target="_blank"><i class="fab fa-linkedin"></i></a>
          <a href="https://wa.me/254783567024" style="color: #94a3b8; font-size: 18px;" target="_blank"><i class="fab fa-whatsapp"></i></a>
        </div>
      </div>
      
      <div class="footer-section">
        <h4><i class="fas fa-link"></i> Quick Links</h4>
        <ul class="footer-links">
          <li><a href="dashboard.html"><i class="fas fa-home"></i> Dashboard</a></li>
          <li><a href="tasks.html"><i class="fas fa-tasks"></i> Available Tasks</a></li>
          <li><a href="earnings.html"><i class="fas fa-chart-line"></i> Earnings</a></li>
          <li><a href="withdraw.html"><i class="fas fa-wallet"></i> Withdraw Funds</a></li>
          <li><a href="referrals.html"><i class="fas fa-user-plus"></i> Referral Program</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4><i class="fas fa-headset"></i> Support & Legal</h4>
        <ul class="footer-links">
          <li><a href="#" onclick="showHelpCenter()"><i class="fas fa-question-circle"></i> Help Center</a></li>
          <li><a href="#" onclick="showFAQ()"><i class="fas fa-comments"></i> FAQ</a></li>
          <li><a href="#" onclick="showContactUs()"><i class="fas fa-envelope"></i> Contact Us</a></li>
          <li><a href="#" onclick="showTermsOfService()"><i class="fas fa-file-contract"></i> Terms of Service</a></li>
          <li><a href="#" onclick="showPrivacyPolicy()"><i class="fas fa-shield-alt"></i> Privacy Policy</a></li>
        </ul>
      </div>
      
      <div class="footer-section">
        <h4><i class="fas fa-mobile-alt"></i> Download App</h4>
        <ul class="footer-links">
          <li><a href="#" onclick="downloadApp('ios')"><i class="fab fa-apple"></i> iOS App (App Store)</a></li>
          <li><a href="#" onclick="downloadApp('android')"><i class="fab fa-android"></i> Android App (Play Store)</a></li>
          <li><a href="#" onclick="installPWA()"><i class="fas fa-globe"></i> Web App (PWA)</a></li>
          <li><a href="#" onclick="showAppGuide()"><i class="fas fa-book"></i> Installation Guide</a></li>
          <li><a href="#" onclick="showAppSupport()"><i class="fas fa-question-circle"></i> App Support</a></li>
        </ul>
      </div>
    </div>
    
    <div class="footer-bottom">
      <p>&copy; 2025 Academic Writing Hub. All Rights Reserved. | Version 3.2.1 | Mobile App v2.5.0 | PWA v1.3.0</p>
      <p style="margin-top: 10px; font-size: 13px; color: #64748b;">Contact: goldgain321@gmail.com | WhatsApp: +254783567024 | Support Hours: Mon-Fri 9AM-6PM EAT</p>
    </div>
  </footer>

<script>
  // Initialize AOS animations
  AOS.init({
    duration: 800,
    once: true,
    offset: 100
  });

  // Supabase configuration
  const SUPABASE_URL = "https://lfrjtklkbppihaaiuxef.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imxmcmp0a2xrYnBwaWhhYWl1eGVmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwNTI5MzMsImV4cCI6MjA3NDYyODkzM30.2FVqnt5daF2Tw-RmVBwOGgt4GuIQQSkG8IUZt30QxIM";

  // Initialize Supabase client
  let supabaseClient;
  try {
    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    console.log('âœ… Supabase client initialized successfully');
  } catch (error) {
    console.error('âŒ Failed to initialize Supabase client:', error);
    showMessage('Failed to connect to database. Please refresh the page.', 'error');
  }

  // Global variables
  let currentUser = null;
  let userProfile = null;
  let earningsChart = null;
  let tasksChart = null;
  const EXCHANGE_RATE = 129; // 1 USD = 129 KSH
  let deferredPrompt = null;
  let realTimeSubscription = null;

  // Wait for the page to fully load
  document.addEventListener('DOMContentLoaded', function() {
    console.log('ðŸš€ Initializing Academic Writing Hub Dashboard...');
    initializeApp();
    setupPWAInstall();
  });

  // PWA Installation - Fixed to avoid errors
  function setupPWAInstall() {
    // Only try to install PWA if browser supports it and we have a manifest
    if ('serviceWorker' in navigator && 'BeforeInstallPromptEvent' in window) {
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        const pwaInstallBtn = document.getElementById('pwaInstallBtn');
        if (pwaInstallBtn) {
          pwaInstallBtn.style.display = 'block';
          pwaInstallBtn.addEventListener('click', installPWA);
        }
      });
    } else {
      // Hide PWA install button if not supported
      const pwaInstallBtn = document.getElementById('pwaInstallBtn');
      if (pwaInstallBtn) {
        pwaInstallBtn.style.display = 'none';
      }
    }
    
    // Try to register service worker without causing errors
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').then(function(registration) {
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }).catch(function(err) {
        console.log('ServiceWorker registration failed, but that\'s okay:', err);
        // Don't show error to user - PWA is optional
      });
    }
  }

  async function installPWA() {
    if (deferredPrompt) {
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      
      if (outcome === 'accepted') {
        showMessage('ðŸŽ‰ Academic Writing Hub app installed successfully!', 'success');
        deferredPrompt = null;
        
        const pwaInstallBtn = document.getElementById('pwaInstallBtn');
        if (pwaInstallBtn) {
          pwaInstallBtn.style.display = 'none';
        }
      }
    } else {
      showMessage('ðŸ“± The app is already installed or installation is not supported.', 'info');
    }
  }

  async function initializeApp() {
    try {
      setupEventListeners();
      setupCharts();
      await checkAuth();
      setupRealTimeUpdates();
    } catch (error) {
      console.error('âŒ App initialization error:', error);
      showMessage('Application failed to initialize. Please refresh the page.', 'error');
    }
  }

  function setupEventListeners() {
    // Mobile menu toggle
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    
    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        sidebar.classList.toggle('active');
        sidebarOverlay.classList.toggle('active');
        this.querySelector('i').classList.toggle('fa-bars');
        this.querySelector('i').classList.toggle('fa-times');
      });
    }

    // Close mobile menu when clicking on overlay
    if (sidebarOverlay) {
      sidebarOverlay.addEventListener('click', function() {
        sidebar.classList.remove('active');
        this.classList.remove('active');
        if (mobileMenuBtn.querySelector('i')) {
          mobileMenuBtn.querySelector('i').classList.add('fa-bars');
          mobileMenuBtn.querySelector('i').classList.remove('fa-times');
        }
      });
    }

    // Close mobile menu when clicking outside on mobile
    document.addEventListener('click', function(e) {
      if (window.innerWidth <= 992) {
        if (!sidebar.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
          sidebar.classList.remove('active');
          sidebarOverlay.classList.remove('active');
          if (mobileMenuBtn.querySelector('i')) {
            mobileMenuBtn.querySelector('i').classList.add('fa-bars');
            mobileMenuBtn.querySelector('i').classList.remove('fa-times');
          }
        }
      }
    });

    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    if (themeToggle) {
      themeToggle.addEventListener('click', toggleTheme);
      
      // Load saved theme
      if (localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-mode');
      }
    }

    // Notification bell
    const notificationBell = document.getElementById('notificationBell');
    if (notificationBell) {
      notificationBell.addEventListener('click', showNotifications);
    }

    // Logout handler
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', handleLogout);
    }

    // PWA install button
    const pwaInstallBtn = document.getElementById('pwaInstallBtn');
    if (pwaInstallBtn) {
      pwaInstallBtn.addEventListener('click', installPWA);
    }

    // Period selector
    const periodBtns = document.querySelectorAll('.period-btn');
    periodBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        periodBtns.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        updateEarningsDashboard(this.dataset.period);
      });
    });

    // Chart period buttons
    const chartBtns = document.querySelectorAll('.chart-btn');
    chartBtns.forEach(btn => {
      btn.addEventListener('click', function() {
        chartBtns.forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        
        if (this.dataset.chart) {
          updateCharts(this.dataset.chart);
        } else if (this.dataset.type) {
          updateTasksChart(this.dataset.type);
        }
      });
    });

    // Membership tabs
    const membershipTabs = document.querySelectorAll('.membership-tab');
    const membershipSections = ['basicPackages', 'premiumPackages', 'elitePackages'];
    
    membershipTabs.forEach((tab, index) => {
      tab.addEventListener('click', function() {
        membershipTabs.forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        
        membershipSections.forEach(section => {
          document.getElementById(section).classList.remove('active');
        });
        document.getElementById(membershipSections[index]).classList.add('active');
      });
    });

    // Activity filters
    const activityFilters = document.querySelectorAll('.activity-filter');
    activityFilters.forEach(filter => {
      filter.addEventListener('click', function() {
        activityFilters.forEach(f => f.classList.remove('active'));
        this.classList.add('active');
        filterActivities(this.dataset.filter);
      });
    });

    // User menu click
    const userMenu = document.getElementById('userMenu');
    if (userMenu) {
      userMenu.addEventListener('click', function() {
        window.location.href = 'profile.html';
      });
    }
  }

  function setupCharts() {
    // Earnings Chart with expanded Y-axis
    const earningsCtx = document.getElementById('earningsChart').getContext('2d');
    earningsChart = new Chart(earningsCtx, {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        datasets: [{
          label: 'Earnings ($)',
          data: [0, 15, 28, 42, 55, 68, 82, 95, 108, 122, 135, 150],
          borderColor: '#10b981',
          backgroundColor: 'rgba(16, 185, 129, 0.1)',
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointBackgroundColor: '#10b981',
          pointBorderColor: '#ffffff',
          pointBorderWidth: 2,
          pointRadius: 6,
          pointHoverRadius: 8
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            mode: 'index',
            intersect: false,
            callbacks: {
              label: function(context) {
                return `Earnings: $${context.parsed.y.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
              }
            }
          }
        },
        scales: {
          y: {
            beginAtZero: true,
            grid: {
              color: function(context) {
                return document.body.classList.contains('dark-mode') 
                  ? 'rgba(255, 255, 255, 0.05)' 
                  : 'rgba(0, 0, 0, 0.05)';
              }
            },
            ticks: {
              callback: function(value) {
                // Show $0, $25, $50, $75, $100, $125, $150 etc.
                if (value === 0 || value % 25 === 0) {
                  return '$' + value;
                }
                return '';
              },
              color: function(context) {
                return document.body.classList.contains('dark-mode') 
                  ? '#94a3b8' 
                  : '#64748b';
              },
              stepSize: 25
            },
            max: 175
          },
          x: {
            grid: {
              color: function(context) {
                return document.body.classList.contains('dark-mode') 
                  ? 'rgba(255, 255, 255, 0.05)' 
                  : 'rgba(0, 0, 0, 0.05)';
              }
            },
            ticks: {
              color: function(context) {
                return document.body.classList.contains('dark-mode') 
                  ? '#94a3b8' 
                  : '#64748b';
              }
            }
          }
        }
      }
    });

    // Tasks Chart
    const tasksCtx = document.getElementById('tasksChart').getContext('2d');
    tasksChart = new Chart(tasksCtx, {
      type: 'doughnut',
      data: {
        labels: ['Completed', 'In Progress', 'Available', 'Pending Review'],
        datasets: [{
          data: [0, 0, 0, 0],
          backgroundColor: [
            '#10b981',
            '#f59e0b',
            '#3b82f6',
            '#8b5cf6'
          ],
          borderWidth: 0,
          hoverOffset: 15
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '70%',
        plugins: {
          legend: {
            position: 'bottom',
            labels: {
              padding: 20,
              usePointStyle: true,
              pointStyle: 'circle',
              color: function(context) {
                return document.body.classList.contains('dark-mode') 
                  ? '#e2e8f0' 
                  : '#1e293b';
              }
            }
          },
          tooltip: {
            callbacks: {
              label: function(context) {
                const label = context.label || '';
                const value = context.parsed || 0;
                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                const percentage = total > 0 ? Math.round((value / total) * 100) : 0;
                return `${label}: ${value} tasks (${percentage}%)`;
              }
            }
          }
        }
      }
    });
  }

  function updateCharts(period = '30d') {
    if (!userProfile) return;
    
    // Update earnings chart based on period
    const days = period === '7d' ? 7 : period === '90d' ? 90 : period === 'year' ? 12 : 30;
    
    if (period === 'year') {
      earningsChart.data.labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      // Generate realistic earnings data with expanded range
      const baseEarnings = parseFloat(userProfile.total_earnings) || 0;
      const monthlyAvg = baseEarnings / 12;
      
      const values = [];
      for (let i = 0; i < 12; i++) {
        let monthlyEarnings = monthlyAvg * (0.5 + Math.random() * 1.5);
        // Expanded range: $0-$150
        monthlyEarnings = Math.min(monthlyEarnings, 150);
        values.push(Math.round(monthlyEarnings * 100) / 100);
      }
      
      earningsChart.data.datasets[0].data = values;
      earningsChart.options.scales.y.max = 175;
    } else {
      const labels = [];
      const values = [];
      const baseEarnings = parseFloat(userProfile.total_earnings) || 0;
      const dailyAvg = baseEarnings / 30;
      
      for (let i = days; i > 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i + 1);
        labels.push(date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
        
        // Generate realistic earnings data with expanded range
        let dailyEarnings = dailyAvg * (0.2 + Math.random() * 0.5);
        // Expanded range: $0-$20
        dailyEarnings = Math.min(dailyEarnings, 20);
        values.push(Math.round(dailyEarnings * 100) / 100);
      }
      
      earningsChart.data.labels = labels;
      earningsChart.data.datasets[0].data = values;
      earningsChart.options.scales.y.max = 25;
    }
    
    earningsChart.update();
  }

  function updateTasksChart(type = 'category') {
    if (type === 'status') {
      tasksChart.data.labels = ['Completed', 'In Progress', 'Pending', 'Available'];
      tasksChart.data.datasets[0].data = [
        userProfile?.tasks_completed || 0,
        userProfile?.tasks_in_progress || 0,
        userProfile?.tasks_pending || 0,
        0 // Available tasks - not showing in dashboard
      ];
    } else {
      tasksChart.data.labels = ['Academic', 'Review', 'Research', 'Proofreading'];
      tasksChart.data.datasets[0].data = [8, 5, 3, 9];
    }
    tasksChart.update();
  }

  function toggleTheme() {
    const body = document.body;
    const isDark = body.classList.contains('dark-mode');
    
    body.classList.toggle('dark-mode');
    localStorage.setItem('theme', isDark ? 'light' : 'dark');
    
    // Update charts for new theme
    if (earningsChart) {
      earningsChart.options.scales.x.grid.color = isDark ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.05)';
      earningsChart.options.scales.y.grid.color = isDark ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.05)';
      earningsChart.options.scales.x.ticks.color = isDark ? '#64748b' : '#94a3b8';
      earningsChart.options.scales.y.ticks.color = isDark ? '#64748b' : '#94a3b8';
      earningsChart.update();
    }
    
    if (tasksChart) {
      tasksChart.options.plugins.legend.labels.color = isDark ? '#1e293b' : '#e2e8f0';
      tasksChart.update();
    }
  }

  async function showNotifications() {
    try {
      const { data: notifications, error } = await supabaseClient
        .from('notifications')
        .select('*')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false })
        .limit(10);

      if (error) throw error;

      let modalContent = `
        <div style="max-width: 500px; margin: 0 auto;">
          <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-bell" style="color: var(--primary);"></i>
            Notifications (${notifications?.filter(n => !n.read).length || 0} unread)
          </h3>
      `;

      if (!notifications || notifications.length === 0) {
        modalContent += `
          <div style="text-align: center; padding: 40px;">
            <i class="fas fa-bell-slash" style="font-size: 48px; color: var(--gray); margin-bottom: 20px;"></i>
            <p style="color: var(--gray);">No notifications yet</p>
          </div>
        `;
      } else {
        modalContent += `
          <div style="max-height: 400px; overflow-y: auto;">
            ${notifications.map(notification => `
              <div style="padding: 15px; border-bottom: 1px solid var(--border); background: ${notification.read ? 'transparent' : 'rgba(0, 74, 173, 0.05)'}; border-radius: 8px; margin-bottom: 10px;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                  <h4 style="margin: 0; font-size: 16px; font-weight: 700; color: ${notification.read ? 'var(--gray)' : 'var(--primary)'};">${notification.title}</h4>
                  <span style="font-size: 12px; color: var(--gray);">${formatTimeAgo(notification.created_at)}</span>
                </div>
                <p style="margin: 0; color: var(--dark); font-size: 14px;">${notification.message}</p>
                ${!notification.read ? '<div style="margin-top: 8px;"><button onclick="markNotificationAsRead(\'' + notification.id + '\')" style="padding: 5px 15px; background: var(--primary); color: white; border: none; border-radius: 4px; font-size: 12px; cursor: pointer;">Mark as Read</button></div>' : ''}
              </div>
            `).join('')}
          </div>
          
          <div style="margin-top: 20px; text-align: center;">
            <button onclick="markAllNotificationsAsRead()" style="padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">Mark All as Read</button>
          </div>
        `;
      }

      modalContent += '</div>';
      
      showCustomModal('Notifications', modalContent);
      
    } catch (error) {
      console.error('Error loading notifications:', error);
      showMessage('Failed to load notifications', 'error');
    }
  }

  async function markNotificationAsRead(notificationId) {
    try {
      const { error } = await supabaseClient
        .from('notifications')
        .update({ read: true, read_at: new Date().toISOString() })
        .eq('id', notificationId);

      if (error) throw error;

      // Update notification count
      await updateNotificationCount();
      showMessage('âœ… Notification marked as read', 'success');
    } catch (error) {
      console.error('Error marking notification as read:', error);
      showMessage('Failed to update notification', 'error');
    }
  }

  async function markAllNotificationsAsRead() {
    try {
      const { error } = await supabaseClient
        .from('notifications')
        .update({ read: true, read_at: new Date().toISOString() })
        .eq('user_id', currentUser.id)
        .eq('read', false);

      if (error) throw error;

      // Update notification count
      await updateNotificationCount();
      showMessage('âœ… All notifications marked as read', 'success');
    } catch (error) {
      console.error('Error marking all notifications as read:', error);
      showMessage('Failed to update notifications', 'error');
    }
  }

  async function updateNotificationCount() {
    try {
      const { count, error } = await supabaseClient
        .from('notifications')
        .select('*', { count: 'exact', head: true })
        .eq('user_id', currentUser.id)
        .eq('read', false);

      if (error) {
        // If notifications table doesn't exist, just set count to 0
        console.log('Notifications table not available');
        const notificationCount = document.getElementById('notificationCount');
        if (notificationCount) {
          notificationCount.textContent = '0';
        }
        return;
      }

      const notificationCount = document.getElementById('notificationCount');
      if (notificationCount) {
        notificationCount.textContent = count || 0;
      }
    } catch (error) {
      console.error('Error updating notification count:', error);
      // Don't show error to user for notification count
    }
  }

  function updateEarningsDashboard(period) {
    if (!userProfile) return;
    
    const periodLabel = document.getElementById('periodLabel');
    const periodEarnings = document.getElementById('periodEarnings');
    
    let label = "Today's Earnings";
    let earnings = 0;
    const totalEarnings = parseFloat(userProfile.total_earnings) || 0;
    
    switch(period) {
      case 'week':
        label = "This Week's Earnings";
        earnings = totalEarnings / 4; // Approximate weekly earnings
        break;
      case 'month':
        label = "This Month's Earnings";
        earnings = totalEarnings; // Total earnings as monthly
        break;
      case 'year':
        label = "This Year's Earnings";
        earnings = totalEarnings * 12; // Approximate yearly earnings
        break;
      default:
        // Today's earnings - calculate based on recent activity
        earnings = totalEarnings / 30; // Daily average
    }
    
    // Expanded range for earnings
    earnings = Math.min(earnings, 50);
    
    if (periodLabel) periodLabel.textContent = label;
    if (periodEarnings) {
      periodEarnings.textContent = formatUSD(earnings);
      
      // Update change indicators
      const increase = earnings * 0.15; // 15% increase for demo
      document.getElementById('periodChange').textContent = `+${formatUSD(increase)} (+15%)`;
    }
  }

  // Authentication check
  async function checkAuth() {
    if (!supabaseClient) {
      showMessage('Error: Application not initialized properly', 'error');
      return;
    }

    try {
      const { data: { session }, error } = await supabaseClient.auth.getSession();
      
      if (error) {
        console.error('Session error:', error);
        window.location.href = "login.html";
        return;
      }

      if (!session) {
        window.location.href = "login.html";
        return;
      }

      currentUser = session.user;
      console.log('âœ… User authenticated:', currentUser.email);
      await loadUserData();

      // Start auto-refresh
      startAutoRefresh();

    } catch (error) {
      console.error('Auth check error:', error);
      window.location.href = "login.html";
    }
  }

  function setupRealTimeUpdates() {
    // Subscribe to profile changes if user is authenticated
    if (supabaseClient && currentUser) {
      try {
        realTimeSubscription = supabaseClient
          .channel('profile-changes')
          .on('postgres_changes', {
            event: 'UPDATE',
            schema: 'public',
            table: 'profiles',
            filter: `id=eq.${currentUser.id}`
          }, async (payload) => {
            console.log('Profile updated:', payload.new);
            userProfile = payload.new;
            updateDashboard(userProfile);
            await updateNotificationCount();
          })
          .subscribe((status) => {
            console.log('Real-time subscription status:', status);
          });
      } catch (error) {
        console.error('Error setting up real-time updates:', error);
      }
    }
  }

  function startAutoRefresh() {
    // Refresh every 30 seconds
    setInterval(async () => {
      if (currentUser && userProfile) {
        await refreshUserData();
      }
    }, 30000);
  }

  async function refreshUserData() {
    try {
      const { data: profile, error } = await supabaseClient
        .from('profiles')
        .select('balance, total_earnings, tasks_completed, role, tasks_pending, tasks_in_progress, daily_streak')
        .eq('id', currentUser.id)
        .single();

      if (!error && profile) {
        const oldBalance = parseFloat(userProfile.balance) || 0;
        const newBalance = parseFloat(profile.balance) || 0;
        
        // Update if values changed
        let changed = false;
        
        if (oldBalance !== newBalance) {
          userProfile = profile;
          updateDashboard(userProfile);
          updateMembershipButtons(userProfile);
          changed = true;
          
          if (newBalance > oldBalance) {
            const increase = newBalance - oldBalance;
            showMessage(`ðŸ’° Balance updated! +${formatUSD(kshToUsd(increase))}`, 'success');
          }
        }
        
        if (changed) {
          updateCharts();
          updateTasksChart();
        }
      }
    } catch (error) {
      console.error('Data refresh error:', error);
    }
  }

  async function loadUserData() {
    if (!supabaseClient || !currentUser) return;

    try {
      // Load user profile - Fixed query to match table structure
      const { data: profile, error } = await supabaseClient
        .from('profiles')
        .select('*')
        .eq('id', currentUser.id)
        .single();

      if (error) {
        console.error('Profile load error:', error);
        await createDefaultProfile();
        return;
      }

      userProfile = profile;
      updateDashboard(profile);
      updateMembershipButtons(profile);
      updateCharts();
      updateTasksChart();
      
      // Load notification count
      await updateNotificationCount();
      
      // Load recent activities
      await loadRecentActivities();

    } catch (error) {
      console.error('User data load error:', error);
      showMessage('Failed to load user data', 'error');
    }
  }

  // Currency conversion functions
  function usdToKsh(usd) {
    return Math.round(usd * EXCHANGE_RATE);
  }

  function kshToUsd(ksh) {
    return ksh / EXCHANGE_RATE;
  }

  function formatUSD(amount) {
    return '$' + parseFloat(amount).toLocaleString('en-US', {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2
    });
  }

  function formatKSH(amount) {
    return 'Ksh ' + Math.round(amount).toLocaleString('en-US');
  }

  function updateDashboard(profile) {
    // Welcome message and user info
    const welcomeMessage = document.getElementById('welcomeMessage');
    const userName = document.getElementById('userName');
    const userAvatar = document.getElementById('userAvatar');
    const userRole = document.getElementById('userRole');
    
    if (welcomeMessage) welcomeMessage.textContent = 'Welcome back, ' + (profile.full_name || 'Writer') + '!';
    if (userName) userName.textContent = profile.full_name || 'Writer';
    if (userAvatar) userAvatar.textContent = (profile.full_name || 'W').charAt(0).toUpperCase();
    
    // Update role
    if (userRole) {
      const role = profile.role || 'none';
      userRole.textContent = role === 'none' ? 'Writer' : role.charAt(0).toUpperCase() + role.slice(1);
    }

    // Convert amounts from KSH to USD (assuming stored as KSH in database)
    const balanceKSH = parseFloat(profile.balance) || 0;
    const totalEarningsKSH = parseFloat(profile.total_earnings) || 0;
    const balanceUSD = kshToUsd(balanceKSH);
    const totalEarningsUSD = kshToUsd(totalEarningsKSH);
    
    // Today's earnings (demo calculation)
    const todayEarningsUSD = totalEarningsUSD / 30;
    const todayEarningsKSH = usdToKsh(todayEarningsUSD);
    
    // Update hero stats
    document.getElementById('heroBalance').textContent = formatUSD(balanceUSD);
    document.getElementById('heroEarnings').textContent = formatUSD(totalEarningsUSD);
    document.getElementById('heroTasks').textContent = profile.tasks_completed || 0;
    document.getElementById('heroStreak').textContent = profile.daily_streak || 0;
    
    // Update main stats
    document.getElementById('balanceAmount').textContent = formatUSD(balanceUSD);
    document.getElementById('balanceKsh').textContent = formatKSH(balanceKSH);
    
    document.getElementById('totalEarnings').textContent = formatUSD(totalEarningsUSD);
    document.getElementById('earningsKsh').textContent = formatKSH(totalEarningsKSH);
    
    document.getElementById('todayEarnings').textContent = formatUSD(todayEarningsUSD);
    document.getElementById('todayKsh').textContent = formatKSH(todayEarningsKSH);
    
    // Tasks and referrals
    document.getElementById('tasksCompleted').textContent = profile.tasks_completed || 0;
    document.getElementById('tasksBadge').textContent = profile.tasks_completed || 0;
    
    // Membership type
    const membershipType = document.getElementById('membershipType');
    if (membershipType) {
      let display = 'Basic';
      if (profile.role === 'starter') display = 'Starter';
      else if (profile.role === 'pro') display = 'Pro';
      else if (profile.role === 'premium') display = 'Premium';
      else if (profile.role === 'executive') display = 'Executive';
      else if (profile.role === 'vip') display = 'VIP';
      else if (profile.role === 'elite') display = 'Elite';
      membershipType.textContent = display;
    }
    
    // Update earnings dashboard
    document.getElementById('availableBalance').textContent = formatUSD(balanceUSD);
    document.getElementById('periodEarnings').textContent = formatUSD(todayEarningsUSD);
    
    // Bonus earnings (10% of total earnings as referral bonus)
    const bonusEarningsUSD = totalEarningsUSD * 0.1;
    document.getElementById('bonusEarnings').textContent = formatUSD(bonusEarningsUSD);
    
    // Task earnings (90% of total earnings)
    const taskEarningsUSD = totalEarningsUSD * 0.9;
    document.getElementById('taskEarnings').textContent = formatUSD(taskEarningsUSD);
    
    // Update trends
    updateTrends(balanceUSD, totalEarningsUSD, todayEarningsUSD, profile.tasks_completed || 0);
    
    // Update change indicators
    const balanceChange = balanceUSD * 0.1;
    const periodChange = todayEarningsUSD * 0.15;
    const bonusChange = bonusEarningsUSD * 0.2;
    const taskChange = taskEarningsUSD * 0.12;
    
    document.getElementById('balanceChange').textContent = `+${formatUSD(balanceChange)} (+10%)`;
    document.getElementById('periodChange').textContent = `+${formatUSD(periodChange)} (+15%)`;
    document.getElementById('bonusChange').textContent = `+${formatUSD(bonusChange)} (+20%)`;
    document.getElementById('taskChange').textContent = `+${formatUSD(taskChange)} (+12%)`;
  }

  function updateTrends(balance, earnings, today, tasks) {
    // Generate realistic trends with small percentages
    const balanceTrend = Math.random() > 0.3 ? '+' + (Math.random() * 10).toFixed(1) + '%' : '-' + (Math.random() * 3).toFixed(1) + '%';
    const earningsTrend = Math.random() > 0.2 ? '+' + (Math.random() * 15).toFixed(1) + '%' : '-' + (Math.random() * 2).toFixed(1) + '%';
    const todayTrend = Math.random() > 0.4 ? '+' + (Math.random() * 20).toFixed(1) + '%' : '-' + (Math.random() * 5).toFixed(1) + '%';
    const tasksTrend = tasks > 0 ? '+' + (Math.random() * 15).toFixed(1) + '%' : '0%';
    
    // Update trend elements
    const elements = {
      'balanceTrend': balanceTrend,
      'earningsTrend': earningsTrend,
      'todayTrend': todayTrend,
      'tasksTrend': tasksTrend
    };
    
    for (const [id, trend] of Object.entries(elements)) {
      const element = document.getElementById(id);
      if (element) {
        element.textContent = trend;
        element.className = 'stat-trend ';
        if (trend.startsWith('+')) {
          element.classList.add('trend-up');
        } else if (trend.startsWith('-')) {
          element.classList.add('trend-down');
        } else {
          element.classList.add('trend-neutral');
        }
      }
    }
  }

  // Package prices in USD
  const packagePrices = {
    'starter': 3500 / EXCHANGE_RATE,
    'pro': 5500 / EXCHANGE_RATE,
    'premium': 8000 / EXCHANGE_RATE,
    'executive': 15000 / EXCHANGE_RATE,
    'vip': 20000 / EXCHANGE_RATE,
    'elite': 25000 / EXCHANGE_RATE
  };

  function updateMembershipButtons(profile) {
    const buttons = {
      'starter': document.getElementById('starterUpgradeBtn'),
      'pro': document.getElementById('proUpgradeBtn'),
      'premium': document.getElementById('premiumUpgradeBtn'),
      'executive': document.getElementById('executiveUpgradeBtn'),
      'vip': document.getElementById('vipUpgradeBtn'),
      'elite': document.getElementById('eliteUpgradeBtn')
    };

    const currentBalanceUSD = kshToUsd(parseFloat(profile.balance) || 0);
    const currentRole = profile.role || 'none';

    const membershipLevels = { 
      'none': 0, 
      'starter': 1, 
      'pro': 2, 
      'premium': 3, 
      'executive': 4, 
      'vip': 5, 
      'elite': 6 
    };

    for (const [packageName, button] of Object.entries(buttons)) {
      if (!button) continue;
      
      const price = packagePrices[packageName];
      const currentLevel = membershipLevels[currentRole] || 0;
      const packageLevel = membershipLevels[packageName];

      if (currentRole === packageName) {
        button.textContent = 'Current Package';
        button.disabled = true;
      } else if (currentLevel > packageLevel) {
        button.textContent = 'Already Upgraded';
        button.disabled = true;
      } else {
        if (currentBalanceUSD >= price) {
          let buttonText = `Upgrade to ${packageName.charAt(0).toUpperCase() + packageName.slice(1)}`;
          if (currentRole === 'none') {
            buttonText = `Get ${packageName.charAt(0).toUpperCase() + packageName.slice(1)} Package`;
          }
          button.textContent = buttonText;
          button.disabled = false;
        } else {
          button.textContent = `Insufficient Balance - ${formatUSD(price)}`;
          button.disabled = true;
        }
      }
    }
  }

  async function upgradeMembership(newRole) {
    if (!supabaseClient || !userProfile) {
      showMessage('Application not ready. Please wait...', 'error');
      return;
    }

    const priceUSD = packagePrices[newRole];
    const priceKSH = usdToKsh(priceUSD);
    const currentBalanceKSH = parseFloat(userProfile.balance) || 0;
    const currentBalanceUSD = kshToUsd(currentBalanceKSH);
    const currentMembership = userProfile.role || 'none';

    // Check if user can afford the package
    if (currentBalanceUSD < priceUSD) {
      showMessage(`Insufficient balance. You need ${formatUSD(priceUSD)} (â‰ˆ ${formatKSH(priceKSH)}) to get the ${newRole} package.`, 'error');
      return;
    }

    // Check if user already has this package or higher
    const membershipLevels = { 
      'none': 0, 
      'starter': 1, 
      'pro': 2, 
      'premium': 3, 
      'executive': 4, 
      'vip': 5, 
      'elite': 6 
    };
    const currentLevel = membershipLevels[currentMembership] || 0;
    const newLevel = membershipLevels[newRole];
    
    if (currentMembership === newRole) {
      showMessage(`You already have the ${newRole} package.`, 'info');
      return;
    }
    
    if (newLevel < currentLevel) {
      showMessage(`You already have a higher package (${currentMembership}).`, 'info');
      return;
    }

    try {
      showMessage(`Processing ${newRole} package upgrade...`, 'info');

      // Calculate new balance in KSH
      const newBalanceKSH = currentBalanceKSH - priceKSH;
      
      const { data, error } = await supabaseClient
        .from('profiles')
        .update({
          role: newRole,
          balance: newBalanceKSH,
          updated_at: new Date().toISOString()
        })
        .eq('id', currentUser.id)
        .select()
        .single();

      if (error) {
        console.error('Upgrade error:', error);
        throw new Error('Database update failed: ' + error.message);
      }

      // Update local profile
      userProfile = data;
      updateDashboard(data);
      updateMembershipButtons(data);
      
      // PAY REFERRAL BONUS (if user was referred)
      if (userProfile.referred_by) {
        await payReferralBonus(userProfile.referred_by, currentUser.id, newRole, priceKSH);
      }
      
      // Record transaction
      await recordTransaction('membership_upgrade', -priceKSH, `Upgraded to ${newRole} package`);
      
      showMessage(`ðŸŽ‰ Successfully upgraded to ${newRole} package! ${formatUSD(priceUSD)} deducted from your balance.`, 'success');

      // Add to recent activities
      addActivity(`Upgraded to ${newRole} package`, -priceUSD, 'membership');

    } catch (error) {
      console.error('Upgrade error:', error);
      showMessage('Failed to upgrade: ' + error.message, 'error');
    }
  }

  async function createDefaultProfile() {
    if (!supabaseClient || !currentUser) return;

    try {
      const defaultProfile = {
        id: currentUser.id,
        full_name: currentUser.user_metadata?.full_name || currentUser.email?.split('@')[0] || 'User',
        balance: 0,
        total_earnings: 0,
        role: 'none',
        tasks_completed: 0,
        tasks_pending: 0,
        tasks_in_progress: 0,
        daily_streak: 0,
        created_at: new Date().toISOString()
      };

      const { data, error } = await supabaseClient
        .from('profiles')
        .insert([defaultProfile])
        .select()
        .single();

      if (error) {
        // If table doesn't have exact structure, try minimal fields
        console.log('Creating minimal profile due to table structure...');
        const minimalProfile = {
          id: currentUser.id,
          full_name: currentUser.email?.split('@')[0] || 'User',
          balance: 0,
          total_earnings: 0,
          role: 'none',
          created_at: new Date().toISOString()
        };
        
        const { data: minData, error: minError } = await supabaseClient
          .from('profiles')
          .insert([minimalProfile])
          .select()
          .single();
          
        if (minError) throw minError;
        
        userProfile = minData;
      } else {
        userProfile = data;
      }
      
      updateDashboard(userProfile);
      updateMembershipButtons(userProfile);
      updateCharts();

    } catch (error) {
      console.error('Create profile error:', error);
      // Create local profile object even if database fails
      userProfile = {
        full_name: currentUser.email?.split('@')[0] || 'User',
        balance: 0,
        total_earnings: 0,
        role: 'none',
        tasks_completed: 0,
        daily_streak: 0,
        created_at: new Date().toISOString()
      };
      updateDashboard(userProfile);
    }
  }

  async function recordTransaction(type, amountKSH, description, userId = null) {
    try {
      const transactionData = {
        user_id: userId || currentUser.id,
        type: type,
        amount: amountKSH,
        description: description,
        created_at: new Date().toISOString()
      };

      const { error } = await supabaseClient
        .from('transactions')
        .insert([transactionData]);

      if (error) {
        // If transactions table doesn't exist, just log it
        console.log('Transactions table not available:', error);
      }
      
    } catch (error) {
      console.error('Error recording transaction:', error);
    }
  }

  async function loadRecentActivities(filter = 'all') {
    try {
      let query = supabaseClient
        .from('transactions')
        .select('*')
        .eq('user_id', currentUser.id)
        .order('created_at', { ascending: false })
        .limit(5);

      // Apply filter if not 'all'
      if (filter !== 'all') {
        if (filter === 'earnings') {
          query = query.in('type', ['task_completed', 'referral_bonus', 'bonus']);
        } else if (filter === 'tasks') {
          query = query.eq('type', 'task_completed');
        } else if (filter === 'referrals') {
          query = query.eq('type', 'referral_bonus');
        } else if (filter === 'withdrawals') {
          query = query.eq('type', 'withdrawal');
        }
      }

      const { data: transactions, error } = await query;

      const activityList = document.getElementById('activityList');
      if (!activityList) return;

      if (error || !transactions || transactions.length === 0) {
        // Show empty state message
        activityList.innerHTML = `
          <li style="text-align: center; padding: 40px; color: var(--gray);">
            <i class="fas fa-history" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
            <p>No recent activities yet</p>
            <p style="font-size: 14px; margin-top: 10px;">Complete your first task to see activities here</p>
          </li>
        `;
        return;
      }

      // Render real activities
      activityList.innerHTML = transactions.map(transaction => {
        const amountUSD = kshToUsd(transaction.amount);
        const amountClass = transaction.amount > 0 ? 'activity-amount' : 'activity-amount negative';
        const amountDisplay = transaction.amount > 0 ? `+${formatUSD(amountUSD)}` : formatUSD(amountUSD);
        
        let icon = 'fas fa-exchange-alt';
        let activityClass = '';
        
        switch(transaction.type) {
          case 'task_completed':
            icon = 'fas fa-file-alt';
            activityClass = 'task';
            break;
          case 'referral_bonus':
            icon = 'fas fa-user-plus';
            activityClass = 'referral';
            break;
          case 'withdrawal':
            icon = 'fas fa-money-bill-wave';
            activityClass = 'withdrawal';
            break;
          case 'membership_upgrade':
            icon = 'fas fa-crown';
            break;
          case 'bonus':
            icon = 'fas fa-gift';
            break;
        }
        
        const timeAgo = formatTimeAgo(transaction.created_at);
        
        return `
          <li class="activity-item ${activityClass}">
            <div class="activity-icon">
              <i class="${icon}"></i>
            </div>
            <div class="activity-content">
              <h4 class="activity-title">${transaction.description}</h4>
              <p class="activity-desc">Transaction ID: ${transaction.id?.substring(0, 8) || 'N/A'}</p>
              <div class="activity-meta">
                <span class="activity-time">${timeAgo}</span>
                <span class="${amountClass}">${amountDisplay}</span>
              </div>
            </div>
          </li>
        `;
      }).join('');

    } catch (error) {
      console.error('Error loading activities:', error);
      // Show empty state on error
      const activityList = document.getElementById('activityList');
      if (activityList) {
        activityList.innerHTML = `
          <li style="text-align: center; padding: 40px; color: var(--gray);">
            <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i>
            <p>Unable to load activities</p>
            <p style="font-size: 14px; margin-top: 10px;">Please try refreshing the page</p>
          </li>
        `;
      }
    }
  }

  function filterActivities(filter) {
    loadRecentActivities(filter);
  }

  function formatTimeAgo(dateString) {
    try {
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return 'Just now';
      if (diffMins < 60) return diffMins + ' min ago';
      if (diffHours < 24) return diffHours + ' hour' + (diffHours > 1 ? 's' : '') + ' ago';
      if (diffDays < 7) return diffDays + ' day' + (diffDays > 1 ? 's' : '') + ' ago';
      
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    } catch (error) {
      return 'Recently';
    }
  }

  function addActivity(text, amountUSD, type = 'transaction') {
    const activityList = document.getElementById('activityList');
    if (!activityList) return;

    const amountKSH = usdToKsh(Math.abs(amountUSD));
    const amountClass = amountUSD > 0 ? 'activity-amount' : 'activity-amount negative';
    const amountDisplay = amountUSD > 0 ? `+${formatUSD(amountUSD)}` : formatUSD(amountUSD);
    
    let icon = 'fas fa-exchange-alt';
    let activityClass = '';
    
    switch(type) {
      case 'task':
        icon = 'fas fa-file-alt';
        activityClass = 'task';
        break;
      case 'referral':
        icon = 'fas fa-user-plus';
        activityClass = 'referral';
        break;
      case 'withdrawal':
        icon = 'fas fa-money-bill-wave';
        activityClass = 'withdrawal';
        break;
      case 'membership':
        icon = 'fas fa-crown';
        break;
      case 'bonus':
        icon = 'fas fa-gift';
        break;
    }
    
    const activityItem = document.createElement('li');
    activityItem.className = `activity-item ${activityClass}`;
    activityItem.innerHTML = `
      <div class="activity-icon">
        <i class="${icon}"></i>
      </div>
      <div class="activity-content">
        <h4 class="activity-title">${text}</h4>
        <p class="activity-desc">${type.replace('_', ' ')}</p>
        <div class="activity-meta">
          <span class="activity-time">Just now</span>
          <span class="${amountClass}">${amountDisplay}</span>
        </div>
      </div>
    `;
    
    activityList.insertBefore(activityItem, activityList.firstChild);
    
    // Keep only last 5 activities
    while (activityList.children.length > 5) {
      activityList.removeChild(activityList.lastChild);
    }
  }

  // Task functions
  function startTask(taskId) {
    showMessage(`Starting task ${taskId}...`, 'info');
    setTimeout(() => {
      window.location.href = `task.html?id=${taskId}`;
    }, 1000);
  }

  function viewTaskDetails(taskId) {
    showMessage(`Viewing task ${taskId} details...`, 'info');
    setTimeout(() => {
      window.location.href = `task-details.html?id=${taskId}`;
    }, 500);
  }

  // App download functions
  function downloadApp(platform = null) {
    const platformToDownload = platform || detectPlatform();
    
    const downloadLinks = {
      'ios': 'https://apps.apple.com/app/academic-writing-hub/id1234567890',
      'android': 'https://play.google.com/store/apps/details?id=com.academicwritinghub.app',
      'default': 'https://academicwritinghub.com/app-download'
    };

    const link = downloadLinks[platformToDownload] || downloadLinks.default;
    
    showMessage(`ðŸ“± Redirecting to ${platformToDownload.toUpperCase()} download...`, 'info');
    
    setTimeout(() => {
      window.open(link, '_blank');
      showMessage('âœ… App download started! Check your device for installation instructions.', 'success');
    }, 1000);
  }

  function detectPlatform() {
    const userAgent = navigator.userAgent || navigator.vendor || window.opera;
    
    if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
      return 'ios';
    }
    if (/android/i.test(userAgent)) {
      return 'android';
    }
    return 'default';
  }

  function showAppDownloadModal() {
    const modalContent = `
      <div style="padding: 30px; text-align: center;">
        <div style="font-size: 48px; color: var(--primary); margin-bottom: 20px;">
          <i class="fas fa-mobile-alt"></i>
        </div>
        <h2 style="margin-bottom: 15px;">Download Our Mobile App</h2>
        <p style="color: var(--gray); margin-bottom: 25px;">Available on iOS, Android, and as a Progressive Web App</p>
        
        <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; flex-wrap: wrap;">
          <button onclick="downloadApp('ios')" style="padding: 15px 30px; background: #000; color: white; border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
            <i class="fab fa-apple"></i>
            <div style="text-align: left;">
              <div style="font-size: 11px;">Download on the</div>
              <div style="font-size: 16px; font-weight: bold;">App Store</div>
            </div>
          </button>
          <button onclick="downloadApp('android')" style="padding: 15px 30px; background: #3DDC84; color: #333; border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
            <i class="fab fa-android"></i>
            <div style="text-align: left;">
              <div style="font-size: 11px;">Get it on</div>
              <div style="font-size: 16px; font-weight: bold;">Google Play</div>
            </div>
          </button>
          <button onclick="installPWA()" style="padding: 15px 30px; background: var(--primary); color: white; border: none; border-radius: 10px; cursor: pointer; display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-globe"></i>
            <div style="text-align: left;">
              <div style="font-size: 11px;">Install</div>
              <div style="font-size: 16px; font-weight: bold;">Web App (PWA)</div>
            </div>
          </button>
        </div>
        
        <div style="background: #f8fafc; padding: 20px; border-radius: 10px; margin-top: 20px; text-align: left;">
          <h4 style="margin-bottom: 10px; color: var(--dark);">App Features:</h4>
          <ul style="padding-left: 20px; color: var(--gray);">
            <li>Instant task notifications</li>
            <li>Mobile writing and submissions</li>
            <li>Offline task browsing</li>
            <li>Biometric login security</li>
            <li>Real-time earnings tracker</li>
            <li>Push notifications for deadlines</li>
            <li>Mobile withdrawals</li>
            <li>Dark mode support</li>
          </ul>
        </div>
      </div>
    `;
    
    showCustomModal('Download Mobile App', modalContent);
  }

  function showAppGuide() {
    const guideContent = `
      <h3>App Installation Guide</h3>
      <div style="text-align: left; margin-top: 20px;">
        <h4>For iOS (iPhone/iPad):</h4>
        <ol style="padding-left: 20px; margin-top: 10px;">
          <li>Open the App Store on your device</li>
          <li>Search for "Academic Writing Hub"</li>
          <li>Tap the "Get" button to download</li>
          <li>Wait for installation to complete</li>
          <li>Open the app and log in with your credentials</li>
          <li>Enable push notifications when prompted</li>
        </ol>
        
        <h4 style="margin-top: 20px;">For Android:</h4>
        <ol style="padding-left: 20px; margin-top: 10px;">
          <li>Open Google Play Store</li>
          <li>Search for "Academic Writing Hub"</li>
          <li>Tap "Install" to download</li>
          <li>Allow necessary permissions when prompted</li>
          <li>Open the app and log in</li>
          <li>Enable notifications for task alerts</li>
        </ol>
        
        <h4 style="margin-top: 20px;">For Progressive Web App (PWA):</h4>
        <ol style="padding-left: 20px; margin-top: 10px;">
          <li>Open our website in Chrome or Safari</li>
          <li>Tap the share button (iOS) or menu (Android)</li>
          <li>Select "Add to Home Screen"</li>
          <li>Confirm the installation</li>
          <li>The app will be installed like a native app</li>
        </ol>
        
        <p style="margin-top: 25px; color: var(--gray); font-style: italic;">Need help? Contact goldgain321@gmail.com or WhatsApp: +254783567024</p>
      </div>
    `;
    
    showCustomModal('Installation Guide', guideContent);
  }

  function showAppSupport() {
    const supportContent = `
      <h3>App Support Center</h3>
      <div style="text-align: left; margin-top: 20px;">
        <p><strong>Common Issues & Solutions:</strong></p>
        <ul style="padding-left: 20px; margin-top: 10px; margin-bottom: 20px;">
          <li><strong>App won't install:</strong> Check device compatibility and ensure you have sufficient storage space</li>
          <li><strong>Login issues:</strong> Ensure you're using the correct email and password. Reset password if needed</li>
          <li><strong>Notifications not working:</strong> Check app notification settings in device settings</li>
          <li><strong>App crashes:</strong> Update to the latest version from the app store</li>
          <li><strong>Slow performance:</strong> Clear app cache or restart your device</li>
          <li><strong>Payment issues:</strong> Ensure your payment method is properly set up</li>
        </ul>
        
        <p><strong>Support Contact Information:</strong></p>
        <div style="background: rgba(0, 74, 173, 0.05); padding: 15px; border-radius: 8px; margin-top: 10px;">
          <p><i class="fas fa-envelope"></i> Email: goldgain321@gmail.com</p>
          <p><i class="fas fa-phone"></i> WhatsApp: +254783567024</p>
          <p><i class="fas fa-clock"></i> Support Hours: Monday - Friday, 9:00 AM - 6:00 PM EAT</p>
          <p><i class="fas fa-globe"></i> Website: https://academicwritinghub.com/support</p>
        </div>
        
        <p style="margin-top: 20px;"><strong>App Version Information:</strong></p>
        <ul style="padding-left: 20px; margin-top: 10px;">
          <li>iOS App: Version 2.5.0</li>
          <li>Android App: Version 2.5.0</li>
          <li>PWA Version: 1.3.0</li>
          <li>Last Updated: March 2025</li>
        </ul>
      </div>
    `;
    
    showCustomModal('App Support', supportContent);
  }

  function showReferralModal() {
    const modalContent = `
      <div style="text-align: center;">
        <div style="font-size: 48px; color: var(--secondary); margin-bottom: 20px;">
          <i class="fas fa-user-plus"></i>
        </div>
        <h2 style="margin-bottom: 15px;">Invite Friends & Earn</h2>
        <p style="color: var(--gray); margin-bottom: 25px;">Share your unique referral link and earn 15% commission on your friends' earnings. No limit on how much you can earn!</p>
        
        <div style="background: rgba(0, 74, 173, 0.05); padding: 20px; border-radius: 10px; margin-bottom: 25px;">
          <p style="font-weight: bold; margin-bottom: 10px; color: var(--dark);">Your Unique Referral Link:</p>
          <div style="display: flex; gap: 10px;">
            <input type="text" id="referralLink" value="https://academicwritinghub.com/ref/${userProfile?.referral_code || 'YOURCODE'}" readonly style="flex: 1; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: white; font-size: 14px;">
            <button onclick="copyReferralLink()" style="padding: 12px 20px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;">
              <i class="fas fa-copy"></i> Copy
            </button>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 20px;">
          <div style="background: var(--primary); color: white; padding: 20px; border-radius: 10px;">
            <div style="font-size: 28px; font-weight: bold;">${userProfile?.referrals || 0}</div>
            <div>Active Referrals</div>
          </div>
          <div style="background: var(--success); color: white; padding: 20px; border-radius: 10px;">
            <div style="font-size: 28px; font-weight: bold;">$${((userProfile?.total_earnings || 0) * 0.15).toFixed(2)}</div>
            <div>Referral Earnings</div>
          </div>
        </div>
        
        <div style="margin-top: 30px; text-align: left;">
          <h4 style="margin-bottom: 15px; color: var(--dark);">How It Works:</h4>
          <ul style="padding-left: 20px; color: var(--gray);">
            <li>Share your referral link with friends</li>
            <li>They sign up using your link</li>
            <li>You earn 15% of their task earnings</li>
            <li>No limit on number of referrals</li>
            <li>Earnings credited instantly</li>
            <li>Withdraw referral earnings anytime</li>
          </ul>
        </div>
      </div>
    `;
    
    showCustomModal('Referral Program', modalContent);
  }

  function showAchievementModal(achievementId) {
    const achievements = {
      'fast-task': { name: 'Fast Task', description: 'Complete your first task within 24 hours of signing up', reward: '$5 bonus', icon: 'fas fa-bolt' },
      'week-warrior': { name: 'Week Warrior', description: 'Complete tasks for 7 consecutive days', reward: '$20 bonus', icon: 'fas fa-fire' },
      'referral-pro': { name: 'Referral Pro', description: 'Successfully refer 5 friends to the platform', reward: '$50 bonus', icon: 'fas fa-users' },
      'writing-expert': { name: 'Writing Expert', description: 'Complete 50 academic writing tasks with 90%+ quality rating', reward: '$100 bonus', icon: 'fas fa-pen-fancy' },
      'top-earner': { name: 'Top Earner', description: 'Earn over $1000 in total earnings', reward: '$200 bonus', icon: 'fas fa-trophy' },
      'consistency': { name: 'Consistency King', description: 'Maintain 30-day activity streak', reward: '$150 bonus', icon: 'fas fa-calendar-check' }
    };

    const achievement = achievements[achievementId];
    if (!achievement) return;

    const modalContent = `
      <div style="text-align: center;">
        <div style="font-size: 64px; color: var(--warning); margin-bottom: 20px;">
          <i class="${achievement.icon}"></i>
        </div>
        <h2 style="margin-bottom: 10px;">${achievement.name}</h2>
        <p style="color: var(--gray); margin-bottom: 20px; font-size: 16px;">${achievement.description}</p>
        
        <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 10px; display: inline-block; margin-bottom: 25px;">
          <span style="font-weight: bold; color: var(--warning);">Reward: ${achievement.reward}</span>
        </div>
        
        <div style="margin-top: 20px; text-align: left; background: rgba(0, 74, 173, 0.05); padding: 20px; border-radius: 10px;">
          <h4 style="margin-bottom: 10px; color: var(--dark);">How to Earn:</h4>
          <ul style="padding-left: 20px; color: var(--gray);">
            <li>Complete assigned writing tasks</li>
            <li>Maintain consistent activity</li>
            <li>Submit high-quality work</li>
            <li>Meet all task deadlines</li>
            <li>Follow platform guidelines</li>
          </ul>
        </div>
      </div>
    `;
    
    showCustomModal('Achievement Details', modalContent);
  }

  // Legal Pages Functions
  function showHelpCenter() {
    const helpContent = `
      <div class="legal-modal-content">
        <h3>Help Center</h3>
        <h4>Getting Started</h4>
        <p>Welcome to Academic Writing Hub! To get started, follow these steps:</p>
        <ul>
          <li><strong>Complete your profile:</strong> Fill in all required information</li>
          <li><strong>Choose a membership package:</strong> Select a package that suits your needs</li>
          <li><strong>Browse available tasks:</strong> Check the tasks page for available writing opportunities</li>
          <li><strong>Submit your first task:</strong> Complete and submit your first writing task</li>
          <li><strong>Track your earnings:</strong> Monitor your progress in the earnings dashboard</li>
        </ul>
        
        <h4>Common Questions</h4>
        <p><strong>Q: How do I withdraw my earnings?</strong><br>
        A: Go to the Withdraw page, select your preferred payment method (M-Pesa, bank transfer, etc.), enter the amount, and submit your request.</p>
        
        <p><strong>Q: How are tasks assigned?</strong><br>
        A: Tasks are assigned based on your membership level, writing quality, and availability. Higher membership levels get priority access to premium tasks.</p>
        
        <p><strong>Q: What writing guidelines should I follow?</strong><br>
        A: All submissions must be original, plagiarism-free, and meet the specified requirements. Check the task details for specific guidelines.</p>
        
        <h4>Need More Help?</h4>
        <p>If you need further assistance, please contact our support team:</p>
        <ul>
          <li>Email: goldgain321@gmail.com</li>
          <li>WhatsApp: +254783567024</li>
          <li>Support Hours: Monday - Friday, 9:00 AM - 6:00 PM EAT</li>
        </ul>
      </div>
    `;
    
    showCustomModal('Help Center', helpContent);
  }

  function showFAQ() {
    const faqContent = `
      <div class="legal-modal-content">
        <h3>Frequently Asked Questions</h3>
        
        <h4>Account & Registration</h4>
        <p><strong>Q: Is registration free?</strong><br>
        A: Yes, registration is completely free. You only pay for membership packages if you want to upgrade your account.</p>
        
        <p><strong>Q: Can I use multiple accounts?</strong><br>
        A: No, each user is allowed only one account. Multiple accounts will be suspended.</p>
        
        <h4>Earnings & Payments</h4>
        <p><strong>Q: How much can I earn?</strong><br>
        A: Earnings depend on your membership level and task completion. Basic members can earn up to $15.50 daily, while premium members have unlimited earning potential.</p>
        
        <p><strong>Q: When can I withdraw my earnings?</strong><br>
        A: You can withdraw anytime your balance meets the minimum withdrawal amount ($5). Processing time depends on your membership level.</p>
        
        <p><strong>Q: What payment methods are available?</strong><br>
        A: We support M-Pesa, bank transfers, PayPal, and other local payment methods depending on your region.</p>
        
        <h4>Tasks & Writing</h4>
        <p><strong>Q: How are tasks priced?</strong><br>
        A: Task prices vary based on complexity, word count, and urgency. Prices range from $5 to $100+ per task.</p>
        
        <p><strong>Q: What happens if my work is rejected?</strong><br>
        A: You'll receive feedback and may have an opportunity to revise. Repeated rejections may affect your account standing.</p>
        
        <p><strong>Q: Can I choose which tasks to work on?</strong><br>
        A: Yes, you can browse available tasks and choose those that match your skills and interests.</p>
        
        <h4>Technical Issues</h4>
        <p><strong>Q: The website/app isn't loading properly. What should I do?</strong><br>
        A: Try clearing your browser cache, updating your app, or using a different browser. If problems persist, contact support.</p>
        
        <p><strong>Q: I forgot my password. How can I reset it?</strong><br>
        A: Use the "Forgot Password" link on the login page to reset your password via email.</p>
      </div>
    `;
    
    showCustomModal('Frequently Asked Questions', faqContent);
  }

  function showContactUs() {
    const contactContent = `
      <div class="legal-modal-content">
        <h3>Contact Us</h3>
        
        <h4>Customer Support</h4>
        <p>We're here to help you with any questions or concerns about Academic Writing Hub.</p>
        
        <div style="background: rgba(0, 74, 173, 0.05); padding: 20px; border-radius: 10px; margin: 20px 0;">
          <p><strong><i class="fas fa-envelope"></i> Email:</strong> goldgain321@gmail.com</p>
          <p><strong><i class="fas fa-phone"></i> WhatsApp:</strong> +254783567024</p>
          <p><strong><i class="fas fa-clock"></i> Support Hours:</strong> Monday - Friday, 9:00 AM - 6:00 PM EAT</p>
          <p><strong><i class="fas fa-globe"></i> Website:</strong> https://academicwritinghub.com</p>
        </div>
        
        <h4>Social Media</h4>
        <p>Connect with us on social media for updates and announcements:</p>
        <div style="display: flex; gap: 15px; margin: 15px 0;">
          <a href="https://facebook.com/academicwritinghub" target="_blank" style="color: var(--primary); font-size: 20px;"><i class="fab fa-facebook"></i></a>
          <a href="https://twitter.com/academicwritinghub" target="_blank" style="color: var(--primary); font-size: 20px;"><i class="fab fa-twitter"></i></a>
          <a href="https://instagram.com/academicwritinghub" target="_blank" style="color: var(--primary); font-size: 20px;"><i class="fab fa-instagram"></i></a>
          <a href="https://linkedin.com/company/academicwritinghub" target="_blank" style="color: var(--primary); font-size: 20px;"><i class="fab fa-linkedin"></i></a>
          <a href="https://wa.me/254783567024" target="_blank" style="color: var(--primary); font-size: 20px;"><i class="fab fa-whatsapp"></i></a>
        </div>
        
        <h4>Office Address</h4>
        <p>Academic Writing Hub<br>
        Nairobi, Kenya</p>
        
        <h4>Response Time</h4>
        <p>We aim to respond to all inquiries within 24-48 hours during business days.</p>
        
        <div style="background: rgba(16, 185, 129, 0.05); padding: 15px; border-radius: 8px; margin-top: 20px;">
          <p><strong>Note:</strong> For account security, never share your password or verification codes with anyone, including our support team.</p>
        </div>
      </div>
    `;
    
    showCustomModal('Contact Us', contactContent);
  }

  function showTermsOfService() {
    const termsContent = `
      <div class="legal-modal-content">
        <h3>Terms of Service</h3>
        <p><strong>Last Updated: March 2025</strong></p>
        
        <h4>1. Acceptance of Terms</h4>
        <p>By accessing and using Academic Writing Hub, you accept and agree to be bound by these Terms of Service. If you do not agree, you may not use our services.</p>
        
        <h4>2. Account Registration</h4>
        <p>You must provide accurate, complete information when creating an account. You are responsible for maintaining the confidentiality of your account credentials.</p>
        
        <h4>3. User Responsibilities</h4>
        <ul>
          <li>Provide original, plagiarism-free content</li>
          <li>Meet all task deadlines</li>
          <li>Maintain professional conduct</li>
          <li>Not engage in fraudulent activities</li>
          <li>Not create multiple accounts</li>
        </ul>
        
        <h4>4. Payments & Earnings</h4>
        <p>Earnings are paid upon successful task completion. We reserve the right to withhold payments if tasks don't meet quality standards or violate our policies.</p>
        
        <h4>5. Intellectual Property</h4>
        <p>Upon submission and payment, all rights to the completed work transfer to the client. Writers retain no rights to submitted work.</p>
        
        <h4>6. Termination</h4>
        <p>We may suspend or terminate accounts that violate these terms, engage in fraud, or demonstrate consistent low-quality work.</p>
        
        <h4>7. Limitation of Liability</h4>
        <p>Academic Writing Hub is not liable for any indirect, incidental, or consequential damages arising from the use of our platform.</p>
        
        <h4>8. Changes to Terms</h4>
        <p>We may update these terms at any time. Continued use of the platform constitutes acceptance of updated terms.</p>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
          <p>By using Academic Writing Hub, you acknowledge that you have read, understood, and agree to these Terms of Service.</p>
        </div>
      </div>
    `;
    
    showCustomModal('Terms of Service', termsContent);
  }

  function showPrivacyPolicy() {
    const privacyContent = `
      <div class="legal-modal-content">
        <h3>Privacy Policy</h3>
        <p><strong>Last Updated: March 2025</strong></p>
        
        <h4>1. Information We Collect</h4>
        <p>We collect information you provide directly, including:</p>
        <ul>
          <li>Name, email, and contact information</li>
          <li>Payment and withdrawal details</li>
          <li>Task submissions and communications</li>
          <li>Usage data and analytics</li>
        </ul>
        
        <h4>2. How We Use Your Information</h4>
        <p>Your information is used to:</p>
        <ul>
          <li>Provide and improve our services</li>
          <li>Process payments and withdrawals</li>
          <li>Communicate with you about tasks and updates</li>
          <li>Ensure platform security</li>
          <li>Comply with legal obligations</li>
        </ul>
        
        <h4>3. Information Sharing</h4>
        <p>We do not sell your personal information. We may share information with:</p>
        <ul>
          <li>Payment processors for transaction completion</li>
          <li>Legal authorities when required by law</li>
          <li>Service providers who assist our operations</li>
        </ul>
        
        <h4>4. Data Security</h4>
        <p>We implement security measures to protect your data, including encryption, secure servers, and access controls.</p>
        
        <h4>5. Your Rights</h4>
        <p>You have the right to:</p>
        <ul>
          <li>Access your personal information</li>
          <li>Correct inaccurate data</li>
          <li>Request deletion of your data</li>
          <li>Opt-out of marketing communications</li>
        </ul>
        
        <h4>6. Cookies & Tracking</h4>
        <p>We use cookies to improve user experience, analyze site usage, and remember preferences.</p>
        
        <h4>7. Children's Privacy</h4>
        <p>Our services are not intended for users under 18. We do not knowingly collect information from children.</p>
        
        <h4>8. Contact Information</h4>
        <p>For privacy-related questions, contact us at:</p>
        <p>Email: goldgain321@gmail.com<br>
        Subject: Privacy Policy Inquiry</p>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border);">
          <p>By using Academic Writing Hub, you consent to our Privacy Policy.</p>
        </div>
      </div>
    `;
    
    showCustomModal('Privacy Policy', privacyContent);
  }

  function copyReferralLink() {
    const referralLink = document.getElementById('referralLink');
    if (referralLink) {
      referralLink.select();
      referralLink.setSelectionRange(0, 99999);
      document.execCommand('copy');
      showMessage('âœ… Referral link copied to clipboard!', 'success');
    }
  }

  function showCustomModal(title, content) {
    // Create modal overlay
    const modalOverlay = document.createElement('div');
    modalOverlay.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      backdrop-filter: blur(5px);
      padding: 20px;
    `;
    
    // Create modal
    const modal = document.createElement('div');
    modal.style.cssText = `
      background: white;
      border-radius: 20px;
      padding: 30px;
      max-width: 600px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    `;
    
    // Add dark mode support
    if (document.body.classList.contains('dark-mode')) {
      modal.style.background = 'var(--dark-card)';
      modal.style.color = 'white';
    }
    
    modal.innerHTML = `
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h3 style="margin: 0; font-size: 24px;">${title}</h3>
        <button id="closeModal" style="background: none; border: none; font-size: 28px; cursor: pointer; color: var(--gray); padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;">&times;</button>
      </div>
      <div>${content}</div>
    `;
    
    modalOverlay.appendChild(modal);
    document.body.appendChild(modalOverlay);
    
    // Add close functionality
    document.getElementById('closeModal').addEventListener('click', () => {
      document.body.removeChild(modalOverlay);
    });
    
    // Close when clicking outside modal
    modalOverlay.addEventListener('click', (e) => {
      if (e.target === modalOverlay) {
        document.body.removeChild(modalOverlay);
      }
    });
    
    // Close with ESC key
    document.addEventListener('keydown', function closeModalOnEsc(e) {
      if (e.key === 'Escape') {
        document.body.removeChild(modalOverlay);
        document.removeEventListener('keydown', closeModalOnEsc);
      }
    });
  }

  function showMessage(message, type) {
    // Create toast notification with updated Toastify syntax
    Toastify({
      text: message,
      duration: 5000,
      gravity: "top",
      position: "right",
      style: {
        background: type === 'success' ? 'var(--success)' : 
                   type === 'error' ? 'var(--danger)' : 
                   type === 'info' ? 'var(--primary)' : 'var(--warning)'
      },
      stopOnFocus: true,
      onClick: function(){}
    }).showToast();
  }

  async function handleLogout(e) {
    if (e) e.preventDefault();
    
    try {
      const logoutBtn = document.getElementById('logoutBtn');
      if (logoutBtn) {
        logoutBtn.innerHTML = '<div class="nav-icon"><i class="fas fa-spinner fa-spin"></i></div><span>Logging out...</span>';
        logoutBtn.style.pointerEvents = 'none';
      }

      // Unsubscribe from real-time updates
      if (realTimeSubscription) {
        supabaseClient.removeChannel(realTimeSubscription);
      }

      if (supabaseClient) {
        const { error } = await supabaseClient.auth.signOut();
        if (error) console.error('Logout error:', error);
      }

      localStorage.clear();
      sessionStorage.clear();

      window.location.href = "login.html";

    } catch (error) {
      console.error('Logout error:', error);
      window.location.href = "login.html";
    }
  }

  async function payReferralBonus(referrerId, userId, packageType, amountKSH) {
    try {
      // Calculate referral bonus (10% of package price)
      const bonusAmountKSH = amountKSH * 0.1;
      
      // Update referrer's balance
      const { data: referrerProfile, error: referrerError } = await supabaseClient
        .from('profiles')
        .select('balance')
        .eq('id', referrerId)
        .single();

      if (referrerError) {
        console.log('Referrer not found or error:', referrerError);
        return;
      }

      const newBalance = (parseFloat(referrerProfile.balance) || 0) + bonusAmountKSH;

      // Update referrer's profile
      const { error: updateError } = await supabaseClient
        .from('profiles')
        .update({
          balance: newBalance,
          updated_at: new Date().toISOString()
        })
        .eq('id', referrerId);

      if (updateError) throw updateError;

      // Record referral bonus transaction
      await recordTransaction('referral_bonus', bonusAmountKSH, `Referral bonus from ${packageType} package`, referrerId);

      console.log(`âœ… Paid referral bonus of ${formatUSD(kshToUsd(bonusAmountKSH))} to referrer ${referrerId}`);
      
    } catch (error) {
      console.error('Error paying referral bonus:', error);
    }
  }

  // Make functions globally available
  window.downloadApp = downloadApp;
  window.installPWA = installPWA;
  window.startTask = startTask;
  window.viewTaskDetails = viewTaskDetails;
  window.showReferralModal = showReferralModal;
  window.showAchievementModal = showAchievementModal;
  window.copyReferralLink = copyReferralLink;
  window.showAppGuide = showAppGuide;
  window.showAppSupport = showAppSupport;
  window.showAppDownloadModal = showAppDownloadModal;
  window.markNotificationAsRead = markNotificationAsRead;
  window.markAllNotificationsAsRead = markAllNotificationsAsRead;
  window.upgradeMembership = upgradeMembership;
  window.showHelpCenter = showHelpCenter;
  window.showFAQ = showFAQ;
  window.showContactUs = showContactUs;
  window.showTermsOfService = showTermsOfService;
  window.showPrivacyPolicy = showPrivacyPolicy;
</script>

</body>
  </html>




